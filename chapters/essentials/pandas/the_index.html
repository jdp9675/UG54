
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>3.4.3. The Index &#8212; Quantitative Investing</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/book.css?v=c2893119" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapters/essentials/pandas/the_index';</script>
    <link rel="canonical" href="https://amoreira2.github.io/Fin418/chapters/essentials/pandas/the_index.html" />
    <link rel="icon" href="../../../_static/figuremain2.jpg"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="3.4.4. Time series" href="timeseries.html" />
    <link rel="prev" title="3.4. Pandas" href="../introtopandas.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/figuremain2.jpg" class="logo__image only-light" alt="Quantitative Investing - Home"/>
    <script>document.write(`<img src="../../../_static/figuremain2.jpg" class="logo__image only-dark" alt="Quantitative Investing - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../01/what-is-quant-investing.html">1. What is Data Driven Investing?</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../01/statistical-techniques.html">1.1. Statistical Techniques</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../01/computational-tools.html">1.2. Computational tools</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../02/getting_started.html">2. Getting Started</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../02/cloud_setup.html">2.3. Cloud Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02/local_install.html">2.4. Local installation</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../intro.html">3. Python Essentials</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../basics.html">3.1. Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../collections.html">3.2. Collections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../numpy.html">3.3. Numpy</a></li>
<li class="toctree-l2 current active has-children"><a class="reference internal" href="../introtopandas.html">3.4. Pandas</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l3 current active"><a class="current reference internal" href="#">3.4.3. Indexing</a></li>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html">3.4.4. Time-Series</a></li>
<li class="toctree-l3"><a class="reference internal" href="reshape.html">3.4.5. Reshape</a></li>
<li class="toctree-l3"><a class="reference internal" href="merge.html">3.4.6. Merge</a></li>
<li class="toctree-l3"><a class="reference internal" href="groupby.html">3.4.7. Group-by</a></li>
<li class="toctree-l3"><a class="reference internal" href="matplotlib.html">3.4.8. Plotting</a></li>
<li class="toctree-l3"><a class="reference internal" href="data_clean.html">3.4.9. Cleaning data</a></li>
<li class="toctree-l3"><a class="reference internal" href="storage_formats.html">3.4.10. Data Storage</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../control_flow.html">3.5. Flow control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions.html">3.6. Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plotting.html">3.7. Plotting</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Finance/IntrotoReturns.html">4. Introduction to Asset Returns</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../Finance/TheChoiceofFrequency.html">4.5. The Choice of Frequency and Annualization of Returns</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Finance/UsingAPI.html">4.6. Data APIs</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../Finance/FactorModels.html">5. Factor Models</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Finance/PortfolioMath.html">6. Portfolios</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../scientific/linear_algebra1.html">6.5. Linear Algebra Review</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../Finance/CapitalAllocationI.html">7. Capital Allocation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Finance/FactorModelEstimation.html">8. Factor Model Estimation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Finance/Timing.html">9. Timing Strategies</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../Finance/MarketTiming.html">9.1. Expected Returns Timing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Finance/Volatilitytiming.html">9.2. Volatility Timing</a></li>

</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Finance/crosssectionalequitystrategies.html">10. Cross-Sectional Equity Strategies</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../Finance/Momentum.html">10.3. Momentum factor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Finance/Factors.html">10.4. An overview of factors</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../Finance/CapitalAllocationII.html">11. Capital Allocation II</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Finance/Performance_evaluation.html">12. Performance Evaluation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Finance/MachineLearning.html">13. Machine Learning in Finance</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Finance/MultiFactorModels.html">14. Multi Factor Models</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../Finance/InterpretingFactorModels.html">14.6. 📊 Interpreting Factor Models</a></li>


</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../Finance/RiskManagement.html">15. Risk Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Finance/TradingCosts.html">16. Liquidity and Trading Cost Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Finance/LeverageandShorting.html">17. Leverage, Shorting, and Limits to Arbitrage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Finance/GenAIandLLMsinFinance.html">18. Gen AI and LLMs in Finance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../additional/additional.html">19. Additional Statistics Material</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Assignments/Assignments.html">20. Assignments</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../Assignments/Assignment1.html">20.1. Assignment 1</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/amoreira2/Fin418/blob/main/chapters/essentials/pandas/the_index.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/amoreira2/Fin418" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/amoreira2/Fin418/issues/new?title=Issue%20on%20page%20%2Fchapters/essentials/pandas/the_index.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/chapters/essentials/pandas/the_index.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>The Index</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#so-what-is-this-index">3.4.3.1. So What is this Index?</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#automatic-alignment">3.4.3.1.1. Automatic Alignment</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#handling-missing-data">3.4.3.1.2. Handling Missing Data</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-the-index">3.4.3.2. Setting the Index</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-a-hierarchical-index">3.4.3.2.1. Setting a Hierarchical Index</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#slicing-a-hierarchical-index">3.4.3.2.2. Slicing a Hierarchical Index</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#alignment-with-multiindex">3.4.3.2.3. Alignment with <code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pd-indexslice">3.4.3.2.4. <code class="docutils literal notranslate"><span class="pre">pd.IndexSlice</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#multi-index-columns">3.4.3.2.5. Multi-index Columns</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#re-setting-the-index">3.4.3.3. Re-setting the Index</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#choose-the-index-carefully">3.4.3.4. Choose the Index Carefully</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#know-your-goal">3.4.3.4.1. Know Your Goal</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="the-index">
<h1><span class="section-number">3.4.3. </span>The Index<a class="headerlink" href="#the-index" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
<section id="so-what-is-this-index">
<h2><span class="section-number">3.4.3.1. </span>So What is this Index?<a class="headerlink" href="#so-what-is-this-index" title="Link to this heading">#</a></h2>
<p>Every Series or DataFrame has an index.</p>
<p>We told you that the index was the “row labels” for the data.</p>
<p>This is true, but an index in pandas does much more than label the rows.</p>
<p>The purpose of this lecture is to understand the importance of the index.</p>
<p>The <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/dsintro.html">pandas
documentation</a>
says</p>
<blockquote>
<div><p>Data alignment is intrinsic. The link between labels and data will
not be broken unless done so explicitly by you.</p>
</div></blockquote>
<p>In practice, the index and column names are used to make sure the data is
properly aligned when operating on multiple DataFrames.</p>
<p>This is a somewhat abstract concept that is best understood by
example…</p>
<p>Let’s begin by loading our stock return data and break it in smaller data sets</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

<span class="c1"># Create a date parser function that will allow pandas to read the dates in the format we have them</span>
<span class="n">date_parser</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;%Y%m&quot;</span><span class="p">)</span>
<span class="c1"># our 50 stock returns data</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/amoreira2/Fin418/main/assets/data/Retuns50stocks.csv&quot;</span>

<span class="c1"># Use pd.read_csv with the date_parser</span>
<span class="n">df</span>  <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span> <span class="n">date_parser</span><span class="o">=</span><span class="n">date_parser</span><span class="p">)</span>
<span class="c1"># Set the date column as the index</span>
</pre></div>
</div>
</div>
</div>
<p>We’ll also extract a couple smaller DataFrames we can use in examples.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df0</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
<span class="n">df0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CTL</th>
      <th>T</th>
      <th>CSCO</th>
      <th>FCX</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-18.4697</td>
      <td>-11.5513</td>
      <td>2.2170</td>
      <td>-17.4556</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-12.9450</td>
      <td>-11.2245</td>
      <td>20.7192</td>
      <td>-21.1470</td>
    </tr>
    <tr>
      <th>2</th>
      <td>10.5502</td>
      <td>10.6732</td>
      <td>16.9740</td>
      <td>-12.2727</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-34.0067</td>
      <td>4.6083</td>
      <td>-10.3274</td>
      <td>-20.2073</td>
    </tr>
    <tr>
      <th>4</th>
      <td>10.3980</td>
      <td>-0.2853</td>
      <td>-17.8724</td>
      <td>-4.5455</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df1</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
<span class="n">df1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CTL</th>
      <th>T</th>
      <th>CSCO</th>
      <th>FCX</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3</th>
      <td>-34.0067</td>
      <td>4.6083</td>
      <td>-10.3274</td>
      <td>-20.2073</td>
    </tr>
    <tr>
      <th>4</th>
      <td>10.3980</td>
      <td>-0.2853</td>
      <td>-17.8724</td>
      <td>-4.5455</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6.4815</td>
      <td>-1.0014</td>
      <td>11.6356</td>
      <td>0.6803</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1.9565</td>
      <td>-1.0029</td>
      <td>2.9499</td>
      <td>-2.7027</td>
    </tr>
    <tr>
      <th>7</th>
      <td>-1.5437</td>
      <td>-1.9090</td>
      <td>4.8711</td>
      <td>9.0278</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Note that the dates now overlap but the overlap is not perfect</p>
<p>Note also that both have five rows</p>
<p>What happens when we try to add these two dataframes?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#df0+df1</span>
</pre></div>
</div>
</div>
</div>
<p>What is happening? Why is that useful to us?</p>
<p>Note now with non-overlapping columns</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df0</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>

<span class="n">df1</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>

<span class="c1">#df0+df1</span>
</pre></div>
</div>
</div>
</div>
<section id="automatic-alignment">
<h3><span class="section-number">3.4.3.1.1. </span>Automatic Alignment<a class="headerlink" href="#automatic-alignment" title="Link to this heading">#</a></h3>
<p>For all (row, column) combinations that appear in both DataFrames, the value of <code class="docutils literal notranslate"><span class="pre">df0+df1</span></code>
is equal to <code class="docutils literal notranslate"><span class="pre">df0.loc[row,</span> <span class="pre">col]</span> <span class="pre">+</span> <span class="pre">df1.loc[row,</span> <span class="pre">col]</span></code>.</p>
<p>This happened even though the rows and columns were not in the same
order.</p>
<p>We refer to this as pandas <em>aligning</em> the data for us.</p>
<p>To see how awesome this is, think about how to do something similar in
Excel:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">df0</span></code> and <code class="docutils literal notranslate"><span class="pre">df1</span></code> would be in different sheets.</p></li>
<li><p>The index and column names would be the first column and row in each
sheet.</p></li>
<li><p>For each label in the first row and column of <em>either</em> the <code class="docutils literal notranslate"><span class="pre">df0</span></code>
sheet or the <code class="docutils literal notranslate"><span class="pre">df1</span></code> sheet we would have to do a <code class="docutils literal notranslate"><span class="pre">IFELSE</span></code> to check
if the label exists in the other sheet and then a <code class="docutils literal notranslate"><span class="pre">VLOOKUP</span></code> to
extract the value.</p></li>
</ul>
<p>In pandas, this happens automatically, behind the scenes, and <em>very
quickly</em>.</p>
</section>
<section id="handling-missing-data">
<h3><span class="section-number">3.4.3.1.2. </span>Handling Missing Data<a class="headerlink" href="#handling-missing-data" title="Link to this heading">#</a></h3>
<p>For all elements in the non-overlapping row/column combination,
the value in <code class="docutils literal notranslate"><span class="pre">df0+df1</span></code> is <code class="docutils literal notranslate"><span class="pre">NaN</span></code>.</p>
<p>This is how pandas represents <em>missing data</em>.</p>
<p>So, when pandas was trying to look up the values in <code class="docutils literal notranslate"><span class="pre">df0</span></code> and <code class="docutils literal notranslate"><span class="pre">df1</span></code>, it could
only find a value in one DataFrame: the other value was missing.</p>
<p>When pandas tries to add a number to something that is missing, it says
that the result is missing (spelled <code class="docutils literal notranslate"><span class="pre">NaN</span></code>).</p>
</section>
</section>
<section id="setting-the-index">
<h2><span class="section-number">3.4.3.2. </span>Setting the Index<a class="headerlink" href="#setting-the-index" title="Link to this heading">#</a></h2>
<p>For a DataFrame <code class="docutils literal notranslate"><span class="pre">df</span></code>, the <code class="docutils literal notranslate"><span class="pre">df.set_index</span></code> method allows us to use one
(or more) of the DataFrame’s columns as the index.</p>
<p>Here’s an example.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># first, create the DataFrame</span>
<span class="n">df_date</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s2">&quot;date&quot;</span><span class="p">])</span>
<span class="n">df_date</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CTL</th>
      <th>T</th>
      <th>CSCO</th>
      <th>FCX</th>
      <th>XL</th>
      <th>IVZ</th>
      <th>AMT</th>
      <th>WHR</th>
      <th>IR</th>
      <th>WFT</th>
      <th>...</th>
      <th>SWK</th>
      <th>DVN</th>
      <th>TMO</th>
      <th>PEP</th>
      <th>LNC</th>
      <th>EMR</th>
      <th>MLM</th>
      <th>CCI</th>
      <th>NU</th>
      <th>Market</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000-01-01</th>
      <td>-18.4697</td>
      <td>-11.5513</td>
      <td>2.2170</td>
      <td>-17.4556</td>
      <td>-12.5301</td>
      <td>-4.0929</td>
      <td>17.3824</td>
      <td>-10.4707</td>
      <td>-14.5289</td>
      <td>-5.9468</td>
      <td>...</td>
      <td>-16.5975</td>
      <td>6.8441</td>
      <td>15.4167</td>
      <td>-3.1915</td>
      <td>-6.9312</td>
      <td>-4.0305</td>
      <td>2.4390</td>
      <td>-1.5564</td>
      <td>-0.3040</td>
      <td>-3.9612</td>
    </tr>
    <tr>
      <th>2000-02-01</th>
      <td>-12.9450</td>
      <td>-11.2245</td>
      <td>20.7192</td>
      <td>-21.1470</td>
      <td>-9.8898</td>
      <td>5.3057</td>
      <td>37.2822</td>
      <td>-6.1760</td>
      <td>-18.2311</td>
      <td>19.8003</td>
      <td>...</td>
      <td>-8.4577</td>
      <td>6.0498</td>
      <td>-9.7473</td>
      <td>-5.8608</td>
      <td>-25.2115</td>
      <td>-16.6039</td>
      <td>-15.1667</td>
      <td>1.9763</td>
      <td>-7.7439</td>
      <td>3.1777</td>
    </tr>
    <tr>
      <th>2000-03-01</th>
      <td>10.5502</td>
      <td>10.6732</td>
      <td>16.9740</td>
      <td>-12.2727</td>
      <td>36.9397</td>
      <td>24.4250</td>
      <td>0.2538</td>
      <td>7.9402</td>
      <td>15.4976</td>
      <td>30.0000</td>
      <td>...</td>
      <td>15.6304</td>
      <td>30.5034</td>
      <td>30.4000</td>
      <td>8.9805</td>
      <td>21.2670</td>
      <td>16.5981</td>
      <td>33.8028</td>
      <td>17.4419</td>
      <td>14.2857</td>
      <td>5.3500</td>
    </tr>
    <tr>
      <th>2000-04-01</th>
      <td>-34.0067</td>
      <td>4.6083</td>
      <td>-10.3274</td>
      <td>-20.2073</td>
      <td>-13.9955</td>
      <td>0.9670</td>
      <td>-5.6962</td>
      <td>11.0874</td>
      <td>6.0734</td>
      <td>2.7153</td>
      <td>...</td>
      <td>11.8483</td>
      <td>-0.9009</td>
      <td>-4.9080</td>
      <td>5.1971</td>
      <td>4.7836</td>
      <td>3.2941</td>
      <td>11.5789</td>
      <td>1.3201</td>
      <td>0.0000</td>
      <td>-5.9530</td>
    </tr>
    <tr>
      <th>2000-05-01</th>
      <td>10.3980</td>
      <td>-0.2853</td>
      <td>-17.8724</td>
      <td>-4.5455</td>
      <td>25.8793</td>
      <td>-8.7719</td>
      <td>-20.2685</td>
      <td>-12.4338</td>
      <td>-2.5672</td>
      <td>6.0000</td>
      <td>...</td>
      <td>-8.8983</td>
      <td>24.2857</td>
      <td>-4.1935</td>
      <td>11.4140</td>
      <td>11.3106</td>
      <td>8.1686</td>
      <td>-7.4198</td>
      <td>-31.7590</td>
      <td>3.3721</td>
      <td>-3.8871</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 51 columns</p>
</div></div></div>
</div>
<p>Now the dates are caried in any manipulation we do</p>
<p>the return observation is bind together with the index</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df0</span> <span class="o">=</span> <span class="n">df_date</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>

<span class="n">df0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>T</th>
      <th>CSCO</th>
      <th>FCX</th>
      <th>XL</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000-01-01</th>
      <td>-11.5513</td>
      <td>2.2170</td>
      <td>-17.4556</td>
      <td>-12.5301</td>
    </tr>
    <tr>
      <th>2000-02-01</th>
      <td>-11.2245</td>
      <td>20.7192</td>
      <td>-21.1470</td>
      <td>-9.8898</td>
    </tr>
    <tr>
      <th>2000-03-01</th>
      <td>10.6732</td>
      <td>16.9740</td>
      <td>-12.2727</td>
      <td>36.9397</td>
    </tr>
    <tr>
      <th>2000-04-01</th>
      <td>4.6083</td>
      <td>-10.3274</td>
      <td>-20.2073</td>
      <td>-13.9955</td>
    </tr>
    <tr>
      <th>2000-05-01</th>
      <td>-0.2853</td>
      <td>-17.8724</td>
      <td>-4.5455</td>
      <td>25.8793</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Now that the date is on the index, we can use <code class="docutils literal notranslate"><span class="pre">.loc</span></code> to extract all the
data for a specific year.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_date</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2001&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CTL</th>
      <th>T</th>
      <th>CSCO</th>
      <th>FCX</th>
      <th>XL</th>
      <th>IVZ</th>
      <th>AMT</th>
      <th>WHR</th>
      <th>IR</th>
      <th>WFT</th>
      <th>...</th>
      <th>SWK</th>
      <th>DVN</th>
      <th>TMO</th>
      <th>PEP</th>
      <th>LNC</th>
      <th>EMR</th>
      <th>MLM</th>
      <th>CCI</th>
      <th>NU</th>
      <th>Market</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2001-01-01</th>
      <td>-12.2238</td>
      <td>1.7880</td>
      <td>-2.1242</td>
      <td>36.6423</td>
      <td>-15.1016</td>
      <td>5.9770</td>
      <td>-4.4224</td>
      <td>10.0708</td>
      <td>5.8149</td>
      <td>3.4497</td>
      <td>...</td>
      <td>10.044100</td>
      <td>-10.1197</td>
      <td>-0.336100</td>
      <td>-11.0820</td>
      <td>-4.5601</td>
      <td>-3.5686</td>
      <td>0.165500</td>
      <td>3.2333</td>
      <td>-6.886600</td>
      <td>3.959900</td>
    </tr>
    <tr>
      <th>2001-02-01</th>
      <td>-8.1581</td>
      <td>-1.3444</td>
      <td>-36.7279</td>
      <td>20.0855</td>
      <td>3.0871</td>
      <td>-13.6876</td>
      <td>-20.0552</td>
      <td>1.3717</td>
      <td>-1.7829</td>
      <td>6.4443</td>
      <td>...</td>
      <td>1.398600</td>
      <td>4.0146</td>
      <td>-5.902200</td>
      <td>4.5609</td>
      <td>-2.1851</td>
      <td>-11.4704</td>
      <td>8.779800</td>
      <td>-10.0671</td>
      <td>-9.211699</td>
      <td>-9.909901</td>
    </tr>
    <tr>
      <th>2001-03-01</th>
      <td>-0.0694</td>
      <td>-6.4361</td>
      <td>-33.2454</td>
      <td>-7.1174</td>
      <td>0.0789</td>
      <td>-26.6816</td>
      <td>-36.0746</td>
      <td>-5.4473</td>
      <td>-8.3968</td>
      <td>-5.1509</td>
      <td>...</td>
      <td>-4.655200</td>
      <td>2.1930</td>
      <td>-19.426500</td>
      <td>-4.3186</td>
      <td>-3.1912</td>
      <td>-7.3244</td>
      <td>-7.072900</td>
      <td>-41.0448</td>
      <td>-14.803900</td>
      <td>-7.039000</td>
    </tr>
    <tr>
      <th>2001-04-01</th>
      <td>-5.4609</td>
      <td>-6.9992</td>
      <td>7.3834</td>
      <td>8.5057</td>
      <td>-6.9278</td>
      <td>25.8621</td>
      <td>44.8649</td>
      <td>11.5623</td>
      <td>18.3581</td>
      <td>17.9939</td>
      <td>...</td>
      <td>10.015200</td>
      <td>1.3917</td>
      <td>17.259800</td>
      <td>-0.3185</td>
      <td>9.4066</td>
      <td>7.5000</td>
      <td>7.658100</td>
      <td>65.3333</td>
      <td>2.704300</td>
      <td>8.383100</td>
    </tr>
    <tr>
      <th>2001-05-01</th>
      <td>4.8197</td>
      <td>4.3636</td>
      <td>13.4276</td>
      <td>10.6638</td>
      <td>12.9378</td>
      <td>3.1507</td>
      <td>-7.6866</td>
      <td>13.3764</td>
      <td>5.3617</td>
      <td>-3.1942</td>
      <td>...</td>
      <td>5.462100</td>
      <td>-1.3557</td>
      <td>5.880100</td>
      <td>2.1684</td>
      <td>6.6724</td>
      <td>2.1643</td>
      <td>7.700700</td>
      <td>-32.2172</td>
      <td>8.347300</td>
      <td>1.045800</td>
    </tr>
    <tr>
      <th>2001-06-01</th>
      <td>6.5401</td>
      <td>-6.9454</td>
      <td>-5.5036</td>
      <td>-29.4831</td>
      <td>3.2704</td>
      <td>-8.0212</td>
      <td>-16.4511</td>
      <td>-0.6201</td>
      <td>-16.5147</td>
      <td>-14.8483</td>
      <td>...</td>
      <td>10.210500</td>
      <td>-9.7234</td>
      <td>-21.103500</td>
      <td>-0.9272</td>
      <td>5.0975</td>
      <td>-10.6484</td>
      <td>0.243100</td>
      <td>-1.2048</td>
      <td>7.848200</td>
      <td>-1.755400</td>
    </tr>
    <tr>
      <th>2001-07-01</th>
      <td>2.1782</td>
      <td>13.0460</td>
      <td>5.6044</td>
      <td>-2.6244</td>
      <td>-6.5164</td>
      <td>-7.7678</td>
      <td>-17.9971</td>
      <td>12.8640</td>
      <td>6.0194</td>
      <td>-12.1875</td>
      <td>...</td>
      <td>4.083100</td>
      <td>3.2571</td>
      <td>3.542200</td>
      <td>5.4977</td>
      <td>-0.8019</td>
      <td>-5.1901</td>
      <td>-10.931500</td>
      <td>-40.5488</td>
      <td>-3.614500</td>
      <td>-1.829400</td>
    </tr>
    <tr>
      <th>2001-08-01</th>
      <td>13.3721</td>
      <td>-9.1495</td>
      <td>-15.0364</td>
      <td>15.0558</td>
      <td>8.7427</td>
      <td>-8.8917</td>
      <td>-14.6313</td>
      <td>-5.9257</td>
      <td>-6.7308</td>
      <td>-21.0676</td>
      <td>...</td>
      <td>-3.349400</td>
      <td>-14.6467</td>
      <td>-1.195700</td>
      <td>0.7935</td>
      <td>-2.2928</td>
      <td>-5.8883</td>
      <td>-10.072600</td>
      <td>4.5128</td>
      <td>-1.875000</td>
      <td>-5.898000</td>
    </tr>
    <tr>
      <th>2001-09-01</th>
      <td>-4.4223</td>
      <td>15.1797</td>
      <td>-25.4133</td>
      <td>-11.2278</td>
      <td>-4.8193</td>
      <td>-25.7581</td>
      <td>-4.0083</td>
      <td>-16.1618</td>
      <td>-16.6872</td>
      <td>-23.3243</td>
      <td>...</td>
      <td>-12.747700</td>
      <td>-25.5457</td>
      <td>-16.705100</td>
      <td>3.5000</td>
      <td>-6.4781</td>
      <td>-12.2015</td>
      <td>-0.987300</td>
      <td>-11.6781</td>
      <td>-3.948700</td>
      <td>-9.148800</td>
    </tr>
    <tr>
      <th>2001-10-01</th>
      <td>-5.6716</td>
      <td>-18.5776</td>
      <td>38.9163</td>
      <td>1.0009</td>
      <td>9.9494</td>
      <td>10.9040</td>
      <td>-20.6623</td>
      <td>6.6305</td>
      <td>10.3550</td>
      <td>34.1827</td>
      <td>...</td>
      <td>4.842700</td>
      <td>11.3372</td>
      <td>17.119100</td>
      <td>0.4330</td>
      <td>-8.5246</td>
      <td>4.1649</td>
      <td>2.071100</td>
      <td>30.0000</td>
      <td>-5.766200</td>
      <td>2.783300</td>
    </tr>
    <tr>
      <th>2001-11-01</th>
      <td>7.1202</td>
      <td>-1.9155</td>
      <td>20.8038</td>
      <td>20.2703</td>
      <td>7.5754</td>
      <td>18.4874</td>
      <td>-20.1452</td>
      <td>11.9959</td>
      <td>12.7614</td>
      <td>-2.2203</td>
      <td>...</td>
      <td>9.681601</td>
      <td>-10.2089</td>
      <td>14.830700</td>
      <td>-0.1642</td>
      <td>12.6328</td>
      <td>11.0720</td>
      <td>6.813600</td>
      <td>-6.9231</td>
      <td>-0.708200</td>
      <td>7.878000</td>
    </tr>
    <tr>
      <th>2001-12-01</th>
      <td>-2.9586</td>
      <td>4.7886</td>
      <td>-11.3992</td>
      <td>0.2996</td>
      <td>-1.7423</td>
      <td>2.9078</td>
      <td>7.6136</td>
      <td>11.5116</td>
      <td>-0.1910</td>
      <td>11.3236</td>
      <td>...</td>
      <td>11.438100</td>
      <td>12.5327</td>
      <td>9.953899</td>
      <td>0.4215</td>
      <td>1.8239</td>
      <td>5.6234</td>
      <td>9.647099</td>
      <td>-1.9284</td>
      <td>1.321800</td>
      <td>1.784800</td>
    </tr>
  </tbody>
</table>
<p>12 rows × 51 columns</p>
</div></div></div>
</div>
<p>This would be helpful, for example, if we wanted to compute the difference
in the average returns of all stocks from one year to the next.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_date</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2009&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">-</span> <span class="n">df_date</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2008&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CTL        5.487558
T          2.937392
CSCO       7.361342
FCX       19.844483
XL        33.775933
IVZ       10.040733
AMT        6.153350
WHR       12.306317
IR        14.456158
WFT       12.827383
YUM        2.444442
CVS        3.850175
GD         5.122642
TYC        8.857808
EL         6.362417
MUR        6.686392
CTAS       4.201033
CBSA      15.443775
SNV       -7.350500
CAM       12.429442
DLTR      -2.890100
CAH        6.473425
DTE        3.731900
SSP       24.993375
PSA       -0.423242
EXC        1.991258
TKR        4.816925
CMA        8.773100
ORCL       4.711567
MS        13.742083
RSG        3.409825
ACAS      18.108168
AGN        7.490375
MMM        6.472683
ETFC      12.750600
CAR       55.472400
MDR       20.387558
NOV       12.799792
PCH        4.852950
BAX        1.485500
JCI        9.846317
SWK        6.712133
DVN        3.786125
TMO        6.738350
PEP        3.447342
LNC       12.628092
EMR        4.992283
MLM        1.451650
CCI       12.952525
NU         2.722825
Market     6.205725
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Notice that pandas did a few things for us.</p>
<ul class="simple">
<li><p>After computing <code class="docutils literal notranslate"><span class="pre">.mean()</span></code>, the row labels (index) were the former column names.</p></li>
<li><p>These column names were used to align data when we wanted asked pandas to
compute the difference.</p></li>
</ul>
<p>Suppose that someone asked you, “What was the Return volatily of the CSCO in 2010?”</p>
<p>With the original df dataset you would so something like</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="o">==</span><span class="mi">2010</span><span class="p">,</span> <span class="s2">&quot;CSCO&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>9.851823038802452
</pre></div>
</div>
</div>
</div>
<p>How would you do that using the <code class="docutils literal notranslate"><span class="pre">df_date</span></code> dataframe?</p>
<section id="setting-a-hierarchical-index">
<h3><span class="section-number">3.4.3.2.1. </span>Setting a Hierarchical Index<a class="headerlink" href="#setting-a-hierarchical-index" title="Link to this heading">#</a></h3>
<p>Include multiple columns in the index is advantageous in some situations.</p>
<p>These situations might include:</p>
<ul class="simple">
<li><p>When we need more than one piece of information (column) to identify an
observation</p></li>
<li><p>When we need data-alignment by more than one column</p></li>
</ul>
<p>To achieve multiple columns in the index, we pass a list of multiple column
names to <code class="docutils literal notranslate"><span class="pre">set_index</span></code>.</p>
<p>To show this we will first stack our data set</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_stacked</span><span class="o">=</span><span class="n">df_date</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">df_stacked</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>level_1</th>
      <th>0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2000-01-01</td>
      <td>CTL</td>
      <td>-18.4697</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2000-01-01</td>
      <td>T</td>
      <td>-11.5513</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2000-01-01</td>
      <td>CSCO</td>
      <td>2.2170</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2000-01-01</td>
      <td>FCX</td>
      <td>-17.4556</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2000-01-01</td>
      <td>XL</td>
      <td>-12.5301</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>9175</th>
      <td>2014-12-01</td>
      <td>EMR</td>
      <td>-3.1686</td>
    </tr>
    <tr>
      <th>9176</th>
      <td>2014-12-01</td>
      <td>MLM</td>
      <td>-8.0973</td>
    </tr>
    <tr>
      <th>9177</th>
      <td>2014-12-01</td>
      <td>CCI</td>
      <td>-4.2965</td>
    </tr>
    <tr>
      <th>9178</th>
      <td>2014-12-01</td>
      <td>NU</td>
      <td>6.4623</td>
    </tr>
    <tr>
      <th>9179</th>
      <td>2014-12-01</td>
      <td>Market</td>
      <td>-0.3616</td>
    </tr>
  </tbody>
</table>
<p>9180 rows × 3 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># let us rename the columns to date ticker and return</span>

<span class="n">df_stacked</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;ticker&quot;</span><span class="p">,</span> <span class="s2">&quot;return&quot;</span><span class="p">]</span>
<span class="n">df_stacked</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>ticker</th>
      <th>return</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2000-01-01</td>
      <td>CTL</td>
      <td>-18.4697</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2000-01-01</td>
      <td>T</td>
      <td>-11.5513</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2000-01-01</td>
      <td>CSCO</td>
      <td>2.2170</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2000-01-01</td>
      <td>FCX</td>
      <td>-17.4556</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2000-01-01</td>
      <td>XL</td>
      <td>-12.5301</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_stacked</span> <span class="o">=</span> <span class="n">df_stacked</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="s1">&#39;ticker&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;ticker&quot;</span><span class="p">])</span>
<span class="n">df_stacked</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>return</th>
    </tr>
    <tr>
      <th>date</th>
      <th>ticker</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">2000-01-01</th>
      <th>ACAS</th>
      <td>13.7363</td>
    </tr>
    <tr>
      <th>AGN</th>
      <td>14.5729</td>
    </tr>
    <tr>
      <th>AMT</th>
      <td>17.3824</td>
    </tr>
    <tr>
      <th>BAX</th>
      <td>1.6915</td>
    </tr>
    <tr>
      <th>CAH</th>
      <td>-0.3916</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Notice that in the display above, the row labels seem to have two
<em>levels</em> now.</p>
<p>The <em>outer</em> (or left-most) level is named <code class="docutils literal notranslate"><span class="pre">date</span></code> and the <em>inner</em> (or
right-most) level is named <code class="docutils literal notranslate"><span class="pre">ticker</span></code>.</p>
<p>When a DataFrame’s index has multiple levels, we (and the pandas documentation)
refer to the DataFrame as having a hierarchical index.</p>
</section>
<section id="slicing-a-hierarchical-index">
<h3><span class="section-number">3.4.3.2.2. </span>Slicing a Hierarchical Index<a class="headerlink" href="#slicing-a-hierarchical-index" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_stacked</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="s1">&#39;2000&#39;</span><span class="p">,</span><span class="s2">&quot;CSCO&quot;</span> <span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>return</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000-01-01</th>
      <td>2.2170</td>
    </tr>
    <tr>
      <th>2000-02-01</th>
      <td>20.7192</td>
    </tr>
    <tr>
      <th>2000-03-01</th>
      <td>16.9740</td>
    </tr>
    <tr>
      <th>2000-04-01</th>
      <td>-10.3274</td>
    </tr>
    <tr>
      <th>2000-05-01</th>
      <td>-17.8724</td>
    </tr>
    <tr>
      <th>2000-06-01</th>
      <td>11.6356</td>
    </tr>
    <tr>
      <th>2000-07-01</th>
      <td>2.9499</td>
    </tr>
    <tr>
      <th>2000-08-01</th>
      <td>4.8711</td>
    </tr>
    <tr>
      <th>2000-09-01</th>
      <td>-19.4900</td>
    </tr>
    <tr>
      <th>2000-10-01</th>
      <td>-2.4887</td>
    </tr>
    <tr>
      <th>2000-11-01</th>
      <td>-11.1369</td>
    </tr>
    <tr>
      <th>2000-12-01</th>
      <td>-20.1044</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_stacked</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="s1">&#39;2000&#39;</span><span class="p">,[</span><span class="s2">&quot;CSCO&quot;</span><span class="p">,</span><span class="s2">&quot;ACAS&quot;</span><span class="p">]),:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>return</th>
    </tr>
    <tr>
      <th>date</th>
      <th>ticker</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">2000-01-01</th>
      <th>CSCO</th>
      <td>2.217000</td>
    </tr>
    <tr>
      <th>ACAS</th>
      <td>13.736300</td>
    </tr>
    <tr>
      <th>2000-02-01</th>
      <th>CSCO</th>
      <td>20.719200</td>
    </tr>
    <tr>
      <th>2000-03-01</th>
      <th>CSCO</th>
      <td>16.974000</td>
    </tr>
    <tr>
      <th>2000-04-01</th>
      <th>CSCO</th>
      <td>-10.327400</td>
    </tr>
    <tr>
      <th>2000-05-01</th>
      <th>CSCO</th>
      <td>-17.872400</td>
    </tr>
    <tr>
      <th>2000-06-01</th>
      <th>CSCO</th>
      <td>11.635600</td>
    </tr>
    <tr>
      <th>2000-07-01</th>
      <th>CSCO</th>
      <td>2.949900</td>
    </tr>
    <tr>
      <th>2000-08-01</th>
      <th>CSCO</th>
      <td>4.871100</td>
    </tr>
    <tr>
      <th>2000-09-01</th>
      <th>CSCO</th>
      <td>-19.490000</td>
    </tr>
    <tr>
      <th>2000-10-01</th>
      <th>CSCO</th>
      <td>-2.488700</td>
    </tr>
    <tr>
      <th>2000-11-01</th>
      <th>CSCO</th>
      <td>-11.136900</td>
    </tr>
    <tr>
      <th>2000-12-01</th>
      <th>CSCO</th>
      <td>-20.104400</td>
    </tr>
    <tr>
      <th>2000-02-01</th>
      <th>ACAS</th>
      <td>-7.246400</td>
    </tr>
    <tr>
      <th>2000-03-01</th>
      <th>ACAS</th>
      <td>7.604199</td>
    </tr>
    <tr>
      <th>2000-04-01</th>
      <th>ACAS</th>
      <td>-4.433500</td>
    </tr>
    <tr>
      <th>2000-05-01</th>
      <th>ACAS</th>
      <td>-12.154600</td>
    </tr>
    <tr>
      <th>2000-06-01</th>
      <th>ACAS</th>
      <td>14.714700</td>
    </tr>
    <tr>
      <th>2000-07-01</th>
      <th>ACAS</th>
      <td>7.329800</td>
    </tr>
    <tr>
      <th>2000-08-01</th>
      <th>ACAS</th>
      <td>-6.829300</td>
    </tr>
    <tr>
      <th>2000-09-01</th>
      <th>ACAS</th>
      <td>1.267000</td>
    </tr>
    <tr>
      <th>2000-10-01</th>
      <th>ACAS</th>
      <td>-6.860200</td>
    </tr>
    <tr>
      <th>2000-11-01</th>
      <th>ACAS</th>
      <td>-3.399400</td>
    </tr>
    <tr>
      <th>2000-12-01</th>
      <th>ACAS</th>
      <td>21.654000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>As shown above, we can use <code class="docutils literal notranslate"><span class="pre">.loc</span></code> to extract different slices of our
data</p>
<p>The rules for using <code class="docutils literal notranslate"><span class="pre">.loc</span></code> with a hierarchically-indexed DataFrame are
similar to the ones we’ve learned for standard DataFrames, but they are a bit
more elaborate as we now have more structure to our data.</p>
<p>We will summarize the main rules, and then work through an exercise that
demonstrates each of them.</p>
<p><strong>Slicing rules</strong></p>
<p>pandas slicing reacts differently to <code class="docutils literal notranslate"><span class="pre">list</span></code>s and <code class="docutils literal notranslate"><span class="pre">tuple</span></code>s.</p>
<p>It does this to provide more flexibility to select the
data you want.</p>
<p><code class="docutils literal notranslate"><span class="pre">list</span></code> in row slicing will be an “or” operation, where it chooses rows
based on whether the index value corresponds to any element of the list.</p>
<p><code class="docutils literal notranslate"><span class="pre">tuple</span></code> in row slicing will be used to denote a single hierarchical
index and must include a value for each level.</p>
<p><strong>Row slicing examples</strong></p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">df_stacked</span></code>.loc[“CSCO”]: all rows where the <em>outer</em> most index value is
equal to <code class="docutils literal notranslate"><span class="pre">CSCO</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">df_stacked</span></code>.loc[(‘2005’,”CSCO”)]: all rows where the <em>outer-most</em> index value picks all dates in the year <code class="docutils literal notranslate"><span class="pre">2005</span></code> and the second level is equal to <code class="docutils literal notranslate"><span class="pre">CSCO</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">df_stacked</span></code>.loc[[“2010”, “2006”]]: all rows where the <em>outer-most</em> index is belongs to the years 2010 or 2006</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">df_stacked</span></code>.loc[([‘2010’, ‘2011’],[“CSCO”, “T”]), :]: all rows where the
<em>outer-most</em> index belong to the years of <code class="docutils literal notranslate"><span class="pre">2010</span></code> or <code class="docutils literal notranslate"><span class="pre">2011</span></code>  AND where the
second level index is either  <code class="docutils literal notranslate"><span class="pre">&quot;CSCO</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;T&quot;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">df_stacked</span></code>.loc[[(“CSCO”, ‘2010-01-01’), (“T”, ‘2011-02-01’)], :]: all rows where the the two hierarchical indices are either <code class="docutils literal notranslate"><span class="pre">(&quot;CSCO&quot;,</span> <span class="pre">'2010-01-01')</span></code> or<code class="docutils literal notranslate"><span class="pre">(&quot;T&quot;,</span> <span class="pre">'2011-02-01')</span></code> . Here we cannot slice a a whole year an d need instead to pass a precise date</p></li>
</ol>
<p>If we had multiple columns re can also restrict <code class="docutils literal notranslate"><span class="pre">.loc</span></code> to extract certain columns by doing:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">df_stacked.loc[rows,</span> <span class="pre">'dividends']</span></code>: return the rows specified by rows</p></li>
</ol>
<p>Why don’t you try a few of these possibilities?</p>
</section>
<section id="alignment-with-multiindex">
<h3><span class="section-number">3.4.3.2.3. </span>Alignment with <code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code><a class="headerlink" href="#alignment-with-multiindex" title="Link to this heading">#</a></h3>
<p>The data alignment features we talked about above also apply to a
<code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code> DataFrame.</p>
</section>
<section id="pd-indexslice">
<h3><span class="section-number">3.4.3.2.4. </span><code class="docutils literal notranslate"><span class="pre">pd.IndexSlice</span></code><a class="headerlink" href="#pd-indexslice" title="Link to this heading">#</a></h3>
<p>When we want to extract rows for a few values of the outer index and all
values for an inner index level, we can use the convenient
<code class="docutils literal notranslate"><span class="pre">df.loc[[id11,</span> <span class="pre">id22]]</span></code> shorthand.</p>
<p>We can use this notation to extract all the data for two years.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_stacked</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s2">&quot;2010&quot;</span><span class="p">,</span> <span class="s2">&quot;2004&quot;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>return</th>
    </tr>
    <tr>
      <th>date</th>
      <th>ticker</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">2010-01-01</th>
      <th>ACAS</th>
      <td>51.229500</td>
    </tr>
    <tr>
      <th>AGN</th>
      <td>-8.744599</td>
    </tr>
    <tr>
      <th>AMT</th>
      <td>-1.758800</td>
    </tr>
    <tr>
      <th>BAX</th>
      <td>-1.857500</td>
    </tr>
    <tr>
      <th>CAH</th>
      <td>2.574400</td>
    </tr>
    <tr>
      <th>...</th>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th rowspan="5" valign="top">2004-01-01</th>
      <th>TYC</th>
      <td>0.943400</td>
    </tr>
    <tr>
      <th>WFT</th>
      <td>12.000000</td>
    </tr>
    <tr>
      <th>WHR</th>
      <td>4.542300</td>
    </tr>
    <tr>
      <th>XL</th>
      <td>2.514500</td>
    </tr>
    <tr>
      <th>YUM</th>
      <td>-1.424400</td>
    </tr>
  </tbody>
</table>
<p>102 rows × 1 columns</p>
</div></div></div>
</div>
<p>However, suppose we wanted to extract the data for all years, but only for thhe stocks ACAS YUM and TYC.</p>
<p>We cannot do this using <code class="docutils literal notranslate"><span class="pre">.loc</span></code> because the ticker is on the second level,
not outer-most level of our index.</p>
<p>To get around this limitation, we can use the <code class="docutils literal notranslate"><span class="pre">pd.IndexSlice</span></code> helper.</p>
<p>Here’s an example.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_stacked</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">IndexSlice</span><span class="p">[:,</span> <span class="p">[</span><span class="s1">&#39;ACAS&#39;</span><span class="p">,</span> <span class="s1">&#39;YUM&#39;</span><span class="p">,</span> <span class="s1">&#39;TYC&#39;</span><span class="p">]],</span> <span class="p">:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>return</th>
    </tr>
    <tr>
      <th>date</th>
      <th>ticker</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000-01-01</th>
      <th>ACAS</th>
      <td>13.736300</td>
    </tr>
    <tr>
      <th>2000-02-01</th>
      <th>ACAS</th>
      <td>-7.246400</td>
    </tr>
    <tr>
      <th>2000-03-01</th>
      <th>ACAS</th>
      <td>7.604199</td>
    </tr>
    <tr>
      <th>2000-04-01</th>
      <th>ACAS</th>
      <td>-4.433500</td>
    </tr>
    <tr>
      <th>2000-05-01</th>
      <th>ACAS</th>
      <td>-12.154600</td>
    </tr>
    <tr>
      <th>...</th>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th>2014-08-01</th>
      <th>TYC</th>
      <td>3.406700</td>
    </tr>
    <tr>
      <th>2014-09-01</th>
      <th>TYC</th>
      <td>-0.112100</td>
    </tr>
    <tr>
      <th>2014-10-01</th>
      <th>TYC</th>
      <td>-3.275700</td>
    </tr>
    <tr>
      <th>2014-11-01</th>
      <th>TYC</th>
      <td>-0.069900</td>
    </tr>
    <tr>
      <th>2014-12-01</th>
      <th>TYC</th>
      <td>2.237800</td>
    </tr>
  </tbody>
</table>
<p>540 rows × 1 columns</p>
</div></div></div>
</div>
<p>Notice that the <code class="docutils literal notranslate"><span class="pre">:</span></code> in the first part of <code class="docutils literal notranslate"><span class="pre">[:,</span> <span class="pre">[&quot;A&quot;,</span> <span class="pre">&quot;D&quot;]]</span></code>
instructed pandas to give us rows for all values of the outer most index
level and that the <code class="docutils literal notranslate"><span class="pre">:</span></code> just before <code class="docutils literal notranslate"><span class="pre">]</span></code> said grab all the columns.</p>
<p>You can also select a slice but in this case it is very important that your dataframe is sorted with respect to the index</p>
</section>
<section id="multi-index-columns">
<h3><span class="section-number">3.4.3.2.5. </span>Multi-index Columns<a class="headerlink" href="#multi-index-columns" title="Link to this heading">#</a></h3>
<p>The functionality of <code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code> also applies to the column names.</p>
</section>
</section>
<section id="re-setting-the-index">
<h2><span class="section-number">3.4.3.3. </span>Re-setting the Index<a class="headerlink" href="#re-setting-the-index" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">df.reset_index</span></code> method will move one or more level of the index
back into the DataFrame as a normal column.</p>
<p>With no additional arguments, it moves all levels out of the index and
sets the index of the returned DataFrame to the default of
<code class="docutils literal notranslate"><span class="pre">range(df.shape[0])</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_stacked</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>ticker</th>
      <th>return</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2000-01-01</td>
      <td>ACAS</td>
      <td>13.7363</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2000-01-01</td>
      <td>AGN</td>
      <td>14.5729</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2000-01-01</td>
      <td>AMT</td>
      <td>17.3824</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2000-01-01</td>
      <td>BAX</td>
      <td>1.6915</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2000-01-01</td>
      <td>CAH</td>
      <td>-0.3916</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>9175</th>
      <td>2014-12-01</td>
      <td>TYC</td>
      <td>2.2378</td>
    </tr>
    <tr>
      <th>9176</th>
      <td>2014-12-01</td>
      <td>WFT</td>
      <td>-12.5954</td>
    </tr>
    <tr>
      <th>9177</th>
      <td>2014-12-01</td>
      <td>WHR</td>
      <td>4.0662</td>
    </tr>
    <tr>
      <th>9178</th>
      <td>2014-12-01</td>
      <td>XL</td>
      <td>-2.7872</td>
    </tr>
    <tr>
      <th>9179</th>
      <td>2014-12-01</td>
      <td>YUM</td>
      <td>-5.6958</td>
    </tr>
  </tbody>
</table>
<p>9180 rows × 3 columns</p>
</div></div></div>
</div>
</section>
<section id="choose-the-index-carefully">
<h2><span class="section-number">3.4.3.4. </span>Choose the Index Carefully<a class="headerlink" href="#choose-the-index-carefully" title="Link to this heading">#</a></h2>
<p>So, now that we know that we use index and column names for
aligning data, “how should we pick the index?” is a natural question to ask.</p>
<p>To guide us to the right answer, we will list the first two components
to <a class="reference external" href="http://hadley.nz/">Hadley Wickham’s</a> description of <a class="reference external" href="http://vita.had.co.nz/papers/tidy-data.html">tidy
data</a>:</p>
<ol class="arabic simple">
<li><p>Each column should each have one variable.</p></li>
<li><p>Each row should each have one observation.</p></li>
</ol>
<p>If we strive to have our data in a tidy form (we should), then when
choosing the index, we should set:</p>
<ul class="simple">
<li><p>the row labels (index) to be a unique identifier for an observation
of data</p></li>
<li><p>the column names to identify one variable</p></li>
</ul>
<p>For example, suppose we are looking data on interest rates.</p>
<p>Each column might represent one bond or asset and each row might
represent the date.</p>
<p>Using hierarchical row and column indices allows us to store higher
dimensional data in our (inherently) two dimensional DataFrame.</p>
<section id="know-your-goal">
<h3><span class="section-number">3.4.3.4.1. </span>Know Your Goal<a class="headerlink" href="#know-your-goal" title="Link to this heading">#</a></h3>
<p>The correct column(s) to choose for the index often depends on the context of
your analysis.</p>
<p>For example, if I were studying how GDP and consumption evolved over time for
various countries, I would want time (year) and country name on the index</p>
<p>On the other hand, if I were trying to look at the differences across countries
and variables within a particular year, I may opt to put the country and
variable on the index and have years be columns.</p>
<p>Following the tidy data rules above and thinking about how you intend to <em>use</em>
the data – and a little practice – will enable you to consistently select the
correct index.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chapters/essentials/pandas"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../introtopandas.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">3.4. </span>Pandas</p>
      </div>
    </a>
    <a class="right-next"
       href="timeseries.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">3.4.4. </span>Time series</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#so-what-is-this-index">3.4.3.1. So What is this Index?</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#automatic-alignment">3.4.3.1.1. Automatic Alignment</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#handling-missing-data">3.4.3.1.2. Handling Missing Data</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-the-index">3.4.3.2. Setting the Index</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-a-hierarchical-index">3.4.3.2.1. Setting a Hierarchical Index</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#slicing-a-hierarchical-index">3.4.3.2.2. Slicing a Hierarchical Index</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#alignment-with-multiindex">3.4.3.2.3. Alignment with <code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pd-indexslice">3.4.3.2.4. <code class="docutils literal notranslate"><span class="pre">pd.IndexSlice</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#multi-index-columns">3.4.3.2.5. Multi-index Columns</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#re-setting-the-index">3.4.3.3. Re-setting the Index</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#choose-the-index-carefully">3.4.3.4. Choose the Index Carefully</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#know-your-goal">3.4.3.4.1. Know Your Goal</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Alan Moreira
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2021 Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0).
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>