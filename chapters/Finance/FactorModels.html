
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>5. Introduction to Factor models &#8212; Quantitative Investing</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/book.css?v=c2893119" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapters/Finance/FactorModels';</script>
    <link rel="canonical" href="https://amoreira2.github.io/Fin418/chapters/Finance/FactorModels.html" />
    <link rel="icon" href="../../_static/figuremain2.jpg"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="6. Estimation: From historical data to the future dynamics of returns" href="FactorModelEstimation.html" />
    <link rel="prev" title="4.7. Randomness" href="../scientific/randomness1.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/figuremain2.jpg" class="logo__image only-light" alt="Quantitative Investing - Home"/>
    <img src="../../_static/figuremain2.jpg" class="logo__image only-dark pst-js-only" alt="Quantitative Investing - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../01/what-is-quant-investing.html">1. What is Quantitative Investing?</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../01/statistical-techniques.html">1.1. Statistical Techniques</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01/computational-tools.html">1.2. Computational tools</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../02/getting_started.html">2. Getting Started</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../02/local_install.html">2.3. Local installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02/cloud_setup.html">2.4. Cloud Setup</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../essentials/intro.html">3. Python Essentials</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../essentials/basics.html">3.1. Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/collections.html">3.2. Collections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/numpy.html">3.3. Numpy</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../essentials/introtopandas.html">3.4. Pandas</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/the_index.html">3.4.3. Indexing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/timeseries.html">3.4.4. Time-Series</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/reshape.html">3.4.5. Reshape</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/merge.html">3.4.6. Merge</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/groupby.html">3.4.7. Group-by</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/matplotlib.html">3.4.8. Plotting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/data_clean.html">3.4.9. Cleaning data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/storage_formats.html">3.4.10. Data Storage</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/control_flow.html">3.5. Flow control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/functions.html">3.6. Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/plotting.html">3.7. Plotting</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="Returns_working.html">4. Asset Returns</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="UsingAPI.html">4.5. Data APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="TheChoiceofFrequency.html">4.6. The Choice of Frequency and Annualization of Returns</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scientific/randomness1.html">4.7. Modeling randomness</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">5. Factor Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="FactorModelEstimation.html">6. Factor Model Estimation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="PortfolioMath.html">7. Portfolios</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="LeverageandShorting.html">7.8. Leverage and Shorting</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="Performance_evaluation.html">8. Performance Evaluation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="crosssectionalequitystrategies.html">9. Cross-Sectional Equity Strategies</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="Momentum.html">9.3. Momentum factor</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="MultiFactorModels.html">10. Multi Factor Models</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="Factors.html">10.9. An overview of factors</a></li>
<li class="toctree-l2"><a class="reference internal" href="InterpretingFactorModels.html">10.10. Interpreting Factor Models</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="MachineLearning.html">11. Machine Learning in Finance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../additional/additional.html">12. Additional Statistics Material</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Assignments/Assignments.html">13. Assignments</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/amoreira2/Fin418/blob/main/chapters/Finance/FactorModels.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/amoreira2/Fin418" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/amoreira2/Fin418/issues/new?title=Issue%20on%20page%20%2Fchapters/Finance/FactorModels.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/chapters/Finance/FactorModels.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Introduction to Factor models</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#alpha-and-beta-s">5.1. Alpha and Beta(s)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#focus-on-your-skill-hedge-all-the-residual-risk">5.2. Focus on your skill, hedge all the residual risk</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#variance-decomposition">5.3. Variance Decomposition</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#factor-models-means-you-need-to-estimate-less-parameters">5.4. Factor models means you need to estimate LESS parameters</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load libraries</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">wrds</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas_datareader.data</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">web</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define functions  </span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_daily_wrds</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span><span class="n">tickers</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  
    <span class="c1"># Retrieve PERMNOs for the specified tickers</span>
    <span class="n">permnos</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">get_table</span><span class="p">(</span><span class="n">library</span><span class="o">=</span><span class="s1">&#39;crsp&#39;</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="s1">&#39;stocknames&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;permno&#39;</span><span class="p">,</span> <span class="s1">&#39;ticker&#39;</span><span class="p">,</span> <span class="s1">&#39;namedt&#39;</span><span class="p">,</span> <span class="s1">&#39;nameenddt&#39;</span><span class="p">])</span>
    <span class="n">permnos</span><span class="p">[</span><span class="s1">&#39;nameenddt&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">permnos</span><span class="p">[</span><span class="s1">&#39;nameenddt&#39;</span><span class="p">])</span>
    <span class="n">permnos</span> <span class="o">=</span> <span class="n">permnos</span><span class="p">[(</span><span class="n">permnos</span><span class="p">[</span><span class="s1">&#39;ticker&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">tickers</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">permnos</span><span class="p">[</span><span class="s1">&#39;nameenddt&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">permnos</span><span class="p">[</span><span class="s1">&#39;nameenddt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())]</span>
    <span class="c1"># Extract unique PERMNOs</span>
    <span class="n">permno_list</span> <span class="o">=</span> <span class="n">permnos</span><span class="p">[</span><span class="s1">&#39;permno&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">permno_list</span><span class="p">)</span>

    <span class="c1"># Query daily stock file for the specified PERMNOs</span>
    
    <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        SELECT permno, date, ret, retx, prc       </span>
<span class="s2">        FROM crsp.dsf</span>
<span class="s2">        WHERE permno IN (</span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="w"> </span><span class="n">permno_list</span><span class="p">))</span><span class="si">}</span><span class="s2">)</span>
<span class="s2">        ORDER BY date,permno</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="n">daily_returns</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">raw_sql</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">date_cols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])</span>
    <span class="n">daily_returns</span> <span class="o">=</span> <span class="n">daily_returns</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">permnos</span><span class="p">[[</span><span class="s1">&#39;permno&#39;</span><span class="p">,</span> <span class="s1">&#39;ticker&#39;</span><span class="p">]],</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;permno&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
<span class="c1"># Pivot data to have dates as index and tickers as columns</span>
    <span class="n">daily_returns</span> <span class="o">=</span> <span class="n">daily_returns</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;ticker&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;ret&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>    
    <span class="n">daily_returns</span><span class="o">=</span><span class="n">daily_returns</span><span class="p">[</span><span class="n">tickers</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">daily_returns</span>


<span class="k">def</span><span class="w"> </span><span class="nf">get_factors</span><span class="p">(</span><span class="n">ff6</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    
    <span class="n">fama_french</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="s2">&quot;F-F_Research_Data_5_Factors_2x3_daily&quot;</span><span class="p">,</span> <span class="s2">&quot;famafrench&quot;</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="s2">&quot;1926-01-01&quot;</span><span class="p">)</span>
    <span class="n">daily_data</span> <span class="o">=</span> <span class="n">fama_french</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># The first DataFrame contains the daily data</span>
    <span class="n">daily_data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">daily_data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>  <span class="c1"># Ensure index is datetime</span>
    <span class="k">if</span> <span class="n">ff6</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
        <span class="n">df_factor</span> <span class="o">=</span> <span class="n">daily_data</span><span class="p">[[</span><span class="s1">&#39;RF&#39;</span><span class="p">,</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]]</span>  <span class="c1"># Extract the Risk-Free Rate (RF)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">df_factor</span> <span class="o">=</span> <span class="n">daily_data</span><span class="p">[[</span><span class="s1">&#39;RF&#39;</span><span class="p">,</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">,</span><span class="s1">&#39;SMB&#39;</span><span class="p">,</span><span class="s1">&#39;HML&#39;</span><span class="p">,</span><span class="s1">&#39;RMW&#39;</span><span class="p">,</span><span class="s1">&#39;CMA&#39;</span><span class="p">]]</span>
        <span class="n">fama_french</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="s2">&quot;F-F_Momentum_Factor_daily&quot;</span><span class="p">,</span> <span class="s2">&quot;famafrench&quot;</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="s2">&quot;1926-01-01&quot;</span><span class="p">)</span>
        <span class="n">df_factor</span><span class="o">=</span><span class="n">df_factor</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">fama_french</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">df_factor</span><span class="o">/</span><span class="mi">100</span>
</pre></div>
</div>
</div>
</div>
<section class="tex2jax_ignore mathjax_ignore" id="introduction-to-factor-models">
<h1><span class="section-number">5. </span>Introduction to Factor models<a class="headerlink" href="#introduction-to-factor-models" title="Link to this heading">#</a></h1>
<p>Let <span class="math notranslate nohighlight">\(r^e\)</span> be an asset excess return over the risk-free rate</p>
<p>Let <span class="math notranslate nohighlight">\(f\)</span> be a traded factor, for now  the excess returns on SPY ETF</p>
<p>Then we can write</p>
<div class="math notranslate nohighlight">
\[r^e=\alpha + b*f+\epsilon\]</div>
<p>where <span class="math notranslate nohighlight">\(b\)</span> is asset <span class="math notranslate nohighlight">\(i\)</span> exposure to the factor <span class="math notranslate nohighlight">\(f\)</span></p>
<p>We can always write things that way–it is just a statistical decomposition</p>
<ol class="arabic simple">
<li><p>It can be useful for measuring risk if</p>
<ul class="simple">
<li><p>The risk <span class="math notranslate nohighlight">\(\epsilon\)</span> is specific to asset <span class="math notranslate nohighlight">\(i\)</span> and uncorrelated with other assets</p></li>
<li><p>I.e the factors picks up lots of the variation in stock returns</p></li>
</ul>
</li>
<li><p>It can be useful for measuring expected returns if</p>
<ul class="simple">
<li><p>The premium on the factor f, <span class="math notranslate nohighlight">\(E[f]\)</span> summarize well the known “priced” systematic risk factors</p></li>
<li><p>By “priced” we mean risk-factors that earn a risk premium  <span class="math notranslate nohighlight">\(E[f]&gt;0\)</span></p></li>
</ul>
</li>
</ol>
<p>We will call the first a factor model of risk, and the second a factor model of expected returns</p>
<p>What use is a factor model?</p>
<ul class="simple">
<li><p>the alpha/Beta decomposition is how the money management industry is organized.</p>
<ul>
<li><p>Big pay days only if people think you have alpha</p></li>
<li><p>Getting exposure to the factor is a commodity. Anyone can buy SPY or many other funds that track the market very well</p></li>
<li><p>In most funds, specially for portfolio managers working a pod shops like Citadel and Millenium, a portfolio manager mandate is to take no factor risk–or at least aim to be close to factor neutral.</p></li>
<li><p>It is all about the alpha</p></li>
</ul>
</li>
<li><p>factor models allow you to understand and hedge risk</p>
<ul>
<li><p>This is essential if you want to concentrate your portfolio only on the pieces that you get compensated</p></li>
</ul>
</li>
</ul>
<section id="alpha-and-beta-s">
<h2><span class="section-number">5.1. </span>Alpha and Beta(s)<a class="headerlink" href="#alpha-and-beta-s" title="Link to this heading">#</a></h2>
<p>Note that</p>
<div class="math notranslate nohighlight">
\[E[r]=E[rf+r^{e}]=rf+E[\alpha_i + b*f+\epsilon]\]</div>
<div class="math notranslate nohighlight">
\[E[r]=rf+\alpha+b*E[f]+E[\epsilon]\]</div>
<ul class="simple">
<li><p>Using that <span class="math notranslate nohighlight">\(E[\epsilon]=0\)</span> we have
$<span class="math notranslate nohighlight">\(E[r]=rf+\alpha+b*E[f]\)</span>$</p></li>
<li><p>Thus, just like the risk of our asset could be attributed to the factor and it’s component, the same model also allow us to decompose the expected return in terms of the risk-free rate, the premium coming from the common factor exposure <span class="math notranslate nohighlight">\(b*E[f]\)</span> and the risk-premium specific to the asset, the ALPHA.</p></li>
<li><p>The alpha does not need to be in a specific asset, can be o a combination of them</p></li>
<li><p>The decomposition works the same for portfolio of assets</p></li>
<li><p>For now we have a single factor, but you will see that as you have more factors, everything is pretty much the same</p></li>
</ul>
</section>
<section id="focus-on-your-skill-hedge-all-the-residual-risk">
<h2><span class="section-number">5.2. </span>Focus on your skill, hedge all the residual risk<a class="headerlink" href="#focus-on-your-skill-hedge-all-the-residual-risk" title="Link to this heading">#</a></h2>
<p>No matter who you are, you will face dollar risk limits</p>
<p>So it is essential that you deploy risk wisely</p>
<p>The key use of the factor model is to give you discipline to separate your edge from the rest</p>
<p>How to use the factor model?</p>
<p>First , realize that each piece of the factor model will require very thoughtful estimation</p>
<p>Even here with only one asset and one factor we already have to know many things</p>
<ol class="arabic simple">
<li><p>The risk-free rate</p></li>
<li><p>The beta</p></li>
<li><p>The factor risk-premia</p></li>
<li><p>The factor variance</p></li>
<li><p>The asset specific alpha</p></li>
<li><p>The factor specific variance</p></li>
</ol>
<p>For now we will assume we know each of these.</p>
<p>if you have an asset that has alpha, says, you are confident that APPLE will beat expectations and you expect a 5% appreciation in the next 12 months beyond any factor exposure that APPle might had, what do you do?</p>
<ol class="arabic simple">
<li><p>Buy apple!</p></li>
</ol>
<p>But what is the market crashes? Why bear that risk?<br />
Portfolio allocators look for managers with alpha, not beta.
What if the market crashes before apple surprises and your investors pull out?</p>
<ol class="arabic simple" start="2">
<li><p>Hedge the market</p>
<ul class="simple">
<li><p>How do you do that?</p></li>
<li><p>Short it!</p></li>
<li><p>How much?</p></li>
<li><p>the asset beta!</p></li>
</ul>
</li>
</ol>
<p>Example:</p>
<ol class="arabic simple">
<li><p>You buy 1M in Apple stock, so your portfolio PnL is 1M*<span class="math notranslate nohighlight">\(r^{apple}\)</span></p></li>
<li><p>Your portfolio PnL in excess what you would earn in treasuries is 1M*<span class="math notranslate nohighlight">\((r^{apple}-rf)\)</span></p></li>
<li><p>Sell (short) 1M*<span class="math notranslate nohighlight">\(beta_{apple,f}\)</span> of the factor</p></li>
<li><p>Now your portfolio is PnL above the risk-free rate is</p></li>
</ol>
<div class="math notranslate nohighlight">
\[1M*(r^{apple}-rf-\beta*r^{SPY}+\beta*rf)\]</div>
<p>When you sell SPY short you get the money and here I am “investing” it in the risk-free rate</p>
<p>Alternatively you can think of it as using to fund the apple buy</p>
<p>it does not matter, because we are accounting for the time-value of money</p>
<p>We certainly don’t want to invest anything else to just add noise to our trade</p>
<div class="math notranslate nohighlight">
\[1M*(r^{apple}-\beta*r^{SPY}-(1-\beta)*rf)\]</div>
<p>For a high beta stock your trade generates extra cash!</p>
<p>If <span class="math notranslate nohighlight">\(\beta&gt;1\)</span>, <span class="math notranslate nohighlight">\(-(1-\beta)*rf&gt;0\)</span></p>
<p>This happens because you are selling more than you are buying</p>
<p>If we substitute our factor model in our trade PnL and take expectations what do we get?</p>
<div class="math notranslate nohighlight">
\[1M*E[r^{apple}-rf-\beta*r^{SPY}+\beta*rf)]\]</div>
<div class="math notranslate nohighlight">
\[1M*E[\alpha_i+rf+beta*(r^{SPY}-rf)+u_i-rf-\beta*r^{SPY}+\beta*rf)]\]</div>
<p>A pure play portfolio!</p>
<div class="math notranslate nohighlight">
\[1M*E[\alpha_i]\]</div>
<p>And what is the portfolio risk?</p>
<div class="math notranslate nohighlight">
\[std(1M*(r^{apple}-rf-\beta*r^{SPY}+\beta*rf))=1M*std(u_i)\]</div>
<ul class="simple">
<li><p>We refer to portfolio <span class="math notranslate nohighlight">\((1,-\beta)\times(AAPL,SPY)\)</span> as the Apple-factor hedged portfolio, or simply the “hedged-portfolio”</p></li>
<li><p>and refer to <span class="math notranslate nohighlight">\(-\beta \times \)</span> (SPY) as the “Hedging Portfolio”</p></li>
</ul>
<p>Lets do this!</p>
<p>I will use a regression to get some numbers for us to do this strategy</p>
<p>but for now, just think those as numbers I am giving you and don’t think of the regression as giving the right numbers necessarily.</p>
<p>Do example with an asset. Compare the hedged and unhedged returns</p>
<p>Discuss why these are trading strategy returns</p>
<p>Show the positions that Implement this trade</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span> <span class="o">=</span> <span class="n">wrds</span><span class="o">.</span><span class="n">Connection</span><span class="p">()</span>
<span class="n">ticker</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;MSFT&#39;</span><span class="p">]</span>
<span class="n">df_returns</span> <span class="o">=</span> <span class="n">get_daily_wrds</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span><span class="n">ticker</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_returns</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="n">df_returns</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WRDS recommends setting up a .pgpass file.
Created .pgpass file successfully.
You can create this file yourself at any time with the create_pgpass_file() function.
Loading library list...
Done
[10107]
ticker          MSFT
date                
1986-03-14  0.035714
1986-03-17  0.017241
1986-03-18 -0.025424
1986-03-19 -0.017391
1986-03-20 -0.026549
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>ticker</th>
      <th>MSFT</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>9526.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>0.001143</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.021195</td>
    </tr>
    <tr>
      <th>min</th>
      <td>-0.301158</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>-0.009178</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>0.000360</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>0.011318</td>
    </tr>
    <tr>
      <th>max</th>
      <td>0.195652</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_factor</span> <span class="o">=</span> <span class="n">get_factors</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_factor</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="n">df_factor</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>c:\Users\alan.moreira\Anaconda3\lib\site-packages\pandas_datareader\famafrench.py:114: FutureWarning: The argument &#39;date_parser&#39; is deprecated and will be removed in a future version. Please use &#39;date_format&#39; instead, or read your data in as &#39;object&#39; dtype and then call &#39;to_datetime&#39;.
  df = read_csv(StringIO(&quot;Date&quot; + src[start:]), **params)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                 RF  Mkt-RF
Date                       
1963-07-01  0.00012 -0.0067
1963-07-02  0.00012  0.0079
1963-07-03  0.00012  0.0063
1963-07-05  0.00012  0.0040
1963-07-08  0.00012 -0.0063
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>RF</th>
      <th>Mkt-RF</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>15440.000000</td>
      <td>15440.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>0.000173</td>
      <td>0.000279</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.000125</td>
      <td>0.010198</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000</td>
      <td>-0.174400</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>0.000070</td>
      <td>-0.004200</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>0.000180</td>
      <td>0.000500</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>0.000240</td>
      <td>0.005100</td>
    </tr>
    <tr>
      <th>max</th>
      <td>0.000610</td>
      <td>0.113500</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_return</span><span class="p">,</span> <span class="n">df_factor</span> <span class="o">=</span> <span class="n">df_returns</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">df_factor</span><span class="p">,</span> <span class="n">join</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_eret</span><span class="o">=</span><span class="n">df_return</span><span class="p">[</span><span class="s1">&#39;MSFT&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">df_factor</span><span class="p">[</span><span class="s1">&#39;RF&#39;</span><span class="p">]</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">statsmodels.api</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sm</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">df_factor</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>  <span class="c1"># Adds a constant term to the predictor</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df_eret</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                      y   R-squared:                       0.414
Model:                            OLS   Adj. R-squared:                  0.414
Method:                 Least Squares   F-statistic:                     6731.
Date:                Sat, 14 Dec 2024   Prob (F-statistic):               0.00
Time:                        18:51:57   Log-Likelihood:                 25744.
No. Observations:                9526   AIC:                        -5.148e+04
Df Residuals:                    9524   BIC:                        -5.147e+04
Df Model:                           1                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
const          0.0006      0.000      3.690      0.000       0.000       0.001
Mkt-RF         1.1886      0.014     82.045      0.000       1.160       1.217
==============================================================================
Omnibus:                     1397.296   Durbin-Watson:                   1.928
Prob(Omnibus):                  0.000   Jarque-Bera (JB):            20816.444
Skew:                           0.139   Prob(JB):                         0.00
Kurtosis:                      10.237   Cond. No.                         87.2
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">alpha</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">beta</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">var_r</span><span class="o">=</span><span class="n">y</span><span class="o">.</span><span class="n">var</span><span class="p">()</span>
<span class="n">var_f</span><span class="o">=</span><span class="n">X</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">var</span><span class="p">()</span>
<span class="n">var_e</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">resid</span><span class="o">.</span><span class="n">var</span><span class="p">()</span>
<span class="n">mu_f</span><span class="o">=</span><span class="n">X</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Alpha: </span><span class="si">{</span><span class="n">alpha</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Beta: </span><span class="si">{</span><span class="n">beta</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Variance of MSFT returns (var_r): </span><span class="si">{</span><span class="n">var_r</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Variance of market factor (var_f): </span><span class="si">{</span><span class="n">var_f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Variance of residuals (var_e): </span><span class="si">{</span><span class="n">var_e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean of market factor (mu_f): </span><span class="si">{</span><span class="n">mu_f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Alpha: 0.0006136713970132121
Beta: 1.1885965257521751
Variance of MSFT returns (var_r): 0.00044916491215715146
Variance of market factor (var_f): 0.0001316572593818388
Variance of residuals (var_e): 0.00026316457843989904
Mean of market factor (mu_f): 0.00034711316397228635
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\alan.moreira\AppData\Local\Temp\ipykernel_6532\2604691240.py:1: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  alpha=model.params[0]
C:\Users\alan.moreira\AppData\Local\Temp\ipykernel_6532\2604691240.py:2: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  beta=model.params[1]
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><h4 class="rubric" id="stop-and-think">Stop and Think</h4>
<ul class="simple">
<li><p>What frequency are these parmeters? How to I make it comparable say with the annual risk-free rate?</p></li>
<li><p>What does the alpha mean? How should you think about it? Do you think is informative about future MSFT alpha? Why? Why not?</p></li>
<li><p>What about the variance terms? And the covariance terms?</p></li>
</ul>
</div></blockquote>
<p>Lets say we have 1 million dollar per month volatility (i.e. standard deviation) budget</p>
<p>What that means?</p>
<p>Means that the size of my position times the yearly volatility of my position must be less than 1 million dollars?</p>
<blockquote>
<div><p>Why you might impose such a cap?</p>
</div></blockquote>
<p>How much o MSFT can I own?</p>
<ul class="simple">
<li><p>If I invest one dollar in MSFT I get: <span class="math notranslate nohighlight">\(1*\sqrt(var_r*252)\)</span> standard deviation for 1 year</p></li>
<li><p>If I invest one dollar in MSFT I get: <span class="math notranslate nohighlight">\(1*\sqrt(var_r*21)\)</span> standard deviation for 1 month</p></li>
</ul>
<p>To get 1M per month I invest <span class="math notranslate nohighlight">\(\frac{1M}{\sqrt(var_r*21)}\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">var_r</span><span class="o">*</span><span class="mi">252</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
<span class="n">x</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.9723285858071415
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><p>What does that mean? How many million dollars I can buy of the stock?</p>
</div></blockquote>
<p>What if the budget was for 1 month? How many would I be able to buy?</p>
<ol class="arabic simple">
<li><p>What is your expected PnL in the end of the year?</p>
<ul class="simple">
<li><p>Here we will subtract you funding costs, which I will assume is also rf so it will be a wash</p></li>
</ul>
</li>
</ol>
<div class="math notranslate nohighlight">
\[x*(rf+\beta*\mu_f+\alpha-rf)*252\]</div>
<ol class="arabic simple" start="2">
<li><p>What is your Expected PnL after your market exposure is subtracted</p></li>
</ol>
<div class="math notranslate nohighlight">
\[x*(\alpha)*252\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">beta</span><span class="o">*</span><span class="n">mu_f</span><span class="o">+</span><span class="n">alpha</span><span class="p">)</span><span class="o">*</span><span class="mi">252</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">*</span><span class="mi">252</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.7686879316063537
0.4596563249799126
</pre></div>
</div>
</div>
</div>
<p>Now suppose you focus your edge–i.e. investing in MSFT but hedging the market risk</p>
<ol class="arabic simple">
<li><p>How much of the market do I need to short per dollar invested in MSFT?</p></li>
</ol>
<p>you short exactly it’s beta</p>
<div class="math notranslate nohighlight">
\[x_h=-\beta\]</div>
<p>So your portfolio is</p>
<div class="math notranslate nohighlight">
\[x*(stock:1,market:-\beta)\]</div>
<ol class="arabic simple" start="2">
<li><p>How many dollars in MSFT can I buy?</p></li>
</ol>
<div class="math notranslate nohighlight">
\[\frac{1M}{\sqrt(var_e*252)}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xe</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">var_e</span><span class="o">*</span><span class="mi">252</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
<span class="n">xe</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3.8831665045807324
</pre></div>
</div>
</div>
</div>
<p>Why <span class="math notranslate nohighlight">\(var_e\)</span> is the volatility of the hedge portfolio?</p>
<p>Note that the hedged portfolio return is</p>
<div class="math notranslate nohighlight">
\[rh=re-\beta*f=\alpha+\epsilon\]</div>
<p>Note that the OLS regression implies <span class="math notranslate nohighlight">\(E[f\epsilon]=0\)</span></p>
<p>The leftover risk is exactly orthogonal to the factor risk</p>
<p>This what makes this the optimal hedge portfolio–&gt; it hedges all the market risk!</p>
<p>So it follows that</p>
<div class="math notranslate nohighlight">
\[Var(rh)=Var(\alpha+\epsilon)=Var(\epsilon)\]</div>
<ol class="arabic simple">
<li><p>What is you expected “factor-adjusted PnL”?</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xe</span><span class="o">*</span><span class="p">(</span><span class="n">alpha</span><span class="o">*</span><span class="mi">252</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.6005130298526444
</pre></div>
</div>
</div>
</div>
<p>Some shops pay you for your full PnL but Impose constraints on how much factor risk you can have. For example they might impose a maximum 20% of your total risk in factor risk</p>
<p>Are you better off hedging everything anyways? Or do you want to hedge just enough to be at 20%?</p>
<p>How do you know how much to hedge?</p>
<p><strong>Tracking Portfolios</strong></p>
<p>We also refer to it as “hedging portfolios” or “mimicking portfolios”</p>
<p>Tracking portfolios are the portfolios that use a set of factors to track the returns on an asset.</p>
<ul class="simple">
<li><p>It can be used as a way to construct hedges for corporations, hedges for trading strategies, or a way to define a benchmark for an active management.</p></li>
<li><p>It is used to construct what people in the industry calls “portable alpha”, because it allows one to separate the alpha of a trading strategy’s factor exposure</p></li>
<li><p>The idea of the tracking portoflio is to track the component of an asset return that can be obtained by investing in a simple traded factor. For now, this means the market portfolio</p></li>
</ul>
<p>How to do it?</p>
<ul>
<li><p>For a given trading strategy, consider the following relation</p>
<div class="math notranslate nohighlight">
\[r^e_i=\alpha_i+\beta_ir^{MKT}+\epsilon_i, \]</div>
<p>with <span class="math notranslate nohighlight">\(var(\epsilon_i)=\sigma_e^2\)</span></p>
</li>
<li><p>the <span class="math notranslate nohighlight">\(i^{th}\)</span> Tracking portfolio is <span class="math notranslate nohighlight">\(\beta_iW^{MKT}\)</span>, where <span class="math notranslate nohighlight">\(W^{MKT}\)</span> is the vector of weights of the market portfolio.</p></li>
<li><p>or if one is trading directly on the total market portfolio as an asset, the tracking portfolio weight on the market portfolio asset is simply <span class="math notranslate nohighlight">\(\beta_i\)</span></p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>In our case above we say the tracking portfolio of the stock is <span class="math notranslate nohighlight">\(\beta\)</span> and the hedging portfolio -<span class="math notranslate nohighlight">\(\beta\)</span> on the market</p></li>
<li></li>
</ul>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Returns on the tracking portfolio</span>

<span class="n">Portfolio</span><span class="o">=</span><span class="n">df_eret</span>
<span class="n">MKT</span><span class="o">=</span><span class="n">df_factor</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span>
<span class="n">Tracking</span><span class="o">=</span><span class="n">MKT</span><span class="o">*</span><span class="n">beta</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Portfolio</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">Portfolio</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Portfolio</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">Tracking</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/76adae1e115fe17846eef94c291c2e80f91dbde2336640a6e2e69ae687d3837c.png" src="../../_images/76adae1e115fe17846eef94c291c2e80f91dbde2336640a6e2e69ae687d3837c.png" />
</div>
</div>
<p>We see here the obvious fact that we cannot track at all variation in HML with the market portfolio so the capture very different risks</p>
<p><strong>Hedged portfolio</strong></p>
<p>The Hedged strategy return (also called portable alpha) is</p>
<div class="math notranslate nohighlight">
\[r^{hedged}_i=r^e_i-\beta_ir^{MKT}\]</div>
<ul class="simple">
<li><p>This portfolio can be constructed simply by <span class="math notranslate nohighlight">\(W^i-\beta^iW^{MKT}\)</span>, the weights of the trading strategy minus the tracking portfolio weights.</p></li>
<li><p>The excess returns take out risk-free rate effects, and the hedged portfolio takes out market factor effects</p></li>
</ul>
<p>A few observations</p>
<ul class="simple">
<li><p>The mean return of the hedged portfolio is just the time series alpha!</p></li>
<li><p>The volatility of the strategy is the vol of the residuals of the time series regression</p></li>
<li><p>If you run a regression on the market you will see that the hedged portfolios have <span class="math notranslate nohighlight">\(\beta=0\)</span>, which is by construction.</p></li>
<li><p>This is the reason why sometimes people call these portfolios “Pure Alpha”, or as Bridgwater calls it, “Portable Alpha”</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Returns on the hedged portfolio</span>
<span class="n">Hedged</span><span class="o">=</span><span class="n">Portfolio</span><span class="o">-</span><span class="n">Tracking</span>
<span class="n">RF</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">RF</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">MKT</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">MKT</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">MKT</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">Hedged</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="p">(</span><span class="n">Hedged</span><span class="o">/</span><span class="mi">100</span><span class="o">+</span><span class="n">RF</span><span class="o">/</span><span class="mi">100</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">logy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/d0265893267e8ef2fdb418f05457db5a60bcd036aeb21260c433c1d4bf9f667e.png" src="../../_images/d0265893267e8ef2fdb418f05457db5a60bcd036aeb21260c433c1d4bf9f667e.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;Date&#39;&gt;
</pre></div>
</div>
<img alt="../../_images/7a3b94a05c89ef92e976ac9e017881462627abd621e91dd844678dc353efaf4f.png" src="../../_images/7a3b94a05c89ef92e976ac9e017881462627abd621e91dd844678dc353efaf4f.png" />
</div>
</div>
<blockquote>
<div><h4 class="rubric" id="insight">Insight</h4>
<p>The average excess return on the hedged portfolio is the alpha of the unhedged portfolio!
Intuition: The hedged portfolio has mechanically zero beta (in-sample) so it’s excess return is “pure” alpha</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;hedge portfolio excess returns&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Hedged</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">*</span><span class="mi">12</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;alpha of unhedge portfolio&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">alpha</span><span class="o">*</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>hedge portfolio excess returns
2.7509763704390657
alpha of unhedge portfolio
2.7509763704390675
</pre></div>
</div>
</div>
</div>
</section>
<section id="variance-decomposition">
<h2><span class="section-number">5.3. </span>Variance Decomposition<a class="headerlink" href="#variance-decomposition" title="Link to this heading">#</a></h2>
<p>Factor models are essential to manage risk</p>
<p>A pod shop mananager , a manager in a mutual fund in a large mutual fund company, a hedge fund trader in a large hedge fund,…all of those will typically have tight limits on the TOTAL risk of their portfolio, i.e. <span class="math notranslate nohighlight">\(var(r)\)</span> but also on the factor component of their portfolio</p>
<p>But even if you don’t, and you are an active manager with freedom of trading, you still want to control quite carefully how much non-essential risks you are taking in your portfolio</p>
<p>The decomposition here with single factor is really easy, but once you understand it, the multi-factor decomposition will be also easy to understand ( even it a little more involved)</p>
<ol class="arabic simple">
<li><p>The total variance of your strategy/asset is</p></li>
</ol>
<div class="math notranslate nohighlight">
\[Var(r^e)=Var(\alpha +b*f+\epsilon)=Var(b*f)+Var(\epsilon)=b^2Var(f)+var(\epsilon)\]</div>
<p>We can see already the factor part <span class="math notranslate nohighlight">\((b^2Var(f))\)</span> and the idiosyncratic part <span class="math notranslate nohighlight">\(var(\epsilon)\)</span></p>
<ol class="arabic simple" start="2">
<li><p>The fraction of factor risk in your portfolio is</p></li>
</ol>
<div class="math notranslate nohighlight">
\[\frac{b^2Var(f)}{Var(r^e)}\]</div>
<p>You factor risk depends</p>
<ul class="simple">
<li><p>on your factor beta–this might grow in a market turmoil for example</p></li>
<li><p>on the factor variance–also might grow when markets are choppy</p></li>
</ul>
<p>The factor risk-share also depend on the idio vol. During a market turmoil all vols tend to go up, but factor vols tend to go up more
So both your total risk grows as the share of factor risk</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">beta</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">var_f</span><span class="o">/</span><span class="n">var_r</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.4141025460425463
</pre></div>
</div>
</div>
</div>
<p>Suppose I want to get this to the 20% limit. What do I do?</p>
<p>Lets say xh is your position on the market, then your portfolio is</p>
<div class="math notranslate nohighlight">
\[rp=x(1*re+xh*f)\]</div>
<p>You want the factor piece to be less than vbar=20%</p>
<div class="math notranslate nohighlight">
\[Var(rp)=Var(x(1*re+xh*f))=Var(x(1*(\alpha+\beta*f+\epsilon)+xh*f))=Var(x(\beta+xh)*f)+x^2Var(\epsilon)\]</div>
<div class="math notranslate nohighlight">
\[Var(rp)=x^2(\beta+xh)^2*Var(f)+x^2Var(\epsilon)\]</div>
<p>so we need</p>
<div class="math notranslate nohighlight">
\[\frac{x^2(\beta+xh)^2*Var(f)}{x^2(\beta+xh)^2*Var(f)+x^2Var(\epsilon)}=vbar\]</div>
<p>Note that your size of your overall portfolio cancels out.</p>
<p>What matters for the share is your hedge per unit of position</p>
<div class="math notranslate nohighlight">
\[\frac{(\beta+xh)^2*Var(f)}{(\beta+xh)^2*Var(f)+Var(\epsilon)}=vbar\]</div>
<p>reorganizing</p>
<div class="math notranslate nohighlight">
\[(\beta+xh)^2*Var(f)=vbar*((\beta+xh)^2*Var(f)+Var(\epsilon))\]</div>
<div class="math notranslate nohighlight">
\[(1-vbar)(\beta+xh)^2*Var(f)=vbar*Var(\epsilon)\]</div>
<div class="math notranslate nohighlight">
\[(\beta+xh)^2=\frac{vbar*Var(\epsilon)}{(1-vbar)Var(f)}\]</div>
<div class="math notranslate nohighlight">
\[(\beta+xh)=\sqrt{vbar\frac{Var(\epsilon)}{(1-vbar)Var(f)}}\]</div>
<div class="math notranslate nohighlight">
\[xh=\sqrt{\frac{vbar*Var(\epsilon)}{(1-vbar)Var(f)}}-\beta\]</div>
<p>What is the hedge portfolio if you want zero factor risk?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vbar</span><span class="o">=</span><span class="mf">0.2</span>
<span class="n">xh20</span><span class="o">=</span><span class="p">((</span><span class="n">vbar</span><span class="o">*</span><span class="n">var_e</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">vbar</span><span class="p">)</span><span class="o">*</span><span class="n">var_f</span><span class="p">))</span><span class="o">**</span><span class="mf">0.5</span><span class="o">-</span><span class="n">beta</span>
<span class="n">xh20</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-0.4816910986685352
</pre></div>
</div>
</div>
</div>
</section>
<section id="factor-models-means-you-need-to-estimate-less-parameters">
<h2><span class="section-number">5.4. </span>Factor models means you need to estimate LESS parameters<a class="headerlink" href="#factor-models-means-you-need-to-estimate-less-parameters" title="Link to this heading">#</a></h2>
<p>We will see how we can compute covariance matrixes easily under the assumption that the factor captures most sources of co-movement across stocks</p>
<p>In this case the assumption is very bad…and not even close to holding for most assets…but will allow us to get the intuition</p>
<p>We will then learn how to do it with many factors as is standard in the industry</p>
<p>Here I will use i,j for a individual stock</p>
<div class="math notranslate nohighlight">
\[r^{e,i}=\alpha_i+\beta_{i,f}f+\epsilon_{i}\]</div>
<ul class="simple">
<li><p>non-factor component <span class="math notranslate nohighlight">\(\epsilon_i\)</span> of the asset return of asset <span class="math notranslate nohighlight">\(i\)</span>. Assumed to uncorrelated between any two assets</p></li>
</ul>
<p>Now this is just a regression!</p>
<p>We have that</p>
<div class="math notranslate nohighlight">
\[Var(r^{e,i})=\beta_i^2Var(f)+var(\epsilon_{i})\]</div>
<p>This gives us a nice decomposition of risk as we saw above</p>
<ul class="simple">
<li><p>the risk component that is driven by the common factor</p></li>
<li><p>the asset specific comment</p></li>
</ul>
<p>Now if our assumption holds,i.e. the non-factor risk is uncorrelated across assets</p>
<div class="math notranslate nohighlight">
\[cov(\epsilon_{i,t},\epsilon_{j,t})=0\]</div>
<blockquote>
<div><h4 class="rubric" id="this-will-never-hold-in-any-sample-it-is-an-assumption-that-you-impose-after-you-think-that-you-add-enough-factors-to-capture-the-co-movement-across-assets">This will never hold in any sample. It is an assumption that you impose after you think that you add enough factors to capture the  co-movement across assets</h4>
</div></blockquote>
<p>Then</p>
<div class="math notranslate nohighlight">
\[Cov(r_t^{e,i},r_t^{e,j})=Cov(\alpha_i+\beta_{i}f_t+\epsilon_{i,t},\alpha_j+\beta_{j}f_t+\epsilon_{j,t})=\beta_i\beta_jVar(f_t)\]</div>
<p>And the covariance matrix is simply</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\left[\begin{array}{cc}
\beta_i^2 &amp; \beta_i\beta_j \\
\beta_i\beta_j &amp;  \beta_j^2 
\end{array}\right]var(f_t)+\left[\begin{array}{cc}
var(\epsilon_{i,t}) &amp; 0 \\
0&amp;  var(\epsilon_{j,t})
\end{array}\right]\end{split}\]</div>
<p>We see that now for N assets we only need to estimate N factor exposures, N asset specific volatilities , and the factor volatility</p>
<blockquote>
<div><p><span class="math notranslate nohighlight">\(2N+1\)</span> vs <span class="math notranslate nohighlight">\((N^2-N)/2+N\)</span></p>
</div></blockquote>
<p>That is a huge difference</p>
<p>Suppose we have many assets, all respecting this factor model. Say <span class="math notranslate nohighlight">\(R_t^e\)</span> is the big N by 1 vector of excess return <span class="math notranslate nohighlight">\([r_{t}^{e,1},r_{t}^{e,2},...]\)</span> for all these assets</p>
<div class="math notranslate nohighlight">
\[R_t^e=Bf_t+U_t\]</div>
<p>where <span class="math notranslate nohighlight">\(B\)</span> is also a N by 1 vector of exposures <span class="math notranslate nohighlight">\([\beta_1,\beta_2,...\beta_N]\)</span>  and <span class="math notranslate nohighlight">\(u_t\)</span> is the N by 1 vector of shocks <span class="math notranslate nohighlight">\([\epsilon_1,\epsilon_2,...]\)</span></p>
<p>Then their variance-covariance matrix is simply</p>
<div class="math notranslate nohighlight">
\[Var(R^e_t)=B &#64; B' Var(f_t)+ Var(U_t)\]</div>
<ul class="simple">
<li><p>Armed with the variance covariance of assets we have the variance of any portfolio of these assets</p></li>
<li><p>To construct <span class="math notranslate nohighlight">\(Var(U_t)\)</span> you can stack all the residuals of the individual regression in a dataframe and compute the variance</p></li>
<li><p>This will give you a vector S with N numbers, the you can use <code class="docutils literal notranslate"><span class="pre">np.diag(S)</span></code> to created a diagonal matrix with these variances in the diagonal</p></li>
</ul>
<blockquote>
<div><h3 class="rubric" id="practice">Practice</h3>
<ul class="simple">
<li><p>Choose a five  tickers you like plus SPY</p></li>
<li><p>Estimate their unrestricted covariance matrix?</p></li>
<li><p>estimate the single-factor model (single factor=SPY) implied covariance matrix?</p></li>
<li><p>Can you compare the number of parameters you need to estimate in each case?</p></li>
<li><p>Can you discuss if it such model is a good one in this case?</p></li>
</ul>
</div></blockquote>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chapters/Finance"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../scientific/randomness1.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">4.7. </span>Randomness</p>
      </div>
    </a>
    <a class="right-next"
       href="FactorModelEstimation.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">6. </span>Estimation: From historical data to the future dynamics of returns</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#alpha-and-beta-s">5.1. Alpha and Beta(s)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#focus-on-your-skill-hedge-all-the-residual-risk">5.2. Focus on your skill, hedge all the residual risk</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#variance-decomposition">5.3. Variance Decomposition</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#factor-models-means-you-need-to-estimate-less-parameters">5.4. Factor models means you need to estimate LESS parameters</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Alan Moreira
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2021 Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0).
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>