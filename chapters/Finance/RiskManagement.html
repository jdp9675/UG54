
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>15. Risk Management &#8212; Quantitative Investing</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/book.css?v=c2893119" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapters/Finance/RiskManagement';</script>
    <link rel="canonical" href="https://amoreira2.github.io/Fin418/chapters/Finance/RiskManagement.html" />
    <link rel="icon" href="../../_static/figuremain2.jpg"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="16. Trading costs and Liquidity" href="TradingCosts.html" />
    <link rel="prev" title="14.6. 📊 Interpreting Factor Models" href="InterpretingFactorModels.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/figuremain2.jpg" class="logo__image only-light" alt="Quantitative Investing - Home"/>
    <script>document.write(`<img src="../../_static/figuremain2.jpg" class="logo__image only-dark" alt="Quantitative Investing - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../01/what-is-quant-investing.html">1. What is Data Driven Investing?</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../01/statistical-techniques.html">1.1. Statistical Techniques</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01/computational-tools.html">1.2. Computational tools</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../02/getting_started.html">2. Getting Started</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../02/cloud_setup.html">2.3. Cloud Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02/local_install.html">2.4. Local installation</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../essentials/intro.html">3. Python Essentials</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../essentials/basics.html">3.1. Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/collections.html">3.2. Collections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/numpy.html">3.3. Numpy</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../essentials/introtopandas.html">3.4. Pandas</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/the_index.html">3.4.3. Indexing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/timeseries.html">3.4.4. Time-Series</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/reshape.html">3.4.5. Reshape</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/merge.html">3.4.6. Merge</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/groupby.html">3.4.7. Group-by</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/matplotlib.html">3.4.8. Plotting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/data_clean.html">3.4.9. Cleaning data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/storage_formats.html">3.4.10. Data Storage</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/control_flow.html">3.5. Flow control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/functions.html">3.6. Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/plotting.html">3.7. Plotting</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="IntrotoReturns.html">4. Introduction to Asset Returns</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="TheChoiceofFrequency.html">4.5. The Choice of Frequency and Annualization of Returns</a></li>
<li class="toctree-l2"><a class="reference internal" href="UsingAPI.html">4.6. Data APIs</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="FactorModels.html">5. Factor Models</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="PortfolioMath.html">6. Portfolios</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../scientific/linear_algebra1.html">6.5. Linear Algebra Review</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="CapitalAllocationI.html">7. Capital Allocation</a></li>
<li class="toctree-l1"><a class="reference internal" href="FactorModelEstimation.html">8. Factor Model Estimation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="Timing.html">9. Timing Strategies</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="MarketTiming.html">9.1. Expected Returns Timing</a></li>
<li class="toctree-l2"><a class="reference internal" href="Volatilitytiming.html">9.2. Volatility Timing</a></li>

</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="crosssectionalequitystrategies.html">10. Cross-Sectional Equity Strategies</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="Momentum.html">10.3. Momentum factor</a></li>
<li class="toctree-l2"><a class="reference internal" href="Factors.html">10.4. An overview of factors</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="CapitalAllocationII.html">11. Capital Allocation II</a></li>
<li class="toctree-l1"><a class="reference internal" href="Performance_evaluation.html">12. Performance Evaluation</a></li>
<li class="toctree-l1"><a class="reference internal" href="MachineLearning.html">13. Machine Learning in Finance</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="MultiFactorModels.html">14. Multi Factor Models</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="InterpretingFactorModels.html">14.6. 📊 Interpreting Factor Models</a></li>


</ul>
</details></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">15. Risk Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="TradingCosts.html">16. Liquidity and Trading Cost Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="LeverageandShorting.html">17. Leverage, Shorting, and Limits to Arbitrage</a></li>
<li class="toctree-l1"><a class="reference internal" href="GenAIandLLMsinFinance.html">18. Gen AI and LLMs in Finance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../additional/additional.html">19. Additional Statistics Material</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Assignments/Assignments.html">20. Assignments</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment1.html">20.1. Assignment 1</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/amoreira2/Fin418/blob/main/chapters/Finance/RiskManagement.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/amoreira2/Fin418" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/amoreira2/Fin418/issues/new?title=Issue%20on%20page%20%2Fchapters/Finance/RiskManagement.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/chapters/Finance/RiskManagement.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Risk Management</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#risk-taking-if-youre-the-delegate">15.1. Risk Taking If You’re the <strong>Delegate</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#summary-why-this-distinction-matters">15.1.1. 🔁 Summary: Why This Distinction Matters</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#check-your-understanding">15.1.2. ✅ Check Your Understanding</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#from-maximum-losses-to-portfolio-risk">15.1.3. From Maximum Losses to Portfolio Risk</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#risk-budget-constraint">15.1.4. Risk-Budget Constraint</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#managing-factor-risk">15.2. Managing Factor Risk</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#variance-covariance-matrix-estimation">15.3. Variance-Covariance Matrix Estimation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#factor-based-covariance-estimation">15.3.1. Factor-Based Covariance Estimation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#shrinkage-methods">15.3.2. Shrinkage methods</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-will-your-portfolio-risk-change-as-you-add-positions">15.3.3. How will your portfolio risk change as you add positions</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dynamic-risk-management">15.4. Dynamic Risk Management</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tracking-error-mandates">15.5. Tracking Error Mandates</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">To</span> <span class="n">Be</span> <span class="n">Done</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell content</p>
<p class="expanded admonition-title">Hide code cell content</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load libraries</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pandas_datareader.data</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">web</span>
<span class="c1"># define functions  </span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_wrds</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span><span class="n">tickers</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  
    <span class="c1"># Retrieve PERMNOs for the specified tickers</span>
    <span class="n">permnos</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">get_table</span><span class="p">(</span><span class="n">library</span><span class="o">=</span><span class="s1">&#39;crsp&#39;</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="s1">&#39;stocknames&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;permno&#39;</span><span class="p">,</span> <span class="s1">&#39;ticker&#39;</span><span class="p">,</span> <span class="s1">&#39;namedt&#39;</span><span class="p">,</span> <span class="s1">&#39;nameenddt&#39;</span><span class="p">])</span>
    <span class="n">permnos</span><span class="p">[</span><span class="s1">&#39;nameenddt&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">permnos</span><span class="p">[</span><span class="s1">&#39;nameenddt&#39;</span><span class="p">])</span>
    <span class="n">permnos</span> <span class="o">=</span> <span class="n">permnos</span><span class="p">[(</span><span class="n">permnos</span><span class="p">[</span><span class="s1">&#39;ticker&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">tickers</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">permnos</span><span class="p">[</span><span class="s1">&#39;nameenddt&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">permnos</span><span class="p">[</span><span class="s1">&#39;nameenddt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())]</span>
    <span class="c1"># Extract unique PERMNOs</span>
    <span class="n">permno_list</span> <span class="o">=</span> <span class="n">permnos</span><span class="p">[</span><span class="s1">&#39;permno&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">permno_list</span><span class="p">)</span>

    <span class="c1"># Query daily stock file for the specified PERMNOs</span>
    
    <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        SELECT permno, date, ret, retx, prc       </span>
<span class="s2">        FROM crsp.dsf</span>
<span class="s2">        WHERE permno IN (</span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="w"> </span><span class="n">permno_list</span><span class="p">))</span><span class="si">}</span><span class="s2">)</span>
<span class="s2">        ORDER BY date,permno</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="n">returns</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">raw_sql</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">date_cols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])</span>
    <span class="n">returns</span> <span class="o">=</span> <span class="n">returns</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">permnos</span><span class="p">[[</span><span class="s1">&#39;permno&#39;</span><span class="p">,</span> <span class="s1">&#39;ticker&#39;</span><span class="p">]],</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;permno&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
<span class="c1"># Pivot data to have dates as index and tickers as columns</span>
    <span class="n">returns</span> <span class="o">=</span> <span class="n">returns</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;ticker&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;ret&#39;</span><span class="p">)</span>    
    <span class="n">returns</span><span class="o">=</span><span class="n">returns</span><span class="p">[</span><span class="n">tickers</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">returns</span>



<span class="k">def</span><span class="w"> </span><span class="nf">get_factors</span><span class="p">(</span><span class="n">ff6</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    
    <span class="n">fama_french</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="s2">&quot;F-F_Research_Data_5_Factors_2x3_daily&quot;</span><span class="p">,</span> <span class="s2">&quot;famafrench&quot;</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="s2">&quot;1926-01-01&quot;</span><span class="p">)</span>
    <span class="n">daily_data</span> <span class="o">=</span> <span class="n">fama_french</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># The first DataFrame contains the daily data</span>
    <span class="n">daily_data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">daily_data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>  <span class="c1"># Ensure index is datetime</span>
    <span class="k">if</span> <span class="n">ff6</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
        <span class="n">df_factor</span> <span class="o">=</span> <span class="n">daily_data</span><span class="p">[[</span><span class="s1">&#39;RF&#39;</span><span class="p">,</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]]</span>  <span class="c1"># Extract the Risk-Free Rate (RF)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">df_factor</span> <span class="o">=</span> <span class="n">daily_data</span><span class="p">[[</span><span class="s1">&#39;RF&#39;</span><span class="p">,</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">,</span><span class="s1">&#39;SMB&#39;</span><span class="p">,</span><span class="s1">&#39;HML&#39;</span><span class="p">,</span><span class="s1">&#39;RMW&#39;</span><span class="p">,</span><span class="s1">&#39;CMA&#39;</span><span class="p">]]</span>
        <span class="n">fama_french</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="s2">&quot;F-F_Momentum_Factor_daily&quot;</span><span class="p">,</span> <span class="s2">&quot;famafrench&quot;</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="s2">&quot;1926-01-01&quot;</span><span class="p">)</span>
        <span class="n">df_factor</span><span class="o">=</span><span class="n">df_factor</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">fama_french</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">df_factor</span><span class="o">/</span><span class="mi">100</span>
</pre></div>
</div>
</div>
</details>
</div>
<section class="tex2jax_ignore mathjax_ignore" id="risk-management">
<h1><span class="section-number">15. </span>Risk Management<a class="headerlink" href="#risk-management" title="Link to this heading">#</a></h1>
<p>stale text</p>
<p>Fund managers, endowment managers, and professional delegated money managers in general very rarely can allocate capital freely</p>
<p>It is frequently the case that the ultimate investors impose on them a variety of restriction in the investment opportunity set.</p>
<ul class="simple">
<li><p>Restrictions on the sectors they invest</p></li>
<li><p>Restrictions on the whether they can go short</p></li>
<li><p>Restrictions on the use of explicit leverage</p></li>
<li><p>Restrict on the use of derivative and embedded leverage</p></li>
</ul>
<p>These type of restrictions are simple in the sense that they simply limit the set of instruments you are considering.</p>
<p>They are static in nature.</p>
<p>Another set of constraints imposes time-varying restrictions on what the manager can do</p>
<ul class="simple">
<li><p>Risk limits: given a model for risk, it specifies that the portfolio must have variance lower than a certain limit</p></li>
<li><p>Tracking error constraints: given a benchmark, this imposes limits on the portfolio residual risk–the volatility of the portfolio abnormal return relative to the benchmark</p></li>
</ul>
<p>What makes implementation of these limits challenging is that risk is highly time-varying.</p>
<p><strong>🎯 Learning Objectives</strong></p>
<p>In this section we will learn how did deeper into risk management
By the end of this chapter, you should be able to:</p>
<ol class="arabic simple">
<li><p><strong>Think about risk as a delegate</strong></p></li>
<li><p><strong>Build portfolio risk from the ground up</strong></p></li>
<li><p><strong>Decompose factor risk and evaluate best hedging opportunities</strong></p></li>
<li><p><strong>Think about risk dynamically</strong></p></li>
</ol>
<section id="risk-taking-if-youre-the-delegate">
<h2><span class="section-number">15.1. </span>Risk Taking If You’re the <strong>Delegate</strong><a class="headerlink" href="#risk-taking-if-youre-the-delegate" title="Link to this heading">#</a></h2>
<p>Now imagine you’re a <strong>fund manager</strong> investing on behalf of others.</p>
<p>You may be evaluated based on:</p>
<ul class="simple">
<li><p><strong>Performance relative to a benchmark</strong></p></li>
<li><p><strong>Short-term volatility</strong></p></li>
<li><p><strong>Client satisfaction or redemptions</strong></p></li>
</ul>
<p>In this case, your <strong>utility function is no longer your own</strong>. You may also face:</p>
<ul class="simple">
<li><p><strong>Constraints</strong> (e.g., can’t hold too much cash)</p></li>
<li><p><strong>Reputation risks</strong> (doing poorly relative to peers)</p></li>
<li><p><strong>Incentives</strong> tied to short-term returns</p></li>
</ul>
<ul class="simple">
<li><p>The delegate certainly has <strong>stop loss rule</strong>–at some point the principal will pull the plug</p></li>
<li><p>If the manager lose more than that amount they are forced to liquidate their positions and they are likely to be fired</p></li>
<li><p>Such stop loss is particularly biding for new managers</p></li>
<li><p>This stop loss might be explicit: the fund principal literally tells what it is</p></li>
<li><p>But most likely is implicitly–there is a loss that investors will freak out and pull out</p></li>
<li><p>You got to think for yourself and have very clearly what the number is</p></li>
<li><p>Investing as a delegate without that number in mind is reckless</p></li>
</ul>
<hr class="docutils" />
<section id="summary-why-this-distinction-matters">
<h3><span class="section-number">15.1.1. </span>🔁 Summary: Why This Distinction Matters<a class="headerlink" href="#summary-why-this-distinction-matters" title="Link to this heading">#</a></h3>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Perspective</p></th>
<th class="head"><p>Risk Tolerance</p></th>
<th class="head"><p>Goal</p></th>
<th class="head"><p>Constraints</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Principal</p></td>
<td><p>Personal</p></td>
<td><p>Maximize lifetime utility</p></td>
<td><p>Few (internal)</p></td>
</tr>
<tr class="row-odd"><td><p>Delegate</p></td>
<td><p>Institutional</p></td>
<td><p>Maximize performance within mandate</p></td>
<td><p>Many (external)</p></td>
</tr>
</tbody>
</table>
</div>
<p>Understanding whether you’re the principal or delegate affects:</p>
<ul class="simple">
<li><p>Portfolio size,</p></li>
<li><p>Reaction to volatility,</p></li>
<li><p>Interpretation of performance metrics (like Sharpe ratios).</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="check-your-understanding">
<h3><span class="section-number">15.1.2. </span>✅ Check Your Understanding<a class="headerlink" href="#check-your-understanding" title="Link to this heading">#</a></h3>
<p><strong>Q1</strong>: Why might a delegate choose a lower-risk portfolio than a principal?</p>
<details>
<summary>Click to see the answer</summary>
Because delegates often face external constraints and career risks. Their incentives may penalize short-term underperformance, leading them to reduce exposure to volatility—even if it means lower expected returns.
</details>
<hr class="docutils" />
<p>👉 In the next section, we’ll use this framework to build actual portfolios that mix risky and risk-free assets.</p>
</section>
<section id="from-maximum-losses-to-portfolio-risk">
<h3><span class="section-number">15.1.3. </span>From Maximum Losses to Portfolio Risk<a class="headerlink" href="#from-maximum-losses-to-portfolio-risk" title="Link to this heading">#</a></h3>
<p>This might have to move to capital allocation II</p>
<ul class="simple">
<li><p>Lets think in terms of the one-year ahead looses you are comfortable with.</p></li>
<li><p>This can come from your internal judgment or from a stop loss reasoning</p></li>
<li><p>Lets that you want to loose more than L (L is a number like 20%) with probability lower than p (say 5%)</p></li>
</ul>
<div class="math notranslate nohighlight">
\[Prob(rf+xr_p\leq -L)=p\]</div>
<ul class="simple">
<li><p>assume <span class="math notranslate nohighlight">\(rf=\mu\approx 0\)</span>–for example if the horizon is short</p></li>
</ul>
<p>first step is to transform our variable in into a standard normal random variable</p>
<div class="math notranslate nohighlight">
\[Prob(\frac{xrp}{x\sigma(rp)}\leq -\frac{L}{x\sigma(rp)})=p\]</div>
<p>We have that <span class="math notranslate nohighlight">\(\frac{xrp}{x\sigma(rp)}\sim N(0,1)\)</span>, then</p>
<div class="math notranslate nohighlight">
\[F(-\frac{L}{x\sigma(rp)})=p\]</div>
<ul class="simple">
<li><p>Where  F is the CDF of a standard normal, and <span class="math notranslate nohighlight">\(F^{-1}\)</span> is it’s quantile function</p></li>
<li><p>F takes a number in the real line and returns a probability</p></li>
<li><p><span class="math notranslate nohighlight">\(F^{-1}\)</span> take a probability and returns a number in the real line</p></li>
</ul>
<div class="math notranslate nohighlight">
\[F^{-1}(p)x\sigma\geq-L\]</div>
<p>Then</p>
<div class="math notranslate nohighlight">
\[x\sigma\leq-\frac{L}{F^{-1}(p)}\]</div>
<p>Lets do a calculation</p>
<p>for <span class="math notranslate nohighlight">\(p=5 \%\)</span>, <span class="math notranslate nohighlight">\(L=30\%\)</span> what do we get?</p>
<p>Note that you will need the normal quantile function</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">norm</span>
<span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-1.6448536269514729
</pre></div>
</div>
</div>
</div>
<p>You might want to incorporate your views on the portfolio expected return</p>
<ul class="simple">
<li><p>That is relevant in case your horizon is one year or longer.</p></li>
<li><p>For horizons that are 1 month or shorter you are safe ignoring the expected value since the volatility totally dominates it</p></li>
</ul>
<p>You might adjust for deviations from normality by augmenting your losses by a factor <span class="math notranslate nohighlight">\(h\geq1\)</span></p>
<p>The more you invest, the higher the expected growth <span class="math notranslate nohighlight">\(x\mu+rf\)</span>, but also the higher your wealth volatility <span class="math notranslate nohighlight">\(x\sigma\)</span></p>
<div class="math notranslate nohighlight">
\[x(hF^{-1}(p)\sigma+\mu)+rf\geq-\overline{L}\]</div>
<div class="math notranslate nohighlight">
\[x\sigma(hF^{-1}(p)+\frac{\mu}{\sigma})+rf\geq-\overline{L}\]</div>
<p>Now note that <span class="math notranslate nohighlight">\(F^{-1}(p)\)</span> is a negative number and <span class="math notranslate nohighlight">\(\frac{\mu}{\sigma}\)</span> is positive</p>
<p>Lets first assume <span class="math notranslate nohighlight">\(hF^{-1}(p)+\frac{\mu}{\sigma}&lt;0\)</span> which is the realistic case, unless you are <a class="reference external" href="https://en.wikipedia.org/wiki/Jim_Simons">James Simmons</a></p>
<div class="math notranslate nohighlight">
\[x\sigma\leq-\frac{\overline{L}+rf}{(hF^{-1}(p)+\frac{\mu}{\sigma})}\]</div>
<ul class="simple">
<li><p>A higher risk-free rate means you can take more vol (holding L fixed), since you start from a higher expected baseline</p>
<ul>
<li><p>It is natural to have a real rate here since you probably care about your purchasing power</p></li>
</ul>
</li>
<li><p>The higher the Sharpe ratio, the less negative is <span class="math notranslate nohighlight">\(hF^{-1}(p)+\frac{\mu}{\sigma}\)</span> and the higher the volatility you choose to take</p></li>
<li><p>The higher your SR, the less likely you hit that loss!</p></li>
</ul>
<p>Lets plug some numbers with <span class="math notranslate nohighlight">\(rf=1\%\)</span> and SR=0.4 ( that is the market Sharpe ratio)</p>
<div class="math notranslate nohighlight">
\[-\frac{0.3+0.01}{2*(-1.64)+0.4}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">ipywidgets</span><span class="w"> </span><span class="kn">import</span> <span class="n">interact</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">display</span>

<span class="k">def</span><span class="w"> </span><span class="nf">calculate_sigma</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">rf</span><span class="p">):</span>
	<span class="k">return</span> <span class="o">-</span><span class="p">(</span><span class="n">L</span> <span class="o">+</span> <span class="n">rf</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">h</span> <span class="o">*</span> <span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">+</span> <span class="n">sr</span><span class="p">)</span>

<span class="nd">@interact</span><span class="p">(</span><span class="n">StopLoss</span><span class="o">=</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span> <span class="n">p</span><span class="o">=</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">),</span> <span class="n">h</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">SharpeRatio</span><span class="o">=</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">))</span>

<span class="k">def</span><span class="w"> </span><span class="nf">calculate_optimal_vol</span><span class="p">(</span><span class="n">StopLoss</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">SharpeRatio</span><span class="p">,</span> <span class="n">rf</span><span class="o">=</span><span class="mf">0.02</span><span class="p">):</span>
	<span class="n">sigma</span> <span class="o">=</span> <span class="n">calculate_sigma</span><span class="p">(</span><span class="n">StopLoss</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">SharpeRatio</span><span class="p">,</span> <span class="n">rf</span><span class="p">)</span>
	<span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Optimal vol: </span><span class="si">{</span><span class="n">sigma</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2">&quot;</span>
	
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "f17baacd8bd748daa3d294086439b13f", "version_major": 2, "version_minor": 0}</script></div>
</div>
<ul class="simple">
<li><p>What happens if you take a 10% loss?</p></li>
<li><p>What happens if you have a very high SR?</p></li>
<li><p>What happens if you suddenly think returns are very fat tailed?</p></li>
<li></li>
</ul>
</section>
<section id="risk-budget-constraint">
<h3><span class="section-number">15.1.4. </span>Risk-Budget Constraint<a class="headerlink" href="#risk-budget-constraint" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>How this is used in practice?</p></li>
<li><p>In practice a fund or a “trading pod” is allocated some capital and some maximum risk-limits</p></li>
<li><p>If you breach the risk-limit you have to de-risk</p></li>
<li><p>Why is typically so hard to de-risk?</p></li>
<li><p>Think about Melvin Capital (fund that failed during the Gamestop craziness)</p>
<ul>
<li><p>How should you think about de-risking? Should you comply? What is the trade-off?</p></li>
<li><p>What are the incentives the manager faces? What does it depend on?</p></li>
<li><p>How are these incentives different from a wealth individual invest in her own behalf?</p></li>
</ul>
</li>
<li><p>Should our past losses matter for our decision to de-risk?</p></li>
</ul>
</section>
</section>
<section id="managing-factor-risk">
<h2><span class="section-number">15.2. </span>Managing Factor Risk<a class="headerlink" href="#managing-factor-risk" title="Link to this heading">#</a></h2>
<p>The betas measure the exposure of the asset return to the factor, but it does not give an accurate way of thinking which factor drives the most of the variation in the asset as factors can have very different variances</p>
<div class="math notranslate nohighlight">
\[1=\frac{Cov(r^i_t,r^i_t)}{Var(r^i_t)}=\frac{Cov(r^i_t,\sum_j^m \beta_{i,j}f^j_t+\epsilon^i_t)}{Var(r^i_t)}\]</div>
<div class="math notranslate nohighlight">
\[1=\frac{\sum_j^m \beta_{i,j}Cov(r^i_t,f^j_t)+\sigma^2_{\epsilon}}{Var(r^i_t)}\]</div>
<p>The the variance share of factor j is <span class="math notranslate nohighlight">\(\frac{\beta_{i,j}Cov(r^i_t,f^j_t)}{Var(r^i_t)}\)</span> and the share of non-factor variance is <span class="math notranslate nohighlight">\(\frac{\sigma^2_{\epsilon}}{Var(r^i_t)}\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">VarianceDecomposition</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([],</span><span class="n">index</span><span class="o">=</span><span class="n">tickers</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
<span class="n">FactorLoadings</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([],</span><span class="n">index</span><span class="o">=</span><span class="n">tickers</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
<span class="n">VarianceIdiosyncratic</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([],</span><span class="n">index</span><span class="o">=</span><span class="n">tickers</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;epsilon&#39;</span><span class="p">])</span>
<span class="k">for</span> <span class="n">ticker</span> <span class="ow">in</span> <span class="n">tickers</span><span class="p">:</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">df_ETF</span><span class="p">[</span><span class="n">ticker</span><span class="p">]</span>
    <span class="n">Factors</span> <span class="o">=</span> <span class="n">df_factor</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;RF&#39;</span><span class="p">])</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">Factors</span><span class="p">)</span> 
    <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">[</span><span class="n">y</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">==</span><span class="kc">False</span><span class="p">]</span>
    <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="n">y</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">==</span><span class="kc">False</span><span class="p">]</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">dropna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># get the covariance matrix of the factors and the dependent variable</span>
    <span class="n">CovMatrix</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">y</span><span class="p">,</span><span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cov</span><span class="p">()</span>
    <span class="c1"># get the column of the covariance matrix corresponding to the dependent variable and exclude itself to get the covariance of </span>
    <span class="c1"># the dependent variable with each factor</span>
    <span class="n">FactorLoadings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ticker</span><span class="p">,:]</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">VarianceIdiosyncratic</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ticker</span><span class="p">,</span><span class="s1">&#39;epsilon&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">resid</span><span class="o">.</span><span class="n">var</span><span class="p">()</span>
    <span class="n">VarianceDecomposition</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ticker</span><span class="p">,:]</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">*</span><span class="n">CovMatrix</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">y</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span>
    <span class="c1"># Get the residual variance</span>
    <span class="n">VarianceDecomposition</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">ticker</span><span class="p">,</span><span class="s1">&#39;epsilon&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">resid</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="o">/</span><span class="n">y</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span>



<span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">VarianceDecomposition</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Mkt-RF</th>
      <th>SMB</th>
      <th>HML</th>
      <th>RMW</th>
      <th>CMA</th>
      <th>MOM</th>
      <th>epsilon</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>MTUM</th>
      <td>85</td>
      <td>-1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>4</td>
      <td>8.0</td>
    </tr>
    <tr>
      <th>SPMO</th>
      <td>85</td>
      <td>-1</td>
      <td>0</td>
      <td>0</td>
      <td>-1</td>
      <td>2</td>
      <td>13.0</td>
    </tr>
    <tr>
      <th>XMMO</th>
      <td>83</td>
      <td>4</td>
      <td>0</td>
      <td>-1</td>
      <td>0</td>
      <td>-2</td>
      <td>13.0</td>
    </tr>
    <tr>
      <th>IMTM</th>
      <td>68</td>
      <td>-1</td>
      <td>-1</td>
      <td>1</td>
      <td>-1</td>
      <td>-1</td>
      <td>31.0</td>
    </tr>
    <tr>
      <th>XSMO</th>
      <td>70</td>
      <td>16</td>
      <td>1</td>
      <td>-1</td>
      <td>0</td>
      <td>-3</td>
      <td>14.0</td>
    </tr>
    <tr>
      <th>PDP</th>
      <td>90</td>
      <td>1</td>
      <td>-1</td>
      <td>0</td>
      <td>1</td>
      <td>-2</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>JMOM</th>
      <td>90</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>-1</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>DWAS</th>
      <td>64</td>
      <td>23</td>
      <td>-1</td>
      <td>2</td>
      <td>0</td>
      <td>1</td>
      <td>8.0</td>
    </tr>
    <tr>
      <th>VFMO</th>
      <td>82</td>
      <td>7</td>
      <td>-2</td>
      <td>2</td>
      <td>0</td>
      <td>2</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>XSVM</th>
      <td>60</td>
      <td>18</td>
      <td>10</td>
      <td>-2</td>
      <td>0</td>
      <td>1</td>
      <td>10.0</td>
    </tr>
    <tr>
      <th>QMOM</th>
      <td>58</td>
      <td>6</td>
      <td>-2</td>
      <td>3</td>
      <td>0</td>
      <td>7</td>
      <td>23.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>What do we learn?</p>
<p>Decompositions like that extensively in the money management industry</p>
<ul class="simple">
<li><p>Used to classify managers in terms of styles–often called style analysis</p></li>
<li><p>Used to control own portfolio factor risk to satisfy investment mandates</p></li>
</ul>
<p>When looking at a portfolio/fund you have two approaches to measure it’s factor exposures</p>
<ul class="simple">
<li><p>Top down: what we did so far. run a time-series regression of the portfolio returns on the factor return</p></li>
<li><p>Bottom up: from the asset factor exposures build the portfolio factor exposure</p></li>
</ul>
<p>What are the benefits and drawbacks of each?</p>
</section>
<section id="variance-covariance-matrix-estimation">
<h2><span class="section-number">15.3. </span>Variance-Covariance Matrix Estimation<a class="headerlink" href="#variance-covariance-matrix-estimation" title="Link to this heading">#</a></h2>
<p>A key step in measuring risk well is to have a good estimate of the covariance-matrix</p>
<p>The covariance matrixes can be thought as two pieces</p>
<ul class="simple">
<li><p>The overall variance of each asset</p></li>
<li><p>The degree of co-movement between them, i.e. the correlation</p></li>
</ul>
<p>The variance piece tends to be easier–for each asset you need to estimate one moment</p>
<p>The correlation is harder because as the assets grow, the number of correlation grows explosively</p>
<p>Here three different approaches to estimate a portfolio risk</p>
<p>Notation:</p>
<ul class="simple">
<li><p>a vector of asset excess returns R (N by 1),</p></li>
<li><p>weights W (N by 1),</p></li>
</ul>
<p>You can estimate your portfolio variance in three different ways</p>
<ul class="simple">
<li><p>Var(W’R): compute the portfolio in sample return variance</p></li>
<li><p>W’Var(R)W: Compute the individual assets variance-covariance matrix</p></li>
<li><p>Var(W’ &#64;(A+Bf+U)): Use a factor model</p></li>
<li><p>Note that in the first method we skip the estimation of the covariance-matrix and estimated the variance of the portfolio directly</p>
<ul>
<li><p>For example, that is the approach that we we take to estimate the market portfolio variance</p></li>
<li><p>You are assuming that</p></li>
</ul>
</li>
<li><p>What are the advantages and disadvantages of each approach?</p></li>
<li><p>Which approach is unlikely to work well for funds that trade a lot?</p></li>
<li><p>Which approach needs more data?</p></li>
</ul>
<p><span class="math notranslate nohighlight">\(Var(R)\)</span> can be very large</p>
<ul class="simple">
<li><p>For N assets, this means estimating <span class="math notranslate nohighlight">\((N^2-N)/2\)</span> correlations and N variances</p></li>
<li><p>With limited time-series data our estimator will mistake chance for real relationships</p></li>
</ul>
<p>We need need to impose something in the data.</p>
<ol class="arabic simple">
<li><p>Use factor models:</p>
<ul class="simple">
<li><p>Essentially assume that all co-movement is captured by the factors</p></li>
<li><p>any residual co-movement is noise and we assume it is zero (even if the data says it is not)</p></li>
</ul>
</li>
<li><p>Shrink the covariance matrix:</p>
<ul class="simple">
<li><p>We shrink all correlations to zero</p></li>
<li><p>shrink all variances to the average</p></li>
</ul>
</li>
</ol>
<section id="factor-based-covariance-estimation">
<h3><span class="section-number">15.3.1. </span>Factor-Based Covariance Estimation<a class="headerlink" href="#factor-based-covariance-estimation" title="Link to this heading">#</a></h3>
<p>Notation</p>
<div class="math notranslate nohighlight">
\[R_t=B&#64;F_t+u_t\]</div>
<p>where</p>
<ul class="simple">
<li><p>B is N by M</p></li>
<li><p>F is M by 1</p></li>
<li><p>u is N by 1</p></li>
</ul>
<p>Then the variance-covariance matrix is</p>
<div class="math notranslate nohighlight">
\[Var(R_t)=B&#64;Var(F_t)&#64;B.T+Var(U_t)\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Var_F</span><span class="o">=</span><span class="n">Factors</span><span class="o">.</span><span class="n">cov</span><span class="p">()</span>
<span class="n">Cov</span><span class="o">=</span><span class="n">FactorLoadings</span> <span class="o">@</span> <span class="n">Var_F</span> <span class="o">@</span> <span class="n">FactorLoadings</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">VarianceIdiosyncratic</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="n">Cov</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MTUM</th>
      <th>SPMO</th>
      <th>XMMO</th>
      <th>IMTM</th>
      <th>XSMO</th>
      <th>PDP</th>
      <th>JMOM</th>
      <th>DWAS</th>
      <th>VFMO</th>
      <th>XSVM</th>
      <th>QMOM</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>MTUM</th>
      <td>0.00016</td>
      <td>0.000143</td>
      <td>0.000155</td>
      <td>0.000117</td>
      <td>0.000152</td>
      <td>0.000158</td>
      <td>0.000141</td>
      <td>0.000175</td>
      <td>0.000159</td>
      <td>0.000139</td>
      <td>0.000169</td>
    </tr>
    <tr>
      <th>SPMO</th>
      <td>0.000143</td>
      <td>0.000159</td>
      <td>0.00015</td>
      <td>0.000114</td>
      <td>0.000146</td>
      <td>0.000152</td>
      <td>0.000137</td>
      <td>0.000166</td>
      <td>0.000152</td>
      <td>0.000138</td>
      <td>0.00016</td>
    </tr>
    <tr>
      <th>XMMO</th>
      <td>0.000155</td>
      <td>0.00015</td>
      <td>0.0002</td>
      <td>0.000127</td>
      <td>0.000178</td>
      <td>0.000171</td>
      <td>0.000153</td>
      <td>0.000203</td>
      <td>0.000175</td>
      <td>0.000173</td>
      <td>0.000184</td>
    </tr>
    <tr>
      <th>IMTM</th>
      <td>0.000117</td>
      <td>0.000114</td>
      <td>0.000127</td>
      <td>0.000136</td>
      <td>0.000128</td>
      <td>0.000127</td>
      <td>0.000115</td>
      <td>0.000144</td>
      <td>0.000129</td>
      <td>0.000127</td>
      <td>0.000133</td>
    </tr>
    <tr>
      <th>XSMO</th>
      <td>0.000152</td>
      <td>0.000146</td>
      <td>0.000178</td>
      <td>0.000128</td>
      <td>0.000227</td>
      <td>0.000173</td>
      <td>0.000154</td>
      <td>0.000223</td>
      <td>0.000184</td>
      <td>0.000198</td>
      <td>0.000192</td>
    </tr>
    <tr>
      <th>PDP</th>
      <td>0.000158</td>
      <td>0.000152</td>
      <td>0.000171</td>
      <td>0.000127</td>
      <td>0.000173</td>
      <td>0.000187</td>
      <td>0.000154</td>
      <td>0.000198</td>
      <td>0.000174</td>
      <td>0.000163</td>
      <td>0.000184</td>
    </tr>
    <tr>
      <th>JMOM</th>
      <td>0.000141</td>
      <td>0.000137</td>
      <td>0.000153</td>
      <td>0.000115</td>
      <td>0.000154</td>
      <td>0.000154</td>
      <td>0.000152</td>
      <td>0.000173</td>
      <td>0.000154</td>
      <td>0.000148</td>
      <td>0.00016</td>
    </tr>
    <tr>
      <th>DWAS</th>
      <td>0.000175</td>
      <td>0.000166</td>
      <td>0.000203</td>
      <td>0.000144</td>
      <td>0.000223</td>
      <td>0.000198</td>
      <td>0.000173</td>
      <td>0.000284</td>
      <td>0.000215</td>
      <td>0.000218</td>
      <td>0.000229</td>
    </tr>
    <tr>
      <th>VFMO</th>
      <td>0.000159</td>
      <td>0.000152</td>
      <td>0.000175</td>
      <td>0.000129</td>
      <td>0.000184</td>
      <td>0.000174</td>
      <td>0.000154</td>
      <td>0.000215</td>
      <td>0.000195</td>
      <td>0.000177</td>
      <td>0.000196</td>
    </tr>
    <tr>
      <th>XSVM</th>
      <td>0.000139</td>
      <td>0.000138</td>
      <td>0.000173</td>
      <td>0.000127</td>
      <td>0.000198</td>
      <td>0.000163</td>
      <td>0.000148</td>
      <td>0.000218</td>
      <td>0.000177</td>
      <td>0.000252</td>
      <td>0.000175</td>
    </tr>
    <tr>
      <th>QMOM</th>
      <td>0.000169</td>
      <td>0.00016</td>
      <td>0.000184</td>
      <td>0.000133</td>
      <td>0.000192</td>
      <td>0.000184</td>
      <td>0.00016</td>
      <td>0.000229</td>
      <td>0.000196</td>
      <td>0.000175</td>
      <td>0.000281</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="shrinkage-methods">
<h3><span class="section-number">15.3.2. </span>Shrinkage methods<a class="headerlink" href="#shrinkage-methods" title="Link to this heading">#</a></h3>
<p>Say our covariance in the data is <span class="math notranslate nohighlight">\(Var(R)\)</span></p>
<p>We will then construct our estimator as</p>
<div class="math notranslate nohighlight">
\[\hat{Var}=(1-\tau)Var(R)+\tau I\sigma^2_avg\]</div>
<ul class="simple">
<li><p>the <span class="math notranslate nohighlight">\(\tau\)</span> parameter is the amount of shrinkage</p></li>
<li><p>the worse the data is the more you apply</p></li>
<li><p>In the limit al correlations are zero and all variances are the same</p></li>
<li><p>Sometimes people mix and match–using a factor model and then shrink the residuals covariance matrix</p></li>
<li><p>Particularly sensible approach when we know differences in factor exposures are important</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tau</span><span class="o">=</span><span class="mf">0.5</span>
<span class="n">var_avg</span><span class="o">=</span><span class="n">df_ret</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="n">N</span><span class="o">=</span><span class="n">df_ret</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">Var_shrink</span><span class="o">=</span><span class="n">df_ret</span><span class="o">.</span><span class="n">cov</span><span class="p">()</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">tau</span><span class="p">)</span><span class="o">+</span><span class="n">tau</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><p>Conceptual check</p>
</div></blockquote>
<p>Suppose you are trying to construct the minimum variance portfolio–say you think expected returns are undistinguishable across the funds, so you simply want to minimize variance</p>
<p>your optimal weight, if you knew the covariance matrix is</p>
<div class="math notranslate nohighlight">
\[1'Var(R^e)^{-1}\]</div>
<ul class="simple">
<li><p>If we compare the in-sample Variance of our minimum variance portfolios for</p>
<ul>
<li><p>The unrestricted case</p></li>
<li><p>The single-factor covariance</p></li>
<li><p>The multi-factor covariance</p></li>
<li><p>The shrinkage case</p></li>
</ul>
</li>
<li><p>which one will have lowest variance? What will have the highest?</p></li>
<li><p>Now split the sample in two. Repeat the covariance estimation procedure for each of these approaches for the first half of the sample</p></li>
<li><p>Now use the weights to compute the variance of each of the portfolios in the second half</p></li>
<li><p>Is the order likely to change?</p></li>
</ul>
</section>
<section id="how-will-your-portfolio-risk-change-as-you-add-positions">
<h3><span class="section-number">15.3.3. </span>How will your portfolio risk change as you add positions<a class="headerlink" href="#how-will-your-portfolio-risk-change-as-you-add-positions" title="Link to this heading">#</a></h3>
<p>You have portfolio <span class="math notranslate nohighlight">\(X_0\)</span> and you want to sell w of your positions to invest in a fund with portfolio <span class="math notranslate nohighlight">\(X_1\)</span>. How your portfolio variance will change as a function of you reallocation?</p>
<ul class="simple">
<li><p>The answer is simple</p></li>
</ul>
<div class="math notranslate nohighlight">
\[Var(wX_1R_t+(1-w)X_0R_t)-Var(X_0R_t)\]</div>
<ul class="simple">
<li><p>But also kind of misleading since you might not have good data to estimate the variance of the new portfolio</p></li>
<li><p>Now if you know each portfolio factor betas,<span class="math notranslate nohighlight">\(\beta_0=X_0&#64;B\)</span> and <span class="math notranslate nohighlight">\(\beta_1=X_1&#64;B\)</span> , and at least one of this portfolio is large and well diversified, then for small tilts, i.e. <span class="math notranslate nohighlight">\(w\)</span> small, we have</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\frac{Var(wX_1R_t+(1-w)X_0R_t)-Var(X_0R_t)}{\Delta w}|_{w\approx 0} =\beta_1Var(F)\beta_0'\]</div>
<ul class="simple">
<li><p>The fact that one is well diversified just means that you can ignore the covariance-terms of the portfolios asset specific risks</p></li>
<li><p>So you see above why a large pool of money when allocating money to an active manager will want to regulate their factor exposure</p></li>
<li><p>funds with similar volatilities will be perceived as very different risks depending on how the exposure of portfolio relates to the exposure of the fund</p></li>
</ul>
<p>For example, look at how your portfolio risk change if you go from an equal weighted portfolio of these ETFS to just investing in one of them, say MTUM</p>
<p>Here I will use i,j for a individual stock</p>
<div class="math notranslate nohighlight">
\[r^{e,i}=\alpha_i+\beta_{i,f}f+u_{i}\]</div>
<ul class="simple">
<li><p>non-factor component <span class="math notranslate nohighlight">\(u_i\)</span> of the asset return of asset <span class="math notranslate nohighlight">\(i\)</span>. Assumed to uncorrelated between any two assets</p></li>
</ul>
<p>Now this is just a regression!</p>
<p>We have that</p>
<div class="math notranslate nohighlight">
\[Var(r^{e,i})=\beta_i^2Var(f)+var(u_{i})\]</div>
<p>Now to harvest the power of the factor model for risk management we need to make a big assumption</p>
<div class="math notranslate nohighlight">
\[cov(u_{i,t},u_{j,t})=0\]</div>
<p>The assumption here is that our factors–in this case a single factor–captures all the co-movement across stocks</p>
<p>This is very strong assumption if you just have a single factor</p>
<p>But gets closer to the truth as you saturate the model with factors (funds use 10-100 factors!)</p>
<p>This assumption is essential to make progress otherwise we are just moving the estimation problem</p>
<p>With this assumption pairwise covariances are fully captured by the factor exposures</p>
<div class="math notranslate nohighlight">
\[Cov(r_t^{e,i},r_t^{e,j})=Cov(\alpha_i+\beta_{i}f_t+u_{i,t},\alpha_j+\beta_{j}f_t+u_{j,t})=\beta_i\beta_jVar(f_t)\]</div>
<p>And the covariance matrix is simply</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\left[\begin{array}{cc}
\beta_i^2 &amp; \beta_i\beta_j \\
\beta_i\beta_j &amp;  \beta_j^2 
\end{array}\right]var(f_t)+\left[\begin{array}{cc}
var(\epsilon_{i,t}) &amp; 0 \\
0&amp;  var(\epsilon_{j,t})
\end{array}\right]\end{split}\]</div>
<p>We see that now for N assets we only need to estimate N factor exposures, N asset specific volatilities , and the factor volatility</p>
<p>If we were estimating a variance-covariance matrix without imposing the factor model we would have to estimate N covariances and <span class="math notranslate nohighlight">\((N^2-N)/2\)</span> covariance terms: <span class="math notranslate nohighlight">\(2N+1\)</span> vs <span class="math notranslate nohighlight">\((N^2-N)/2+N\)</span> is huge as N grows</p>
<blockquote>
<div><p><strong>Practice</strong></p>
<ul class="simple">
<li><p>Choose a a few tickers  tickers you like plus SPY</p></li>
<li><p>Estimate their unrestricted covariance matrix</p></li>
<li><p>Estimate the single-factor model (single factor=SPY)</p></li>
<li><p>Build the factor implied covariance matrix</p></li>
<li><p>Can you compare the number of parameters you need to estimate in each case</p></li>
<li><p>Can you discuss if it such model is a good one in this case</p></li>
<li><p>Can you calculate the implied portfolio variance for a set of weights of your choosing?</p></li>
</ul>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pandas_datareader.data</span><span class="w"> </span><span class="kn">import</span> <span class="n">DataReader</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>


<span class="c1"># first we connect with WRDS database using the wrds package so we need to install it first and import it</span>
<span class="o">%</span><span class="k">pip</span> install wrds
<span class="kn">import</span><span class="w"> </span><span class="nn">wrds</span>
<span class="c1"># lets connect with  the wrds database</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">wrds</span><span class="o">.</span><span class="n">Connection</span><span class="p">()</span>

<span class="c1"># get our stock returns</span>
<span class="n">Tickers</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;WMT&#39;</span><span class="p">,</span><span class="s1">&#39;JPM&#39;</span><span class="p">,</span><span class="s1">&#39;AAPL&#39;</span><span class="p">,</span><span class="s1">&#39;MSFT&#39;</span><span class="p">,</span><span class="s1">&#39;GOOGL&#39;</span><span class="p">,</span><span class="s1">&#39;AMZN&#39;</span><span class="p">,</span><span class="s1">&#39;META&#39;</span><span class="p">,</span><span class="s1">&#39;TSLA&#39;</span><span class="p">,</span><span class="s1">&#39;NVDA&#39;</span><span class="p">,</span><span class="s1">&#39;BRK.B&#39;</span><span class="p">]</span>
<span class="n">df</span><span class="o">=</span><span class="n">get_daily_wrds</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span><span class="n">tickers</span><span class="o">=</span><span class="n">Tickers</span><span class="p">)</span>

<span class="c1"># GET RISK FREE RATE</span>
<span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1960</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># Start date (adjust as needed)</span>
<span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>          <span class="c1"># End date</span>
<span class="n">df_rf</span> <span class="o">=</span> <span class="n">DataReader</span><span class="p">(</span><span class="s2">&quot;DGS3MO&quot;</span><span class="p">,</span> <span class="s2">&quot;fred&quot;</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)</span>
<span class="n">df_rf</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_rf</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="s2">&quot;rf&quot;</span><span class="p">]</span>
<span class="n">df_rf</span><span class="o">.</span><span class="n">rf</span><span class="o">=</span><span class="n">df_rf</span><span class="o">.</span><span class="n">rf</span><span class="o">/</span><span class="mi">100</span>
<span class="n">df_rf</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># merge with the risk-free rate</span>
<span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_rf</span><span class="o">/</span><span class="mi">252</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">df_re</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;rf&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rf&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">df_re</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;Date&#39;&gt;
</pre></div>
</div>
<img alt="../../_images/96fe965a6328450d9a4c9d8687504d76d674e8726a23d321778f012499256198.png" src="../../_images/96fe965a6328450d9a4c9d8687504d76d674e8726a23d321778f012499256198.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_ff6</span><span class="o">=</span><span class="n">get_factors</span><span class="p">(</span><span class="s1">&#39;ff6&#39;</span><span class="p">,</span><span class="n">freq</span><span class="o">=</span><span class="s1">&#39;daily&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;RF&#39;</span><span class="p">])</span>
<span class="n">df_ff6</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>

<span class="c1"># Define the factors and the market factor</span>

<span class="n">factor</span> <span class="o">=</span> <span class="s1">&#39;Mkt-RF&#39;</span>
<span class="n">df_factor</span><span class="o">=</span><span class="n">df_ff6</span><span class="p">[</span><span class="n">factor</span><span class="p">]</span>
<span class="n">df_merged</span> <span class="o">=</span> <span class="n">df_re</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_factor</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>
<span class="n">df_merged</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">statsmodels.api</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sm</span>


<span class="c1"># Initialize lists to store the results</span>

<span class="n">Beta</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">residuals</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Alpha_se</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1"># Run univariate regressions</span>
<span class="c1"># here we are running a regression of each factor on the market factor</span>
<span class="k">for</span> <span class="n">stock</span> <span class="ow">in</span> <span class="n">Tickers</span><span class="p">:</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">df_merged</span><span class="p">[</span><span class="n">factor</span><span class="p">])</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">df_merged</span><span class="p">[</span><span class="n">stock</span><span class="p">]</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    <span class="n">Beta</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">factor</span><span class="p">])</span>
    <span class="c1"># I am storying the entire time-series of residuals</span>
    <span class="n">residuals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">resid</span><span class="p">)</span>


<span class="n">Beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Beta</span><span class="p">)</span>

<span class="n">VarF</span><span class="o">=</span><span class="n">df_merged</span><span class="p">[</span><span class="n">factor</span><span class="p">]</span><span class="o">.</span><span class="n">var</span><span class="p">()</span>
<span class="c1"># Calculate the variance-covariance matrix of the residuals</span>
<span class="n">residuals_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span>
<span class="n">VarU</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">residuals_matrix</span><span class="p">)</span>
<span class="c1">#now under the assumption that the residuals are uncorrelated ( they are not!)</span>


<span class="n">VarU_uncorr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">residuals_matrix</span><span class="o">.</span><span class="n">T</span><span class="p">)))</span>


<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Beta:&quot;</span><span class="p">,</span> <span class="n">Beta</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;VarU:&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">VarU</span><span class="o">*</span><span class="mi">12</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;VarU_uncorr:&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">VarU_uncorr</span><span class="o">*</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Alpha: [0.00324195 0.04349594 0.03955175 0.04143328 0.08341451]
Beta: [ 0.19954208 -0.13719646 -0.09352601 -0.16246303 -0.16205943]
Sigma_e:
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 1.00563313e-02, -9.24337485e-04, -2.82466739e-03,
        -5.14453377e-04,  1.36587317e-06],
       [-9.24337485e-04,  1.01484903e-02,  3.74978561e-04,
         4.47136746e-03, -3.41595108e-03],
       [-2.82466739e-03,  3.74978561e-04,  5.70013428e-03,
        -3.92044656e-04,  5.51842057e-04],
       [-5.14453377e-04,  4.47136746e-03, -3.92044656e-04,
         4.46193077e-03, -7.83303223e-04],
       [ 1.36587317e-06, -3.41595108e-03,  5.51842057e-04,
        -7.83303223e-04,  2.03162979e-02]])
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Sigma_e_uncorr:
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[0.00083899, 0.        , 0.        , ..., 0.        , 0.        ,
        0.        ],
       [0.        , 0.00270649, 0.        , ..., 0.        , 0.        ,
        0.        ],
       [0.        , 0.        , 0.00027303, ..., 0.        , 0.        ,
        0.        ],
       ...,
       [0.        , 0.        , 0.        , ..., 0.01326286, 0.        ,
        0.        ],
       [0.        , 0.        , 0.        , ..., 0.        , 0.00629202,
        0.        ],
       [0.        , 0.        , 0.        , ..., 0.        , 0.        ,
        0.00475249]])
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="dynamic-risk-management">
<h2><span class="section-number">15.4. </span>Dynamic Risk Management<a class="headerlink" href="#dynamic-risk-management" title="Link to this heading">#</a></h2>
<p>The variance of a portfolio is</p>
<div class="math notranslate nohighlight">
\[Var_t(X_tR^e_{t+1})\]</div>
<p>where</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(X_t\)</span> is your portfolio weights in date t for investment in date t+1,</p></li>
<li><p><span class="math notranslate nohighlight">\(R_{t+1}\)</span> is the vector of asset excess returns during the holding period, i.e. from date <span class="math notranslate nohighlight">\(t\)</span> to date <span class="math notranslate nohighlight">\(t+1\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(Var_t()\)</span> denotes the variance of this random variable given all we know in date <span class="math notranslate nohighlight">\(t\)</span></p></li>
</ul>
<p>The idea here is</p>
<ul class="simple">
<li><p>Correlations do change, but they change slower than variance so we will use standard rolling window to estimate correlations–essentially assuming that they are constant in our forecast horizon.</p></li>
<li><p>And use our model to forecast the the variance</p></li>
</ul>
<p>IF returns have a factor structure we have</p>
<div class="math notranslate nohighlight">
\[Var_t(R_{t+1})=Var(\beta_t F_{t+1}+u_{t+1})=\beta_t Var_t(F) \beta_t'+Var_t(u)\]</div>
<p>We thus need to produce time-varying estimates</p>
<ul class="simple">
<li><p>For betas</p></li>
<li><p>For factor covariance matrix</p></li>
<li><p>For each asset specific idiosyncratic volatility</p></li>
</ul>
<blockquote>
<div><p>There is no right way of estimating these things
Whatever works best out of sample</p>
</div></blockquote>
<ul class="simple">
<li><p>We already discussed good approaches to estimate betas and variances (Chapter 8)</p></li>
<li><p>Here we simply put these estimates together</p></li>
<li><p>One new trick to estimate factor covariances is to build it from correlations and variance estimates</p>
<ul>
<li><p>This is useful because correlations tend to move slower than variances</p></li>
<li><p>(One can use this trick to estimate betas as well)</p></li>
</ul>
</li>
<li><p>We often will rely on the fact that we believe we can measure high frequency variation in market volatility better than in the other factors</p></li>
<li><p>Together with the fact that vols tend to move together it is natural to make assumptions like</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\Sigma_{u,t}=\Sigma_{u}*\frac{\sigma^2_{market,t}}{\sigma^2_{market}}\]</div>
<div class="math notranslate nohighlight">
\[\Sigma_{F,t}=diag(\Sigma_{F,t})^{1/2}Corr~diag(\Sigma_{F})^{1/2}\]</div>
<ul class="simple">
<li><p>where Corr is the correlation coming from a 2-5 year moving sample</p></li>
<li><p>diag(\Sigma_{F})^{1/2} is a diagonal matrix with factor volatilities estimated at much higher frequencies</p>
<ul>
<li><p>Realized variance for the factor (using daily and even intra-day data)</p></li>
<li><p>Garch/ARCH models</p></li>
<li><p>Option implied volatility (specially for the market, but VIX can be useful more broadly)</p></li>
</ul>
</li>
</ul>
<p>Below we will do an example where we build a covariance matrix using this “mixed frequency” approach</p>
</section>
<section id="tracking-error-mandates">
<h2><span class="section-number">15.5. </span>Tracking Error Mandates<a class="headerlink" href="#tracking-error-mandates" title="Link to this heading">#</a></h2>
<p>Active managers operating in a  mutual often have limits on how much they can deviate from their benchmark</p>
<p>This happens at the same time that they have incentives to beat it , i.e. their value added is <span class="math notranslate nohighlight">\(E[R-R^b]\)</span></p>
<blockquote>
<div><p>What is the difference between this notion of value added and alpha?</p>
</div></blockquote>
<p>The tracking error is simply the volatility of a relative return</p>
<div class="math notranslate nohighlight">
\[\sqrt{Var(R-R^b)}\]</div>
<p>In the ideal scenario  you have a constant edge relative to the benchmark–no no tracking error–but still value added</p>
<p>Of course that is virtually impossible, so you accept some tracking error to get some extra</p>
<ul class="simple">
<li><p>You are effectively short the benchmark</p></li>
<li><p>To zero your vol you simply hold the benchmark portfolio</p></li>
</ul>
<p>Benchmarks are typically tradable. A very common one is the S&amp;P500</p>
<p>Your tracking error has two parts</p>
<div class="math notranslate nohighlight">
\[Var(R-R^b)=Var(\alpha+\beta R^b+u-R^b)=(\beta-1)^2Var(R^b)+var(u)\]</div>
<p>The first piece is your exposure to the benchmark.</p>
<ul class="simple">
<li><p>How can you get this piece to zero? Is it costly?</p></li>
</ul>
<p>The second piece is everything else</p>
<ul class="simple">
<li><p>how can you get to zero? is it costly?</p></li>
</ul>
<p>Your value added also has two pieces</p>
<div class="math notranslate nohighlight">
\[E[R-R^b]=\alpha+(\beta-1)E[R^b]\]</div>
<ul class="simple">
<li><p>If benchmark has positive premium you can “beat it” simply by investing in higher beta stocks! (or leveraging up)</p></li>
<li><p>For example if you have no original ideas and have a track record allowance of 5% how much value added you can produce?</p>
<ul>
<li><p>What your answer depends on?</p></li>
</ul>
</li>
<li><p>Suppose you also have good trading ideas, i.e. alpha, how do you trade-off beta and alpha if your goal is to maximize value added?</p></li>
<li><p>How is this related to the “betting against beta” phenomena?</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chapters/Finance"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="InterpretingFactorModels.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">14.6. </span>📊 Interpreting Factor Models</p>
      </div>
    </a>
    <a class="right-next"
       href="TradingCosts.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">16. </span>Trading costs and Liquidity</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#risk-taking-if-youre-the-delegate">15.1. Risk Taking If You’re the <strong>Delegate</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#summary-why-this-distinction-matters">15.1.1. 🔁 Summary: Why This Distinction Matters</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#check-your-understanding">15.1.2. ✅ Check Your Understanding</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#from-maximum-losses-to-portfolio-risk">15.1.3. From Maximum Losses to Portfolio Risk</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#risk-budget-constraint">15.1.4. Risk-Budget Constraint</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#managing-factor-risk">15.2. Managing Factor Risk</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#variance-covariance-matrix-estimation">15.3. Variance-Covariance Matrix Estimation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#factor-based-covariance-estimation">15.3.1. Factor-Based Covariance Estimation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#shrinkage-methods">15.3.2. Shrinkage methods</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-will-your-portfolio-risk-change-as-you-add-positions">15.3.3. How will your portfolio risk change as you add positions</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dynamic-risk-management">15.4. Dynamic Risk Management</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tracking-error-mandates">15.5. Tracking Error Mandates</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Alan Moreira
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2021 Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0).
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>