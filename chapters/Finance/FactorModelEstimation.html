
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>8. Estimation: From historical data to the future dynamics of returns &#8212; Quantitative Investing</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/book.css?v=c2893119" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapters/Finance/FactorModelEstimation';</script>
    <link rel="canonical" href="https://amoreira2.github.io/Fin418/chapters/Finance/FactorModelEstimation.html" />
    <link rel="icon" href="../../_static/figuremain2.jpg"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="9. Timing" href="Timing.html" />
    <link rel="prev" title="7. Capital Allocation" href="CapitalAllocationI.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/figuremain2.jpg" class="logo__image only-light" alt="Quantitative Investing - Home"/>
    <script>document.write(`<img src="../../_static/figuremain2.jpg" class="logo__image only-dark" alt="Quantitative Investing - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../01/what-is-quant-investing.html">1. What is Data Driven Investing?</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../01/statistical-techniques.html">1.1. Statistical Techniques</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01/computational-tools.html">1.2. Computational tools</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../02/getting_started.html">2. Getting Started</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../02/cloud_setup.html">2.3. Cloud Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02/local_install.html">2.4. Local installation</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../essentials/intro.html">3. Python Essentials</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../essentials/basics.html">3.1. Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/collections.html">3.2. Collections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/numpy.html">3.3. Numpy</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../essentials/introtopandas.html">3.4. Pandas</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/the_index.html">3.4.3. Indexing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/timeseries.html">3.4.4. Time-Series</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/reshape.html">3.4.5. Reshape</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/merge.html">3.4.6. Merge</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/groupby.html">3.4.7. Group-by</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/matplotlib.html">3.4.8. Plotting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/data_clean.html">3.4.9. Cleaning data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/storage_formats.html">3.4.10. Data Storage</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/control_flow.html">3.5. Flow control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/functions.html">3.6. Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/plotting.html">3.7. Plotting</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="IntrotoReturns.html">4. Introduction to Asset Returns</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="TheChoiceofFrequency.html">4.5. The Choice of Frequency and Annualization of Returns</a></li>
<li class="toctree-l2"><a class="reference internal" href="UsingAPI.html">4.6. Data APIs</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="FactorModels.html">5. Factor Models</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="PortfolioMath.html">6. Portfolios</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../scientific/linear_algebra1.html">6.5. Linear Algebra Review</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="CapitalAllocationI.html">7. Capital Allocation</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">8. Factor Model Estimation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="Timing.html">9. Timing Strategies</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="MarketTiming.html">9.1. Expected Returns Timing</a></li>
<li class="toctree-l2"><a class="reference internal" href="Volatilitytiming.html">9.2. Volatility Timing</a></li>

</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="crosssectionalequitystrategies.html">10. Cross-Sectional Equity Strategies</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="Momentum.html">10.3. Momentum factor</a></li>
<li class="toctree-l2"><a class="reference internal" href="Factors.html">10.4. An overview of factors</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="CapitalAllocationII.html">11. Capital Allocation II</a></li>
<li class="toctree-l1"><a class="reference internal" href="Performance_evaluation.html">12. Performance Evaluation</a></li>
<li class="toctree-l1"><a class="reference internal" href="MachineLearning.html">13. Machine Learning in Finance</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="MultiFactorModels.html">14. Multi Factor Models</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="InterpretingFactorModels.html">14.6. 📊 Interpreting Factor Models</a></li>


</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="RiskManagement.html">15. Risk Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="TradingCosts.html">16. Liquidity and Trading Cost Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="LeverageandShorting.html">17. Leverage, Shorting, and Limits to Arbitrage</a></li>
<li class="toctree-l1"><a class="reference internal" href="GenAIandLLMsinFinance.html">18. Gen AI and LLMs in Finance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../additional/additional.html">19. Additional Statistics Material</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Assignments/Assignments.html">20. Assignments</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment1.html">20.1. Assignment 1</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/amoreira2/Fin418/blob/main/chapters/Finance/FactorModelEstimation.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/amoreira2/Fin418" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/amoreira2/Fin418/issues/new?title=Issue%20on%20page%20%2Fchapters/Finance/FactorModelEstimation.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/chapters/Finance/FactorModelEstimation.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Estimation: From historical data to the future dynamics of returns</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-do-we-need-to-know-to-invest">8.1. What do we need to know to invest?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#betas">8.2. Betas</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exponential-decay-models">8.2.1. Exponential decay models</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#variances">8.3. Variances</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#indio-vol">8.3.1. Indio Vol</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cross-section-vs-time-series">8.3.2. Cross-Section vs Time-series</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#expected-returns">8.4. Expected returns</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#factor-risk-premia">8.4.1. Factor Risk-Premia</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#alpha-is-all-you-need">8.4.2. Alpha is all you need</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#alpha-quantification-procedure">8.4.2.1. Alpha Quantification Procedure</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#real-alpha-is-unique-and-cannot-be-driven-by-broad-macro-factors">8.4.2.2. Real Alpha is unique and cannot be driven by broad macro factors</a></li>
</ul>
</li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="cell tag_hide-cell docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell content</p>
<p class="expanded admonition-title">Hide code cell content</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load libraries</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas_datareader.data</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">web</span>
<span class="c1"># define functions  </span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_daily_wrds</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span><span class="n">tickers</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  
    <span class="c1"># Retrieve PERMNOs for the specified tickers</span>
    <span class="n">permnos</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">get_table</span><span class="p">(</span><span class="n">library</span><span class="o">=</span><span class="s1">&#39;crsp&#39;</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="s1">&#39;stocknames&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;permno&#39;</span><span class="p">,</span> <span class="s1">&#39;ticker&#39;</span><span class="p">,</span> <span class="s1">&#39;namedt&#39;</span><span class="p">,</span> <span class="s1">&#39;nameenddt&#39;</span><span class="p">])</span>
    <span class="n">permnos</span><span class="p">[</span><span class="s1">&#39;nameenddt&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">permnos</span><span class="p">[</span><span class="s1">&#39;nameenddt&#39;</span><span class="p">])</span>
    <span class="n">permnos</span> <span class="o">=</span> <span class="n">permnos</span><span class="p">[(</span><span class="n">permnos</span><span class="p">[</span><span class="s1">&#39;ticker&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">tickers</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">permnos</span><span class="p">[</span><span class="s1">&#39;nameenddt&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">permnos</span><span class="p">[</span><span class="s1">&#39;nameenddt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())]</span>
    <span class="c1"># Extract unique PERMNOs</span>
    <span class="n">permno_list</span> <span class="o">=</span> <span class="n">permnos</span><span class="p">[</span><span class="s1">&#39;permno&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">permno_list</span><span class="p">)</span>

    <span class="c1"># Query daily stock file for the specified PERMNOs</span>
    
    <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        SELECT permno, date, ret, retx, prc       </span>
<span class="s2">        FROM crsp.dsf</span>
<span class="s2">        WHERE permno IN (</span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="w"> </span><span class="n">permno_list</span><span class="p">))</span><span class="si">}</span><span class="s2">)</span>
<span class="s2">        ORDER BY date,permno</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="n">daily_returns</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">raw_sql</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">date_cols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])</span>
    <span class="n">daily_returns</span> <span class="o">=</span> <span class="n">daily_returns</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">permnos</span><span class="p">[[</span><span class="s1">&#39;permno&#39;</span><span class="p">,</span> <span class="s1">&#39;ticker&#39;</span><span class="p">]],</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;permno&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
<span class="c1"># Pivot data to have dates as index and tickers as columns</span>
    <span class="n">daily_returns</span> <span class="o">=</span> <span class="n">daily_returns</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;ticker&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;ret&#39;</span><span class="p">)</span>    
    <span class="n">daily_returns</span><span class="o">=</span><span class="n">daily_returns</span><span class="p">[</span><span class="n">tickers</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">daily_returns</span>


<span class="k">def</span><span class="w"> </span><span class="nf">get_factors</span><span class="p">(</span><span class="n">factors</span><span class="o">=</span><span class="s1">&#39;CAPM&#39;</span><span class="p">):</span>   
    <span class="k">if</span> <span class="n">factors</span><span class="o">==</span><span class="s1">&#39;CAPM&#39;</span><span class="p">:</span>
        <span class="n">fama_french</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="s2">&quot;F-F_Research_Data_Factors_daily&quot;</span><span class="p">,</span> <span class="s2">&quot;famafrench&quot;</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="s2">&quot;1921-01-01&quot;</span><span class="p">)</span>
        <span class="n">daily_data</span> <span class="o">=</span> <span class="n">fama_french</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">daily_data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">daily_data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">df_factor</span> <span class="o">=</span> <span class="n">daily_data</span><span class="p">[[</span><span class="s1">&#39;RF&#39;</span><span class="p">,</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]]</span> 
    <span class="k">elif</span> <span class="n">factors</span><span class="o">==</span><span class="s1">&#39;FF3&#39;</span><span class="p">:</span>
        <span class="n">fama_french</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="s2">&quot;F-F_Research_Data_Factors_daily&quot;</span><span class="p">,</span> <span class="s2">&quot;famafrench&quot;</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="s2">&quot;1921-01-01&quot;</span><span class="p">)</span>
        <span class="n">daily_data</span> <span class="o">=</span> <span class="n">fama_french</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">daily_data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">daily_data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">df_factor</span> <span class="o">=</span> <span class="n">daily_data</span><span class="p">[[</span><span class="s1">&#39;RF&#39;</span><span class="p">,</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">,</span><span class="s1">&#39;SMB&#39;</span><span class="p">,</span><span class="s1">&#39;HML&#39;</span><span class="p">]]</span>
    <span class="k">elif</span> <span class="n">factors</span><span class="o">==</span><span class="s1">&#39;FF5&#39;</span><span class="p">:</span>
        <span class="n">fama_french</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="s2">&quot;F-F_Research_Data_5_Factors_2x3_daily&quot;</span><span class="p">,</span> <span class="s2">&quot;famafrench&quot;</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="s2">&quot;1921-01-01&quot;</span><span class="p">)</span>
        <span class="n">daily_data</span> <span class="o">=</span> <span class="n">fama_french</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">daily_data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">daily_data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">df_factor</span> <span class="o">=</span> <span class="n">daily_data</span><span class="p">[[</span><span class="s1">&#39;RF&#39;</span><span class="p">,</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">,</span><span class="s1">&#39;SMB&#39;</span><span class="p">,</span><span class="s1">&#39;HML&#39;</span><span class="p">,</span><span class="s1">&#39;RMW&#39;</span><span class="p">,</span><span class="s1">&#39;CMA&#39;</span><span class="p">]]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fama_french</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="s2">&quot;F-F_Research_Data_5_Factors_2x3_daily&quot;</span><span class="p">,</span> <span class="s2">&quot;famafrench&quot;</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="s2">&quot;1921-01-01&quot;</span><span class="p">)</span>
        <span class="n">daily_data</span> <span class="o">=</span> <span class="n">fama_french</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">daily_data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">daily_data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">df_factor</span> <span class="o">=</span> <span class="n">daily_data</span><span class="p">[[</span><span class="s1">&#39;RF&#39;</span><span class="p">,</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">,</span><span class="s1">&#39;SMB&#39;</span><span class="p">,</span><span class="s1">&#39;HML&#39;</span><span class="p">,</span><span class="s1">&#39;RMW&#39;</span><span class="p">,</span><span class="s1">&#39;CMA&#39;</span><span class="p">]]</span>
        <span class="n">fama_french</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="s2">&quot;F-F_Momentum_Factor_daily&quot;</span><span class="p">,</span> <span class="s2">&quot;famafrench&quot;</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="s2">&quot;1921-01-01&quot;</span><span class="p">)</span>
        <span class="n">df_factor</span><span class="o">=</span><span class="n">df_factor</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">fama_french</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>    

    <span class="k">return</span> <span class="n">df_factor</span><span class="o">/</span><span class="mi">100</span>
</pre></div>
</div>
</div>
</details>
</div>
<section class="tex2jax_ignore mathjax_ignore" id="estimation-from-historical-data-to-the-future-dynamics-of-returns">
<h1><span class="section-number">8. </span>Estimation: From historical data to the future dynamics of returns<a class="headerlink" href="#estimation-from-historical-data-to-the-future-dynamics-of-returns" title="Link to this heading">#</a></h1>
<hr class="docutils" />
<p><strong>🎯 Learning Objectives</strong></p>
<p>By the end of this chapter, you should be able to:</p>
<ol class="arabic simple">
<li><p><strong>The six inputs to a factor model</strong><br />
List exactly what must be estimated to forecast an asset’s distribution—risk-free rate, beta, factor risk-premium, alpha, factor variance, idiosyncratic variance.</p></li>
<li><p><strong>Estimate β accurately.</strong><br />
Practice running rolling regressions and understand when a cross-section or a time-series approach delivers a more reliable exposure.</p></li>
<li><p><strong>Measure variances two ways.</strong><br />
Compare cross-sectional dispersion in a single month with time-series volatility of one asset; recognize when each view is informative.</p></li>
<li><p><strong>Form expectations for factor risk-premia.</strong><br />
Use long‐sample averages when premia are thought to be stable, and learn warning signs that the mean may have shifted.</p></li>
<li><p><strong>Appreciate why “alpha is all you need”—and why it’s elusive.</strong><br />
Recognize that true alpha is scarce, tends to decay quickly, and often disappears once too much capital piles in.</p></li>
<li><p><strong>Identify practical paths to alpha.</strong><br />
Examine valuation edge, liquidity-provision trades, and alternative data as real-world ways investors create forecastable idiosyncratic returns.</p></li>
<li><p><strong>Standardize alpha across horizons.</strong><br />
Convert any price target or event view into a monthly (or other chosen) alpha so different ideas can be compared on the same scale.</p></li>
<li><p><strong>Guard against hidden macro bets.</strong><br />
Test that a proposed alpha is not simply a disguised market or sector exposure; if it is, rethink whether hedging or a broader position is more efficient.</p></li>
</ol>
<hr class="docutils" />
<p>We have been working with a single asset, since factor model</p>
<p>Realized returns:</p>
<div class="math notranslate nohighlight">
\[r=rf+\alpha + b(f-rf)+\epsilon\]</div>
<p>Expected  returns</p>
<div class="math notranslate nohighlight">
\[E[r]=rf+\alpha + b*E[f]\]</div>
<p>Expected excess returns</p>
<div class="math notranslate nohighlight">
\[E[r^{e}]=\alpha + b*E[f]\]</div>
<p>Variance:</p>
<div class="math notranslate nohighlight">
\[Var(r)=b^2Var(f-rf)+Var(\epsilon)\]</div>
<p>To know the expected returns of your investment you need</p>
<ol class="arabic simple">
<li><p>The risk-free rate</p></li>
<li><p>The beta</p></li>
<li><p>The factor risk-premia</p></li>
<li><p>The asset specific alpha</p></li>
</ol>
<p>To know the risk/variance of your investment you need</p>
<ol class="arabic simple" start="5">
<li><p>The factor variance</p></li>
<li><p>The asset specific variance</p></li>
</ol>
<section id="what-do-we-need-to-know-to-invest">
<h2><span class="section-number">8.1. </span>What do we need to know to invest?<a class="headerlink" href="#what-do-we-need-to-know-to-invest" title="Link to this heading">#</a></h2>
<p>Do you want to know how this stock behaved in the past?</p>
<p>Do we want to know how it behaved in the recent past?</p>
<p>When should we care about historical data?</p>
<p>We need to know these parameters for our investment period, say next month or next year</p>
<p>Some of those we observe directly in financial markets like the risk-free rate–financial markets tell you exactly how much your will ear goign forward</p>
<p>others we need to use some data to form our views</p>
<p>I will discuss each one by one</p>
</section>
<section id="betas">
<h2><span class="section-number">8.2. </span>Betas<a class="headerlink" href="#betas" title="Link to this heading">#</a></h2>
<p>Factors models are all about the time-series co-movement between assets and some common factors. For now we are focused on single factors models, but we will soon be thinking about multiple-factors at the same time.</p>
<p>For now we will focus on factors that can be expressed in excess returns, like the returns on the market portfolio. Practicioners often use characteristics as direct proxys for beta–we will see that later. This is useful when we have many factors…but does not work to the most important factor of all–the market factor.</p>
<p>Fundamentally any risk-factor can be represented in terms of a return of a specific portfolio.</p>
<p>The beta that we are interested is the forward-looking degree of co-movement between the asset and the factor</p>
<p>Specifically it is</p>
<div class="math notranslate nohighlight">
\[\beta_t=\frac{Cov_t(r_{t+1}^{e},f_{t+1})}{var_t(f_{t+1})}\]</div>
<ul class="simple">
<li><p>What this notation means?</p></li>
<li><p>It is asking to what extent the asset returns are above it’s expected values when the factor is above it’s expected value</p></li>
<li><p>It normalizes everything by the variance of the factor</p></li>
<li><p>So a beta of 1 means that the asset is EXPECTED to move 1 for 1 with the factor</p></li>
<li><p>But of course it can have some additional idio risk on top</p></li>
<li><p>The subscripts in the covariance and variance means that it is these moments from the perspective of someone that has all the informationup to  date <span class="math notranslate nohighlight">\(t\)</span></p></li>
<li><p>That is, you don’t know the particular realization of the variables</p></li>
</ul>
<p>How do we estimate betas?</p>
<p>We run a regression!</p>
<p>We typically do not use the whole sample when using individual stocks–stocks behavior change. So we want the most up to date behavior–but cannot be too short otherwise you cannot say anything as estimation uncertainty will be very high!</p>
<p>Academic literature likes to use between 1 year to 2 years if using daily data</p>
<p>(when working with illiquid stocks daily data might be problematic and weekly or monthly might be more advisable, but the sample period will have to be increased. For example, for monthly people use 5 years)</p>
<p>We will focus on simple regressions, and briefly discuss alternatives</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># In colab you always need to install wrds each time you start a notebook</span>
<span class="c1">#%pip install wrds</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">wrds</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span> <span class="o">=</span> <span class="n">wrds</span><span class="o">.</span><span class="n">Connection</span><span class="p">()</span>
<span class="n">ticker</span><span class="o">=</span><span class="s1">&#39;GE&#39;</span>
<span class="n">df_returns</span> <span class="o">=</span> <span class="n">get_daily_wrds</span><span class="p">(</span><span class="n">conn</span><span class="p">,[</span><span class="n">ticker</span><span class="p">])</span>
<span class="n">df_factor</span> <span class="o">=</span> <span class="n">get_factors</span><span class="p">()</span>
<span class="n">df_return</span><span class="p">,</span> <span class="n">df_factor</span> <span class="o">=</span> <span class="n">df_returns</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">df_factor</span><span class="p">,</span> <span class="n">join</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">df_eret</span><span class="o">=</span><span class="n">df_return</span><span class="p">[</span><span class="n">ticker</span><span class="p">]</span><span class="o">-</span><span class="n">df_factor</span><span class="p">[</span><span class="s1">&#39;RF&#39;</span><span class="p">]</span>
<span class="n">df_eret</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">OperationalError</span><span class="g g-Whitespace">                          </span>Traceback (most recent call last)
<span class="nn">File c:\Users\alan.moreira\Anaconda3\lib\site-packages\sqlalchemy\engine\base.py:145,</span> in <span class="ni">Connection.__init__</span><span class="nt">(self, engine, connection, _has_events, _allow_revalidate, _allow_autobegin)</span>
<span class="g g-Whitespace">    </span><span class="mi">144</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">145</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_dbapi_connection</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">raw_connection</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">146</span> <span class="k">except</span> <span class="n">dialect</span><span class="o">.</span><span class="n">loaded_dbapi</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>

<span class="nn">File c:\Users\alan.moreira\Anaconda3\lib\site-packages\sqlalchemy\engine\base.py:3293,</span> in <span class="ni">Engine.raw_connection</span><span class="nt">(self)</span>
<span class="g g-Whitespace">   </span><span class="mi">3272</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;Return a &quot;raw&quot; DBAPI connection from the connection pool.</span>
<span class="g g-Whitespace">   </span><span class="mi">3273</span><span class="sd"> </span>
<span class="g g-Whitespace">   </span><span class="mi">3274</span><span class="sd"> The returned object is a proxied version of the DBAPI</span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">   </span><span class="mi">3291</span><span class="sd"> </span>
<span class="g g-Whitespace">   </span><span class="mi">3292</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="ne">-&gt; </span><span class="mi">3293</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>

<span class="nn">File c:\Users\alan.moreira\Anaconda3\lib\site-packages\sqlalchemy\pool\base.py:452,</span> in <span class="ni">Pool.connect</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">445</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;Return a DBAPI connection from the pool.</span>
<span class="g g-Whitespace">    </span><span class="mi">446</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">447</span><span class="sd"> The connection is instrumented such that when its</span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">    </span><span class="mi">450</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">451</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">452</span> <span class="k">return</span> <span class="n">_ConnectionFairy</span><span class="o">.</span><span class="n">_checkout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<span class="nn">File c:\Users\alan.moreira\Anaconda3\lib\site-packages\sqlalchemy\pool\base.py:1269,</span> in <span class="ni">_ConnectionFairy._checkout</span><span class="nt">(cls, pool, threadconns, fairy)</span>
<span class="g g-Whitespace">   </span><span class="mi">1268</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">fairy</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">1269</span>     <span class="n">fairy</span> <span class="o">=</span> <span class="n">_ConnectionRecord</span><span class="o">.</span><span class="n">checkout</span><span class="p">(</span><span class="n">pool</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1271</span>     <span class="k">if</span> <span class="n">threadconns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

<span class="nn">File c:\Users\alan.moreira\Anaconda3\lib\site-packages\sqlalchemy\pool\base.py:716,</span> in <span class="ni">_ConnectionRecord.checkout</span><span class="nt">(cls, pool)</span>
<span class="g g-Whitespace">    </span><span class="mi">715</span> <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">716</span>     <span class="n">rec</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">_do_get</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">718</span> <span class="k">try</span><span class="p">:</span>

<span class="nn">File c:\Users\alan.moreira\Anaconda3\lib\site-packages\sqlalchemy\pool\impl.py:170,</span> in <span class="ni">QueuePool._do_get</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">169</span> <span class="k">with</span> <span class="n">util</span><span class="o">.</span><span class="n">safe_reraise</span><span class="p">():</span>
<span class="ne">--&gt; </span><span class="mi">170</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_dec_overflow</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">171</span> <span class="k">raise</span>

<span class="nn">File c:\Users\alan.moreira\Anaconda3\lib\site-packages\sqlalchemy\util\langhelpers.py:146,</span> in <span class="ni">safe_reraise.__exit__</span><span class="nt">(self, type_, value, traceback)</span>
<span class="g g-Whitespace">    </span><span class="mi">145</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_exc_info</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># remove potential circular references</span>
<span class="ne">--&gt; </span><span class="mi">146</span>     <span class="k">raise</span> <span class="n">exc_value</span><span class="o">.</span><span class="n">with_traceback</span><span class="p">(</span><span class="n">exc_tb</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">147</span> <span class="k">else</span><span class="p">:</span>

<span class="nn">File c:\Users\alan.moreira\Anaconda3\lib\site-packages\sqlalchemy\pool\impl.py:167,</span> in <span class="ni">QueuePool._do_get</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">166</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">167</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_connection</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">168</span> <span class="k">except</span><span class="p">:</span>

<span class="nn">File c:\Users\alan.moreira\Anaconda3\lib\site-packages\sqlalchemy\pool\base.py:393,</span> in <span class="ni">Pool._create_connection</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">391</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;Called by subclasses to create a new ConnectionRecord.&quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">393</span> <span class="k">return</span> <span class="n">_ConnectionRecord</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<span class="nn">File c:\Users\alan.moreira\Anaconda3\lib\site-packages\sqlalchemy\pool\base.py:678,</span> in <span class="ni">_ConnectionRecord.__init__</span><span class="nt">(self, pool, connect)</span>
<span class="g g-Whitespace">    </span><span class="mi">677</span> <span class="k">if</span> <span class="n">connect</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">678</span>     <span class="bp">self</span><span class="o">.</span><span class="n">__connect</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">679</span> <span class="bp">self</span><span class="o">.</span><span class="n">finalize_callback</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>

<span class="nn">File c:\Users\alan.moreira\Anaconda3\lib\site-packages\sqlalchemy\pool\base.py:903,</span> in <span class="ni">_ConnectionRecord.__connect</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">902</span>     <span class="k">with</span> <span class="n">util</span><span class="o">.</span><span class="n">safe_reraise</span><span class="p">():</span>
<span class="ne">--&gt; </span><span class="mi">903</span>         <span class="n">pool</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Error on connect(): </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">904</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">905</span>     <span class="c1"># in SQLAlchemy 1.4 the first_connect event is not used by</span>
<span class="g g-Whitespace">    </span><span class="mi">906</span>     <span class="c1"># the engine, so this will usually not be set</span>

<span class="nn">File c:\Users\alan.moreira\Anaconda3\lib\site-packages\sqlalchemy\util\langhelpers.py:146,</span> in <span class="ni">safe_reraise.__exit__</span><span class="nt">(self, type_, value, traceback)</span>
<span class="g g-Whitespace">    </span><span class="mi">145</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_exc_info</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># remove potential circular references</span>
<span class="ne">--&gt; </span><span class="mi">146</span>     <span class="k">raise</span> <span class="n">exc_value</span><span class="o">.</span><span class="n">with_traceback</span><span class="p">(</span><span class="n">exc_tb</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">147</span> <span class="k">else</span><span class="p">:</span>

<span class="nn">File c:\Users\alan.moreira\Anaconda3\lib\site-packages\sqlalchemy\pool\base.py:898,</span> in <span class="ni">_ConnectionRecord.__connect</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">897</span> <span class="bp">self</span><span class="o">.</span><span class="n">starttime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="ne">--&gt; </span><span class="mi">898</span> <span class="bp">self</span><span class="o">.</span><span class="n">dbapi_connection</span> <span class="o">=</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">_invoke_creator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">899</span> <span class="n">pool</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Created new connection </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">connection</span><span class="p">)</span>

<span class="nn">File c:\Users\alan.moreira\Anaconda3\lib\site-packages\sqlalchemy\engine\create.py:645,</span> in <span class="ni">create_engine.&lt;locals&gt;.connect</span><span class="nt">(connection_record)</span>
<span class="g g-Whitespace">    </span><span class="mi">643</span>             <span class="k">return</span> <span class="n">connection</span>
<span class="ne">--&gt; </span><span class="mi">645</span> <span class="k">return</span> <span class="n">dialect</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="o">*</span><span class="n">cargs</span><span class="p">,</span> <span class="o">**</span><span class="n">cparams</span><span class="p">)</span>

<span class="nn">File c:\Users\alan.moreira\Anaconda3\lib\site-packages\sqlalchemy\engine\default.py:616,</span> in <span class="ni">DefaultDialect.connect</span><span class="nt">(self, *cargs, **cparams)</span>
<span class="g g-Whitespace">    </span><span class="mi">614</span> <span class="k">def</span><span class="w"> </span><span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">cargs</span><span class="p">,</span> <span class="o">**</span><span class="n">cparams</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">615</span>     <span class="c1"># inherits the docstring from interfaces.Dialect.connect</span>
<span class="ne">--&gt; </span><span class="mi">616</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">loaded_dbapi</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="o">*</span><span class="n">cargs</span><span class="p">,</span> <span class="o">**</span><span class="n">cparams</span><span class="p">)</span>

<span class="nn">File c:\Users\alan.moreira\Anaconda3\lib\site-packages\psycopg2\__init__.py:122,</span> in <span class="ni">connect</span><span class="nt">(dsn, connection_factory, cursor_factory, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">121</span> <span class="n">dsn</span> <span class="o">=</span> <span class="n">_ext</span><span class="o">.</span><span class="n">make_dsn</span><span class="p">(</span><span class="n">dsn</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">122</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">_connect</span><span class="p">(</span><span class="n">dsn</span><span class="p">,</span> <span class="n">connection_factory</span><span class="o">=</span><span class="n">connection_factory</span><span class="p">,</span> <span class="o">**</span><span class="n">kwasync</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">123</span> <span class="k">if</span> <span class="n">cursor_factory</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

<span class="ne">OperationalError</span>: connection to server at &quot;wrds-pgdata.wharton.upenn.edu&quot; (165.123.60.118), port 9737 failed: Connection refused (0x0000274D/10061)
	<span class="n">Is</span> <span class="n">the</span> <span class="n">server</span> <span class="n">running</span> <span class="n">on</span> <span class="n">that</span> <span class="n">host</span> <span class="ow">and</span> <span class="n">accepting</span> <span class="n">TCP</span><span class="o">/</span><span class="n">IP</span> connections<span class="o">?</span>


<span class="n">The</span> <span class="n">above</span> <span class="n">exception</span> <span class="n">was</span> <span class="n">the</span> <span class="n">direct</span> <span class="n">cause</span> <span class="n">of</span> <span class="n">the</span> <span class="n">following</span> <span class="n">exception</span><span class="p">:</span>

<span class="ne">OperationalError</span><span class="g g-Whitespace">                          </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">wrds</span><span class="o">.</span><span class="n">Connection</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">ticker</span><span class="o">=</span><span class="s1">&#39;GE&#39;</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">df_returns</span> <span class="o">=</span> <span class="n">get_daily_wrds</span><span class="p">(</span><span class="n">conn</span><span class="p">,[</span><span class="n">ticker</span><span class="p">])</span>

<span class="nn">File c:\Users\alan.moreira\Anaconda3\lib\site-packages\wrds\sql.py:75,</span> in <span class="ni">Connection.__init__</span><span class="nt">(self, autoconnect, verbose, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">72</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connect_args</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;wrds_connect_args&quot;</span><span class="p">,</span> <span class="n">WRDS_CONNECT_ARGS</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">74</span> <span class="k">if</span> <span class="n">autoconnect</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">75</span>     <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">76</span>     <span class="bp">self</span><span class="o">.</span><span class="n">load_library_list</span><span class="p">()</span>

<span class="nn">File c:\Users\alan.moreira\Anaconda3\lib\site-packages\wrds\sql.py:116,</span> in <span class="ni">Connection.connect</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">114</span> <span class="bp">self</span><span class="o">.</span><span class="n">_username</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_password</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_user_credentials</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">115</span> <span class="c1"># Last attempt, raise error if Exception encountered</span>
<span class="ne">--&gt; </span><span class="mi">116</span> <span class="bp">self</span><span class="o">.</span><span class="n">__make_sa_engine_conn</span><span class="p">(</span><span class="n">raise_err</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">118</span> <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">119</span>     <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to connect </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_username</span><span class="si">}</span><span class="s2">@</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_hostname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nn">File c:\Users\alan.moreira\Anaconda3\lib\site-packages\wrds\sql.py:99,</span> in <span class="ni">Connection.__make_sa_engine_conn</span><span class="nt">(self, raise_err)</span>
<span class="g g-Whitespace">     </span><span class="mi">97</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine</span> <span class="o">=</span> <span class="kc">None</span>
<span class="g g-Whitespace">     </span><span class="mi">98</span> <span class="k">if</span> <span class="n">raise_err</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">99</span>     <span class="k">raise</span> <span class="n">err</span>

<span class="nn">File c:\Users\alan.moreira\Anaconda3\lib\site-packages\wrds\sql.py:93,</span> in <span class="ni">Connection.__make_sa_engine_conn</span><span class="nt">(self, raise_err)</span>
<span class="g g-Whitespace">     </span><span class="mi">87</span> <span class="k">try</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">88</span>     <span class="bp">self</span><span class="o">.</span><span class="n">engine</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">create_engine</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">89</span>         <span class="n">pguri</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">90</span>         <span class="n">isolation_level</span><span class="o">=</span><span class="s2">&quot;AUTOCOMMIT&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">91</span>         <span class="n">connect_args</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_connect_args</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">92</span>     <span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">93</span>     <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">94</span> <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">95</span>     <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_verbose</span><span class="p">:</span>

<span class="nn">File c:\Users\alan.moreira\Anaconda3\lib\site-packages\sqlalchemy\engine\base.py:3269,</span> in <span class="ni">Engine.connect</span><span class="nt">(self)</span>
<span class="g g-Whitespace">   </span><span class="mi">3246</span> <span class="k">def</span><span class="w"> </span><span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Connection</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">3247</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;Return a new :class:`_engine.Connection` object.</span>
<span class="g g-Whitespace">   </span><span class="mi">3248</span><span class="sd"> </span>
<span class="g g-Whitespace">   </span><span class="mi">3249</span><span class="sd">     The :class:`_engine.Connection` acts as a Python context manager, so</span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">   </span><span class="mi">3266</span><span class="sd"> </span>
<span class="g g-Whitespace">   </span><span class="mi">3267</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">-&gt; </span><span class="mi">3269</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection_cls</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<span class="nn">File c:\Users\alan.moreira\Anaconda3\lib\site-packages\sqlalchemy\engine\base.py:147,</span> in <span class="ni">Connection.__init__</span><span class="nt">(self, engine, connection, _has_events, _allow_revalidate, _allow_autobegin)</span>
<span class="g g-Whitespace">    </span><span class="mi">145</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_dbapi_connection</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">raw_connection</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">146</span>     <span class="k">except</span> <span class="n">dialect</span><span class="o">.</span><span class="n">loaded_dbapi</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">147</span>         <span class="n">Connection</span><span class="o">.</span><span class="n">_handle_dbapi_exception_noconnection</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">148</span>             <span class="n">err</span><span class="p">,</span> <span class="n">dialect</span><span class="p">,</span> <span class="n">engine</span>
<span class="g g-Whitespace">    </span><span class="mi">149</span>         <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">150</span>         <span class="k">raise</span>
<span class="g g-Whitespace">    </span><span class="mi">151</span> <span class="k">else</span><span class="p">:</span>

<span class="nn">File c:\Users\alan.moreira\Anaconda3\lib\site-packages\sqlalchemy\engine\base.py:2431,</span> in <span class="ni">Connection._handle_dbapi_exception_noconnection</span><span class="nt">(cls, e, dialect, engine, is_disconnect, invalidate_pool_on_disconnect, is_pre_ping)</span>
<span class="g g-Whitespace">   </span><span class="mi">2429</span> <span class="k">elif</span> <span class="n">should_wrap</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">2430</span>     <span class="k">assert</span> <span class="n">sqlalchemy_exception</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="ne">-&gt; </span><span class="mi">2431</span>     <span class="k">raise</span> <span class="n">sqlalchemy_exception</span><span class="o">.</span><span class="n">with_traceback</span><span class="p">(</span><span class="n">exc_info</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
<span class="g g-Whitespace">   </span><span class="mi">2432</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">2433</span>     <span class="k">assert</span> <span class="n">exc_info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

<span class="nn">File c:\Users\alan.moreira\Anaconda3\lib\site-packages\sqlalchemy\engine\base.py:145,</span> in <span class="ni">Connection.__init__</span><span class="nt">(self, engine, connection, _has_events, _allow_revalidate, _allow_autobegin)</span>
<span class="g g-Whitespace">    </span><span class="mi">143</span> <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">144</span>     <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">145</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_dbapi_connection</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">raw_connection</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">146</span>     <span class="k">except</span> <span class="n">dialect</span><span class="o">.</span><span class="n">loaded_dbapi</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">147</span>         <span class="n">Connection</span><span class="o">.</span><span class="n">_handle_dbapi_exception_noconnection</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">148</span>             <span class="n">err</span><span class="p">,</span> <span class="n">dialect</span><span class="p">,</span> <span class="n">engine</span>
<span class="g g-Whitespace">    </span><span class="mi">149</span>         <span class="p">)</span>

<span class="nn">File c:\Users\alan.moreira\Anaconda3\lib\site-packages\sqlalchemy\engine\base.py:3293,</span> in <span class="ni">Engine.raw_connection</span><span class="nt">(self)</span>
<span class="g g-Whitespace">   </span><span class="mi">3271</span> <span class="k">def</span><span class="w"> </span><span class="nf">raw_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PoolProxiedConnection</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">3272</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;Return a &quot;raw&quot; DBAPI connection from the connection pool.</span>
<span class="g g-Whitespace">   </span><span class="mi">3273</span><span class="sd"> </span>
<span class="g g-Whitespace">   </span><span class="mi">3274</span><span class="sd">     The returned object is a proxied version of the DBAPI</span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">   </span><span class="mi">3291</span><span class="sd"> </span>
<span class="g g-Whitespace">   </span><span class="mi">3292</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">-&gt; </span><span class="mi">3293</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>

<span class="nn">File c:\Users\alan.moreira\Anaconda3\lib\site-packages\sqlalchemy\pool\base.py:452,</span> in <span class="ni">Pool.connect</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">444</span> <span class="k">def</span><span class="w"> </span><span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PoolProxiedConnection</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">445</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;Return a DBAPI connection from the pool.</span>
<span class="g g-Whitespace">    </span><span class="mi">446</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">447</span><span class="sd">     The connection is instrumented such that when its</span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">    </span><span class="mi">450</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">451</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">452</span>     <span class="k">return</span> <span class="n">_ConnectionFairy</span><span class="o">.</span><span class="n">_checkout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<span class="nn">File c:\Users\alan.moreira\Anaconda3\lib\site-packages\sqlalchemy\pool\base.py:1269,</span> in <span class="ni">_ConnectionFairy._checkout</span><span class="nt">(cls, pool, threadconns, fairy)</span>
<span class="g g-Whitespace">   </span><span class="mi">1261</span> <span class="nd">@classmethod</span>
<span class="g g-Whitespace">   </span><span class="mi">1262</span> <span class="k">def</span><span class="w"> </span><span class="nf">_checkout</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1263</span>     <span class="bp">cls</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1266</span>     <span class="n">fairy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_ConnectionFairy</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1267</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_ConnectionFairy</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1268</span>     <span class="k">if</span> <span class="ow">not</span> <span class="n">fairy</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">1269</span>         <span class="n">fairy</span> <span class="o">=</span> <span class="n">_ConnectionRecord</span><span class="o">.</span><span class="n">checkout</span><span class="p">(</span><span class="n">pool</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1271</span>         <span class="k">if</span> <span class="n">threadconns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1272</span>             <span class="n">threadconns</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="n">fairy</span><span class="p">)</span>

<span class="nn">File c:\Users\alan.moreira\Anaconda3\lib\site-packages\sqlalchemy\pool\base.py:716,</span> in <span class="ni">_ConnectionRecord.checkout</span><span class="nt">(cls, pool)</span>
<span class="g g-Whitespace">    </span><span class="mi">714</span>     <span class="n">rec</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">_ConnectionRecord</span><span class="p">,</span> <span class="n">pool</span><span class="o">.</span><span class="n">_do_get</span><span class="p">())</span>
<span class="g g-Whitespace">    </span><span class="mi">715</span> <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">716</span>     <span class="n">rec</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">_do_get</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">718</span> <span class="k">try</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">719</span>     <span class="n">dbapi_connection</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">get_connection</span><span class="p">()</span>

<span class="nn">File c:\Users\alan.moreira\Anaconda3\lib\site-packages\sqlalchemy\pool\impl.py:170,</span> in <span class="ni">QueuePool._do_get</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">168</span>     <span class="k">except</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">169</span>         <span class="k">with</span> <span class="n">util</span><span class="o">.</span><span class="n">safe_reraise</span><span class="p">():</span>
<span class="ne">--&gt; </span><span class="mi">170</span>             <span class="bp">self</span><span class="o">.</span><span class="n">_dec_overflow</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">171</span>         <span class="k">raise</span>
<span class="g g-Whitespace">    </span><span class="mi">172</span> <span class="k">else</span><span class="p">:</span>

<span class="nn">File c:\Users\alan.moreira\Anaconda3\lib\site-packages\sqlalchemy\util\langhelpers.py:146,</span> in <span class="ni">safe_reraise.__exit__</span><span class="nt">(self, type_, value, traceback)</span>
<span class="g g-Whitespace">    </span><span class="mi">144</span>     <span class="k">assert</span> <span class="n">exc_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="g g-Whitespace">    </span><span class="mi">145</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_exc_info</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># remove potential circular references</span>
<span class="ne">--&gt; </span><span class="mi">146</span>     <span class="k">raise</span> <span class="n">exc_value</span><span class="o">.</span><span class="n">with_traceback</span><span class="p">(</span><span class="n">exc_tb</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">147</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">148</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_exc_info</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># remove potential circular references</span>

<span class="nn">File c:\Users\alan.moreira\Anaconda3\lib\site-packages\sqlalchemy\pool\impl.py:167,</span> in <span class="ni">QueuePool._do_get</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">165</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inc_overflow</span><span class="p">():</span>
<span class="g g-Whitespace">    </span><span class="mi">166</span>     <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">167</span>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_connection</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">168</span>     <span class="k">except</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">169</span>         <span class="k">with</span> <span class="n">util</span><span class="o">.</span><span class="n">safe_reraise</span><span class="p">():</span>

<span class="nn">File c:\Users\alan.moreira\Anaconda3\lib\site-packages\sqlalchemy\pool\base.py:393,</span> in <span class="ni">Pool._create_connection</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">390</span> <span class="k">def</span><span class="w"> </span><span class="nf">_create_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConnectionPoolEntry</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">391</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;Called by subclasses to create a new ConnectionRecord.&quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">393</span>     <span class="k">return</span> <span class="n">_ConnectionRecord</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<span class="nn">File c:\Users\alan.moreira\Anaconda3\lib\site-packages\sqlalchemy\pool\base.py:678,</span> in <span class="ni">_ConnectionRecord.__init__</span><span class="nt">(self, pool, connect)</span>
<span class="g g-Whitespace">    </span><span class="mi">676</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pool</span> <span class="o">=</span> <span class="n">pool</span>
<span class="g g-Whitespace">    </span><span class="mi">677</span> <span class="k">if</span> <span class="n">connect</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">678</span>     <span class="bp">self</span><span class="o">.</span><span class="n">__connect</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">679</span> <span class="bp">self</span><span class="o">.</span><span class="n">finalize_callback</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>

<span class="nn">File c:\Users\alan.moreira\Anaconda3\lib\site-packages\sqlalchemy\pool\base.py:903,</span> in <span class="ni">_ConnectionRecord.__connect</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">901</span> <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">902</span>     <span class="k">with</span> <span class="n">util</span><span class="o">.</span><span class="n">safe_reraise</span><span class="p">():</span>
<span class="ne">--&gt; </span><span class="mi">903</span>         <span class="n">pool</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Error on connect(): </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">904</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">905</span>     <span class="c1"># in SQLAlchemy 1.4 the first_connect event is not used by</span>
<span class="g g-Whitespace">    </span><span class="mi">906</span>     <span class="c1"># the engine, so this will usually not be set</span>
<span class="g g-Whitespace">    </span><span class="mi">907</span>     <span class="k">if</span> <span class="n">pool</span><span class="o">.</span><span class="n">dispatch</span><span class="o">.</span><span class="n">first_connect</span><span class="p">:</span>

<span class="nn">File c:\Users\alan.moreira\Anaconda3\lib\site-packages\sqlalchemy\util\langhelpers.py:146,</span> in <span class="ni">safe_reraise.__exit__</span><span class="nt">(self, type_, value, traceback)</span>
<span class="g g-Whitespace">    </span><span class="mi">144</span>     <span class="k">assert</span> <span class="n">exc_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="g g-Whitespace">    </span><span class="mi">145</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_exc_info</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># remove potential circular references</span>
<span class="ne">--&gt; </span><span class="mi">146</span>     <span class="k">raise</span> <span class="n">exc_value</span><span class="o">.</span><span class="n">with_traceback</span><span class="p">(</span><span class="n">exc_tb</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">147</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">148</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_exc_info</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># remove potential circular references</span>

<span class="nn">File c:\Users\alan.moreira\Anaconda3\lib\site-packages\sqlalchemy\pool\base.py:898,</span> in <span class="ni">_ConnectionRecord.__connect</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">896</span> <span class="k">try</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">897</span>     <span class="bp">self</span><span class="o">.</span><span class="n">starttime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="ne">--&gt; </span><span class="mi">898</span>     <span class="bp">self</span><span class="o">.</span><span class="n">dbapi_connection</span> <span class="o">=</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">_invoke_creator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">899</span>     <span class="n">pool</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Created new connection </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">connection</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">900</span>     <span class="bp">self</span><span class="o">.</span><span class="n">fresh</span> <span class="o">=</span> <span class="kc">True</span>

<span class="nn">File c:\Users\alan.moreira\Anaconda3\lib\site-packages\sqlalchemy\engine\create.py:645,</span> in <span class="ni">create_engine.&lt;locals&gt;.connect</span><span class="nt">(connection_record)</span>
<span class="g g-Whitespace">    </span><span class="mi">642</span>         <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">643</span>             <span class="k">return</span> <span class="n">connection</span>
<span class="ne">--&gt; </span><span class="mi">645</span> <span class="k">return</span> <span class="n">dialect</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="o">*</span><span class="n">cargs</span><span class="p">,</span> <span class="o">**</span><span class="n">cparams</span><span class="p">)</span>

<span class="nn">File c:\Users\alan.moreira\Anaconda3\lib\site-packages\sqlalchemy\engine\default.py:616,</span> in <span class="ni">DefaultDialect.connect</span><span class="nt">(self, *cargs, **cparams)</span>
<span class="g g-Whitespace">    </span><span class="mi">614</span> <span class="k">def</span><span class="w"> </span><span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">cargs</span><span class="p">,</span> <span class="o">**</span><span class="n">cparams</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">615</span>     <span class="c1"># inherits the docstring from interfaces.Dialect.connect</span>
<span class="ne">--&gt; </span><span class="mi">616</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">loaded_dbapi</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="o">*</span><span class="n">cargs</span><span class="p">,</span> <span class="o">**</span><span class="n">cparams</span><span class="p">)</span>

<span class="nn">File c:\Users\alan.moreira\Anaconda3\lib\site-packages\psycopg2\__init__.py:122,</span> in <span class="ni">connect</span><span class="nt">(dsn, connection_factory, cursor_factory, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">119</span>     <span class="n">kwasync</span><span class="p">[</span><span class="s1">&#39;async_&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;async_&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">121</span> <span class="n">dsn</span> <span class="o">=</span> <span class="n">_ext</span><span class="o">.</span><span class="n">make_dsn</span><span class="p">(</span><span class="n">dsn</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">122</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">_connect</span><span class="p">(</span><span class="n">dsn</span><span class="p">,</span> <span class="n">connection_factory</span><span class="o">=</span><span class="n">connection_factory</span><span class="p">,</span> <span class="o">**</span><span class="n">kwasync</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">123</span> <span class="k">if</span> <span class="n">cursor_factory</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">124</span>     <span class="n">conn</span><span class="o">.</span><span class="n">cursor_factory</span> <span class="o">=</span> <span class="n">cursor_factory</span>

<span class="ne">OperationalError</span>: (psycopg2.OperationalError) connection to server at &quot;wrds-pgdata.wharton.upenn.edu&quot; (165.123.60.118), port 9737 failed: Connection refused (0x0000274D/10061)
	<span class="n">Is</span> <span class="n">the</span> <span class="n">server</span> <span class="n">running</span> <span class="n">on</span> <span class="n">that</span> <span class="n">host</span> <span class="ow">and</span> <span class="n">accepting</span> <span class="n">TCP</span><span class="o">/</span><span class="n">IP</span> connections<span class="o">?</span>

<span class="p">(</span><span class="n">Background</span> <span class="n">on</span> <span class="n">this</span> <span class="n">error</span> <span class="n">at</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">sqlalche</span><span class="o">.</span><span class="n">me</span><span class="o">/</span><span class="n">e</span><span class="o">/</span><span class="mi">20</span><span class="o">/</span><span class="n">e3q8</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">statsmodels.api</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sm</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">df_factor</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>  <span class="c1"># Adds a constant term to the predictor</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df_eret</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">dropna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                      y   R-squared:                       0.549
Model:                            OLS   Adj. R-squared:                  0.549
Method:                 Least Squares   F-statistic:                 3.124e+04
Date:                Sat, 14 Dec 2024   Prob (F-statistic):               0.00
Time:                        23:39:22   Log-Likelihood:                 76954.
No. Observations:               25646   AIC:                        -1.539e+05
Df Residuals:                   25644   BIC:                        -1.539e+05
Df Model:                           1                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
const       1.323e-05   7.52e-05      0.176      0.860      -0.000       0.000
Mkt-RF         1.2295      0.007    176.755      0.000       1.216       1.243
==============================================================================
Omnibus:                     5510.702   Durbin-Watson:                   2.089
Prob(Omnibus):                  0.000   Jarque-Bera (JB):           137521.972
Skew:                           0.434   Prob(JB):                         0.00
Kurtosis:                      14.311   Cond. No.                         92.5
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</pre></div>
</div>
</div>
</div>
<p>Lets focus on the beta</p>
<ol class="arabic simple">
<li><p>What frequency is it? Do we need to multiply to make it yearly?</p></li>
</ol>
<div class="math notranslate nohighlight">
\[\beta=\frac{Cov(r,f)}{Var(f)}\]</div>
<ol class="arabic simple" start="2">
<li><p>How well estimated?</p></li>
<li><p>How confident we are that the beta is less  than 1?</p></li>
<li><p>How much uncertainty do we have about it?</p></li>
<li><p>Say, what is the 95% confidence interval?</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">bse</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>const     0.000075
Mkt-RF    0.006956
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">norm</span>
<span class="n">x</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mf">0.95</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
<span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span> <span class="o">+</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">bse</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">],</span><span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span> <span class="o">-</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">bse</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1.2158455647969004, 1.2431118925672446]
</pre></div>
</div>
</div>
</div>
<p>barely any uncertainty and we are quite sure it is above 1.</p>
<p>How sure?</p>
<p>Note that the null in the table is for the null hypothesis that beta=0</p>
<div class="math notranslate nohighlight">
\[t=\frac{\beta-1}{se(\beta)}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tstat</span><span class="o">=</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">model</span><span class="o">.</span><span class="n">bse</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span>
<span class="n">tstat</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>32.99087777592763
</pre></div>
</div>
</div>
</div>
<p>What is the probability that beta is lower than 1?</p>
<div class="math notranslate nohighlight">
\[Prob(z&gt;tstat)=1-Prob(z&lt;tstat)=1-F(tstat)\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span><span class="o">-</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">t_test1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0
</pre></div>
</div>
</div>
</div>
<p>But is beta really constant?</p>
<p>Should we be using such a long sample?</p>
<p>Lets look at at 2 year periods</p>
<p>We will first create a function that does the regression and returns the beta</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We start by putting the factor and the excess return series together in a DataFrame called `df`.</span>

<span class="n">df</span><span class="o">=</span><span class="n">df_factor</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;re&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">df_eret</span>

<span class="c1"># now we define a function that does the regression and returns the beta</span>

<span class="k">def</span><span class="w"> </span><span class="nf">regression_beta</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to estimate the beta of a stock using OLS regression.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>  <span class="c1"># Adds a constant term to the predictor</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;re&#39;</span><span class="p">]</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">dropna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span>

<span class="n">regression_beta</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># this is the first time we see the groupby method in pandas</span>
<span class="c1"># Groupby is a powerful feature in pandas that allows you to group data based on some criteria</span>

<span class="c1"># Groupby is a method in pandas that allows you to group data based on some criteria (e.g., a column or a function applied to the index).</span>
<span class="c1"># Once grouped, you can apply aggregation or transformation functions (e.g., mean, sum, or custom functions) to each group independently.</span>
<span class="c1"># The grouping can be based on labels, index levels, or a custom function applied to the index or columns.</span>
<span class="c1"># After applying the function, the results are combined into a new DataFrame or Series.</span>



<span class="c1"># now there is a lot going on in this line, so let&#39;s break it down step by step:</span>
<span class="c1"># 1. `df.groupby((df.index.year // 2) * 2)`: The data is grouped by two-year periods. </span>
<span class="c1">#    - `df.index.year` extracts the year from the index (assumed to be a datetime index).</span>
<span class="c1">#    - `df.index.year // 2` divides the year by 2 (integer division) to group years into two-year blocks.</span>
<span class="c1">#    - `* 2` converts the two-year blocks back to the starting year of the block (e.g., 2020 and 2021 are grouped as 2020).</span>
<span class="c1"># 2. `.apply(regression_beta)`: For each two-year group, the regression_beta function is applied:</span>
<span class="c1"># 3. `.plot()`: The extracted beta values for each two-year period are plotted to visualize how the beta changes over time.</span>


<span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">((</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">regression_beta</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: &gt;
</pre></div>
</div>
<img alt="../../_images/7e01c5b9e2804d3d356c659d08b3687af65a5895beb343afc9b544ce0dfc48c9.png" src="../../_images/7e01c5b9e2804d3d356c659d08b3687af65a5895beb343afc9b544ce0dfc48c9.png" />
</div>
</div>
<p>Almost always above 1, but all over the place</p>
<p>are the betas really changing like that or is that sample uncertainty?</p>
<p>Lets report the standard errors for each 2-year period</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#here is the first time we use the an anonymous function (lambda)</span>
<span class="c1"># A lambda function is an anonymous function defined using the `lambda` keyword.</span>
<span class="c1"># It is used to create small, one-line functions without formally defining them using `def`.</span>
<span class="c1"># In this case, the lambda function takes a DataFrame `x` as input and performs the following steps:</span>
<span class="c1"># 1. Fits an OLS regression model using `x[&#39;re&#39;]` as the dependent variable and `x[&#39;Mkt-RF&#39;]` as the independent variable.</span>
<span class="c1"># 2. Extracts the standard error of the coefficient for `Mkt-RF` from the fitted model.</span>
<span class="c1"># The lambda function is applied to each group created by the `groupby` method.</span>

<span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">((</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;re&#39;</span><span class="p">],</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span><span class="o">.</span><span class="n">bse</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: &gt;
</pre></div>
</div>
<img alt="../../_images/dc6248de4a5e734d7a298690f0b0db3ad0d62c58af9316e66ba62910b7659e9f.png" src="../../_images/dc6248de4a5e734d7a298690f0b0db3ad0d62c58af9316e66ba62910b7659e9f.png" />
</div>
</div>
<p>Standard errors are much larger now!</p>
<p>It increase many fold–is that surprising? What do you think is going on?</p>
<p>Might be useful to look at different sampling (30,5,2,1) to get intuition</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># lets plot the point estimates and the confidence intervals</span>
<span class="n">y</span><span class="o">=</span><span class="mi">1</span> <span class="c1"># # you can change this to 5, 10, etc. to change the size of the sample</span>
<span class="n">a</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">((</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span> <span class="o">//</span> <span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;re&#39;</span><span class="p">],</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span><span class="o">.</span><span class="n">bse</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">])</span>
<span class="n">b</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">((</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span> <span class="o">//</span> <span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;re&#39;</span><span class="p">],</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Coefficient&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">b</span> <span class="o">-</span> <span class="mf">1.96</span> <span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">+</span> <span class="mf">1.96</span> <span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;95% Confidence Interval&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Coefficient&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Coefficient Over Time with 95% Confidence Interval&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ac1da3183c47dfd167c4a54cc44e57e74712cf9efae681b282665da5a8cf78e2.png" src="../../_images/ac1da3183c47dfd167c4a54cc44e57e74712cf9efae681b282665da5a8cf78e2.png" />
</div>
</div>
<p>Sometimes standard errors can be deceiving</p>
<p>Our estimation is super confident of the beta on a particular year, but we need to know the beta NEXT year–or at the very least next month if you want to use the beta for hedging for example</p>
<p>b</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">b</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">b</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x22aa69f9700&gt;]
</pre></div>
</div>
<img alt="../../_images/7656d9c6c26cb6287e738218c0c346a27cbc300c1f9732c58e78bbaa46e79271.png" src="../../_images/7656d9c6c26cb6287e738218c0c346a27cbc300c1f9732c58e78bbaa46e79271.png" />
</div>
</div>
<p>There is a relationship but much more variability then the standard errors suggest</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]))</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>            <td>y</td>        <th>  R-squared:         </th> <td>   0.169</td>
</tr>
<tr>
  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared:    </th> <td>   0.161</td>
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th> <td>   19.36</td>
</tr>
<tr>
  <th>Date:</th>             <td>Sun, 15 Dec 2024</td> <th>  Prob (F-statistic):</th> <td>2.83e-05</td>
</tr>
<tr>
  <th>Time:</th>                 <td>00:08:26</td>     <th>  Log-Likelihood:    </th> <td>  20.745</td>
</tr>
<tr>
  <th>No. Observations:</th>      <td>    97</td>      <th>  AIC:               </th> <td>  -37.49</td>
</tr>
<tr>
  <th>Df Residuals:</th>          <td>    95</td>      <th>  BIC:               </th> <td>  -32.34</td>
</tr>
<tr>
  <th>Df Model:</th>              <td>     1</td>      <th>                     </th>     <td> </td>   
</tr>
<tr>
  <th>Covariance Type:</th>      <td>nonrobust</td>    <th>                     </th>     <td> </td>   
</tr>
</table>
<table class="simpletable">
<tr>
    <td></td>       <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>const</th> <td>    0.6919</td> <td>    0.113</td> <td>    6.096</td> <td> 0.000</td> <td>    0.467</td> <td>    0.917</td>
</tr>
<tr>
  <th>0</th>     <td>    0.4137</td> <td>    0.094</td> <td>    4.400</td> <td> 0.000</td> <td>    0.227</td> <td>    0.600</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td> 2.395</td> <th>  Durbin-Watson:     </th> <td>   2.029</td>
</tr>
<tr>
  <th>Prob(Omnibus):</th> <td> 0.302</td> <th>  Jarque-Bera (JB):  </th> <td>   2.408</td>
</tr>
<tr>
  <th>Skew:</th>          <td> 0.359</td> <th>  Prob(JB):          </th> <td>   0.300</td>
</tr>
<tr>
  <th>Kurtosis:</th>      <td> 2.717</td> <th>  Cond. No.          </th> <td>    11.4</td>
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</div></div>
</div>
<p>How do we interpret these coefficients?</p>
<section id="exponential-decay-models">
<h3><span class="section-number">8.2.1. </span>Exponential decay models<a class="headerlink" href="#exponential-decay-models" title="Link to this heading">#</a></h3>
<p>People in the industry also like exponential decay models</p>
<p>Instead of simply ignoring past observations, you instead put less weight on them</p>
<p>Instead of OLS you do GLS with weights given by</p>
<div class="math notranslate nohighlight">
\[W_t=\frac{e^{-\delta(T-t)}}{\sum_t^T e^{-\delta(T-t)}}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>  <span class="c1"># Adds a constant term to the predictor</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;re&#39;</span><span class="p">]</span>
<span class="n">n</span><span class="o">=</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">decay_rate</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="c1"># Lambda controls the decay rate</span>

<span class="n">df</span><span class="p">[</span><span class="s1">&#39;weights&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="mi">0</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">decay_rate</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># Reverse order for recent weights</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;weights&#39;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;weights&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>  <span class="c1"># Normalize weights to sum to 1 (optional)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;weights&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Weights Over Time&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Weights Over Time&#39;)
</pre></div>
</div>
<img alt="../../_images/5a6364aa7b7c48f12d3c495c0b0f0357a8c61c69abf75c7ec07adff7140e876c.png" src="../../_images/5a6364aa7b7c48f12d3c495c0b0f0357a8c61c69abf75c7ec07adff7140e876c.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">WLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;weights&#39;</span><span class="p">])</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># Display results</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Regression Summary:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Regression Summary:
                            WLS Regression Results                            
==============================================================================
Dep. Variable:                     re   R-squared:                       0.344
Model:                            WLS   Adj. R-squared:                  0.344
Method:                 Least Squares   F-statistic:                 1.346e+04
Date:                Sun, 15 Dec 2024   Prob (F-statistic):               0.00
Time:                        00:25:21   Log-Likelihood:                -56194.
No. Observations:               25646   AIC:                         1.124e+05
Df Residuals:                   25644   BIC:                         1.124e+05
Df Model:                           1                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
const          0.0001      0.000      1.237      0.216   -8.14e-05       0.000
Mkt-RF         1.0609      0.009    116.020      0.000       1.043       1.079
==============================================================================
Omnibus:                    16784.641   Durbin-Watson:                   2.000
Prob(Omnibus):                  0.000   Jarque-Bera (JB):          8449883.622
Skew:                           1.875   Prob(JB):                         0.00
Kurtosis:                      91.845   Cond. No.                         81.3
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="variances">
<h2><span class="section-number">8.3. </span>Variances<a class="headerlink" href="#variances" title="Link to this heading">#</a></h2>
<p>Variances come in two flavors. Factor variance and idiosyncratic variance.</p>
<p>Both tend to move together at high frequencies (days, weeks, a few months)</p>
<p>At horizons longer than 1 year, you are better off with low frequency estimates of variances–say use a two year-five year sample of daily returns</p>
<p>Fro investment horizons shorten than a month you certainly need to pay attention to higher frequency variation. So you might estimate using 3-month, 1-month , and even one day of data using minute-by-minute data</p>
<p>Lets start with the factor variance, that is the variance of the market</p>
<ul class="simple">
<li><p>For intuition I will  annualize it. Always look at these moments at yearly frequency so you develop intuition about what to expect and quickly detect if something is wrong</p></li>
<li><p>Because our data is daily, this means multiplying by the number of days in a year</p></li>
<li><p>I will also be taking the square-root and look at standard deviation instead of variance</p></li>
</ul>
<div class="math notranslate nohighlight">
\[Standard~deviation=\sqrt{Variance}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="o">*</span><span class="mi">252</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.17158032498498688
</pre></div>
</div>
</div>
</div>
<p>Volatility is 17% in a year</p>
<p>Does it move around? Look at 5 years, yearly, monthly</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Note: This is the first time we will be using the rolling method</span>

<span class="c1"># The rolling method calculates a moving window statistic (e.g., mean, std) over a specified window size.</span>
<span class="c1"># Here, it computes the standard deviation of &#39;Mkt-RF&#39; for the last &#39;freq&#39; days at each point in time.</span>
<span class="c1"># This provides a time series of rolling standard deviations, which is then annualized and plotted.</span>


<span class="c1"># Calculate the rolling standard deviation of the &#39;Mkt-RF&#39; column over a specified window</span>
<span class="c1"># The window size is defined by &#39;freq&#39;, which corresponds to 10 years of daily data (252 trading days per year)</span>
<span class="c1"># The rolling standard deviation is annualized by multiplying by the square root of 252</span>
<span class="c1"># The resulting rolling standard deviation (annualized volatility) is then plotted over time</span>

<span class="n">freq</span><span class="o">=</span><span class="mi">252</span><span class="o">*</span><span class="mi">10</span>
<span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">freq</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">*</span><span class="mi">252</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: &gt;
</pre></div>
</div>
<img alt="../../_images/1e21bb03ce89a075198fec7a24c35e752aeb92ef13100f1db84222939c6ac51e.png" src="../../_images/1e21bb03ce89a075198fec7a24c35e752aeb92ef13100f1db84222939c6ac51e.png" />
</div>
</div>
<p>What do you notice?</p>
<p>Clearly the REALIZED VOLATILITY, just like the REALIZED RETURN, moves around a lot</p>
<p>Does that mean that actual forward looking volatility moves around?</p>
<blockquote>
<div><p>Yes! That is  Nobel Prize worth insight!</p>
</div></blockquote>
<p>Rob Engle won the nobel prize for developing models that forecast volatility.</p>
<p>[<img alt="Robert F. Engle" src="https://www.stern.nyu.edu/faculty/static/photos/rengle.jpg?v=20250812154103" /></p>
<p>We will look at volatility forecasting more carefully when we look at volatility timing strategies</p>
<p>Here I will do a simple regression based on the idea that volatility is persistence</p>
<p>We will estimate an AR(1) model</p>
<div class="math notranslate nohighlight">
\[RV_{t+1}=a+bRV_t+\epsilon_{t+1}\]</div>
<p>If vol persistent–surely looks like it–b&gt;0 and past vol allow us to forecast future vol</p>
<p>In practice people use very rich models ARCH, GARCH, Multi-frequency AR models, and also data from option markets–for example VIX</p>
<p>We will start by looking at monthly realized variance</p>
<ul>
<li><p>Using daily data for month t, construct the market return “realized variance” during month t</p>
<div class="math notranslate nohighlight">
\[rv_t=\sum_{d \in days~ in ~month ~t}\frac{(r_d- \overline{r})^2}{N_{days}},\]</div>
</li>
</ul>
<p>where <span class="math notranslate nohighlight">\(\overline{r}\)</span> is the average return within the month</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Group the data by month-end dates</span>
<span class="c1"># pd.offsets.MonthEnd(0) ensures that the grouping aligns with the month-end of each date</span>
<span class="c1"># so all returns in the same month are grouped together</span>
<span class="c1">#So I can just compute the variance of this group (say 1/1/2020,1/2/2020,...1/31/2020) will all be 1/31/2020</span>
<span class="c1"># For each group, i.e. returns in the same month, calculate the variance of &#39;Mkt-RF&#39; and annualize it by multiplying by 252</span>

<span class="n">df_var</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthEnd</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="o">*</span><span class="mi">252</span><span class="p">)</span>

<span class="c1"># here I am taking the square root of the variance to get the standard deviation (volatility) and plotting it</span>
<span class="p">(</span><span class="n">df_var</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">6</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># Group the data by month-end dates</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="c1"># pd.offsets.MonthEnd(0) ensures that the grouping aligns with the month-end of each date</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="c1"># so all returns in the same month are grouped together</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="c1"># For each group, i.e. returns in the same month, calculate the variance of &#39;Mkt-RF&#39; and annualize it by multiplying by 252</span>
<span class="ne">----&gt; </span><span class="mi">6</span> <span class="n">df_var</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthEnd</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="o">*</span><span class="mi">252</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="c1"># here I am taking the square root of the variance to get the standard deviation (volatility) and plotting it</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="p">(</span><span class="n">df_var</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

<span class="ne">NameError</span>: name &#39;df&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>You should see a lot of clustering which suggests you can forecast using past values of variance</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">statsmodels.api</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sm</span>


<span class="c1"># Shift the variance series by one period to create the lagged variable, </span>
<span class="c1"># i.e. using the previous month&#39;s variance as a predictor for the current month&#39;s variance</span>
<span class="c1"># When you shift the series, the first row will be NaN because there is no previous month for the first month</span>
<span class="c1"># if you were to use -1 you would be using the next month&#39;s variance as a predictor for the current month&#39;s variance</span>
<span class="c1"># would that make sense? No, because you would be using future information to predict the past</span>
<span class="n">df_var_lag</span> <span class="o">=</span> <span class="n">df_var</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Drop the first row with NaN value</span>
<span class="c1"># you have to drop in both series to align them correctly for regression</span>
<span class="n">df_var</span> <span class="o">=</span> <span class="n">df_var</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="n">df_var_lag</span> <span class="o">=</span> <span class="n">df_var_lag</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

<span class="c1"># Define the independent variable (lagged variance) and add a constant term</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">df_var_lag</span><span class="p">)</span>

<span class="c1"># Define the dependent variable (current variance)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df_var</span>

<span class="c1"># Fit the regression model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># Print the summary of the regression</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                      y   R-squared:                       0.290
Model:                            OLS   Adj. R-squared:                  0.290
Method:                 Least Squares   F-statistic:                     477.8
Date:                Sun, 15 Dec 2024   Prob (F-statistic):           4.68e-89
Time:                        08:58:31   Log-Likelihood:                 1844.6
No. Observations:                1169   AIC:                            -3685.
Df Residuals:                    1167   BIC:                            -3675.
Df Model:                           1                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
const          0.0133      0.002      8.185      0.000       0.010       0.016
0              0.5390      0.025     21.859      0.000       0.491       0.587
==============================================================================
Omnibus:                     1642.358   Durbin-Watson:                   2.049
Prob(Omnibus):                  0.000   Jarque-Bera (JB):           514248.392
Skew:                           7.744   Prob(JB):                         0.00
Kurtosis:                     104.577   Cond. No.                         16.9
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>you see we can forecast quite a bit of variation even with a only using the last month variance</p></li>
</ul>
<section id="indio-vol">
<h3><span class="section-number">8.3.1. </span>Indio Vol<a class="headerlink" href="#indio-vol" title="Link to this heading">#</a></h3>
<p>Lets look now at the idiosyncratic component</p>
<p>Recall that</p>
<div class="math notranslate nohighlight">
\[\epsilon=r^e-(\alpha+\beta*f)\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[Var(\epsilon)=Var(r^e-\beta*f)\]</div>
<p>So the variance of the idio component very much depends on your estimate of beta.</p>
<p>Industry models will make them consistent with each other</p>
<p>Here we will fix our beta estimate for the whole sample and then look at variation in the volatility of residuals the same we did for the variance of the market</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>  <span class="c1"># Adds a constant term to the predictor</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;re&#39;</span><span class="p">]</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">dropna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;e&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">resid</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;e&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: &gt;
</pre></div>
</div>
<img alt="../../_images/dc8be913979926d06e8181edbdff70a04ac65490d2986aeaac52514a517e82ca.png" src="../../_images/dc8be913979926d06e8181edbdff70a04ac65490d2986aeaac52514a517e82ca.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;e&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">252</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">*</span><span class="mi">252</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">252</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">*</span><span class="mi">252</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;epsilon&#39;</span><span class="p">,</span><span class="s1">&#39;Market Return&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x22ab7635e80&gt;
</pre></div>
</div>
<img alt="../../_images/f8852a504c500ac019f8f602e8a6d884acd2cb33ccc3df649266ac2e75af9b18.png" src="../../_images/f8852a504c500ac019f8f602e8a6d884acd2cb33ccc3df649266ac2e75af9b18.png" />
</div>
</div>
<p>What do you see?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">((</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthEnd</span><span class="p">(</span><span class="mi">0</span><span class="p">))[</span><span class="s1">&#39;e&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="o">*</span><span class="mi">252</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="p">((</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthEnd</span><span class="p">(</span><span class="mi">0</span><span class="p">))[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="o">*</span><span class="mi">252</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: &gt;
</pre></div>
</div>
<img alt="../../_images/63bfe55f3326f02ba2f84b191456db39d946fdd8ed9fd93d4ad97d1f5fdd58f7.png" src="../../_images/63bfe55f3326f02ba2f84b191456db39d946fdd8ed9fd93d4ad97d1f5fdd58f7.png" />
</div>
</div>
<p>You see a very similar picture</p>
</section>
<section id="cross-section-vs-time-series">
<h3><span class="section-number">8.3.2. </span>Cross-Section vs Time-series<a class="headerlink" href="#cross-section-vs-time-series" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Variances tend to move up and down together</p></li>
<li><p>you can repeat the forecasting exercise we did for the market variance to check out degree of  variation</p></li>
<li><p>One thing that will be really important is to be able to detect variation in these moments across stocks</p></li>
<li><p>Here we are exploring the extent we can detect variation over time, but lots of trading strategies will be about comparing different stocks and be able to tell which one is more volatile going forward</p></li>
<li><p>By and large the answer for both beta and variance is that we can using reasonable lookback windows</p></li>
<li><p>Typically two years is a good window  , but lots of fine tuning around it</p></li>
</ul>
</section>
</section>
<section id="expected-returns">
<h2><span class="section-number">8.4. </span>Expected returns<a class="headerlink" href="#expected-returns" title="Link to this heading">#</a></h2>
<p>Expected returns have three components</p>
<div class="math notranslate nohighlight">
\[E[r]=rf+\alpha + b*E[f]\]</div>
<ul class="simple">
<li><p>the risk-free rate–&gt; directly observed in financial markets</p></li>
<li><p>The Factor risk-premia</p></li>
<li><p>The alpha</p></li>
</ul>
<section id="factor-risk-premia">
<h3><span class="section-number">8.4.1. </span>Factor Risk-Premia<a class="headerlink" href="#factor-risk-premia" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>While conceptually both alpha and risk premia are both expected excess returns, in practice our approach is very different</p></li>
<li><p>Factor risk-premia likely move around, but we think of then as a more stable features of the economic environment</p></li>
<li><p>They are compensation for systematic risk, so they don’t go away just because investors are aware of it</p>
<ul>
<li><p>Specially true for risk-premia on the market factor</p></li>
</ul>
</li>
<li><p>We are more comfortable in using long data sets to measure it</p></li>
</ul>
<p>We will now look at the risk-premia on the market and discuss how to think about the estimation, how to think about the precision of these estimates and briefly discuss how it might move around over time</p>
<p><strong>If We think a risk-premia does not move too much over time, then our best estimate is the sample average of the longest sample we can put our hands on</strong></p>
<div class="math notranslate nohighlight">
\[\hat{E}[r^e]=\frac{1}{T}\sum_{t=1}^T r^e_t\]</div>
<ul class="simple">
<li><p>If observations are serially uncorrelated over time then the standard deviation of a sample average is simply</p></li>
</ul>
<div class="math notranslate nohighlight">
\[se(\hat{E}[r^e])=\sqrt{\frac{Var(r^e_t)}{T}}\]</div>
<ul class="simple">
<li><p>Returns of most <em>liquid</em> assets are sufficiently close to uncorrelated over time for this assumption to be ok</p>
<ul>
<li><p>It is also easy enough to adjust for serial correlation which we can easily do using a regression library</p></li>
</ul>
</li>
</ul>
<ul class="simple">
<li><p>The longer the sample, the higher our precision, the lower the standard errors</p></li>
<li><p>The higher the asset variance, the higher our standard errors, the lower our precision</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate the average for the market</span>
<span class="n">market_average</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">market_std_dev</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<span class="c1">#number of observations</span>
<span class="n">T</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">])</span>
<span class="c1"># Calculate the standard error of the average</span>
<span class="n">market_average_std_error</span> <span class="o">=</span> <span class="n">market_std_dev</span> <span class="o">/</span><span class="n">T</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Market standard deviation: </span><span class="si">{</span><span class="n">market_std_dev</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Market Average: </span><span class="si">{</span><span class="n">market_average</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Standard Error of the Average: </span><span class="si">{</span><span class="n">market_average_std_error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;t-stat relative to zero null: </span><span class="si">{</span><span class="p">(</span><span class="n">market_average</span><span class="o">-</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="n">market_average_std_error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Standard Error of the Average: 0.010808544518617085
Market Average: 0.0003018248459798799
Standard Error of the Average: 6.749279240098983e-05
t-stat relative to zero null: 4.471956711861479
</pre></div>
</div>
</div>
</div>
<p>This is daily so it looks really ugly. Lets look at annual terms</p>
<ul class="simple">
<li><p>The mean is multiplied by 252, because there are 252 days in a year</p></li>
<li><p>Variance is also multiplied by 252, so standard-deviaiton gets multiplied by square root</p></li>
<li><p>The number of observations are divided by 252 because now things are in years</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate the average for the market</span>
<span class="n">market_average</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">252</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">market_std_dev</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">*</span><span class="mi">252</span><span class="o">**</span><span class="mf">0.5</span>
<span class="n">T</span><span class="o">=</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">])</span><span class="o">/</span><span class="mi">252</span><span class="p">)</span>
<span class="c1"># Calculate the standard error of the average</span>
<span class="n">market_average_std_error</span> <span class="o">=</span> <span class="n">market_std_dev</span> <span class="o">/</span> <span class="n">T</span><span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Market standard deviation: </span><span class="si">{</span><span class="n">market_std_dev</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="c1"># Calculate the standard error of the average</span>


<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Market Average: </span><span class="si">{</span><span class="n">market_average</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Standard Error of the Average: </span><span class="si">{</span><span class="n">market_average_std_error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;t-stat relative to zero null: </span><span class="si">{</span><span class="p">(</span><span class="n">market_average</span><span class="o">-</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="n">market_average_std_error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Market standard deviation: 0.17158032498498688
Market Average: 0.07605986118692974
Standard Error of the Average: 0.017008183685049437
t-stat relative to zero null: 4.47195671186148
</pre></div>
</div>
</div>
</div>
<p>Note that the t-stat is invariant to frequency transformation</p>
<blockquote>
<div><p>This makes the very important point that <strong>sampling more frequently does not lead to more precise estimates of the expected return</strong></p>
<p>“only time will tell” could not be any truer for means: Both mean and variance are scaled up by the frequency.</p>
</div></blockquote>
<p>Long sample allow us to be very confident that the market risk-premium is positive on average</p>
<p>We can be fairly confident even that risk-premium is higher than 3%</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nullh</span><span class="o">=</span><span class="mf">0.03</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;t-stat relative to </span><span class="si">{</span><span class="n">nullh</span><span class="si">}</span><span class="s2"> null: </span><span class="si">{</span><span class="p">(</span><span class="n">market_average</span><span class="o">-</span><span class="n">nullh</span><span class="p">)</span><span class="o">/</span><span class="n">market_std_error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t-stat relative to 0.03 null: 2.708099938232526
</pre></div>
</div>
</div>
</div>
<p>Suppose risk-premium is time-varying but moves kind of slowly</p>
<p>Also lets suppose the variance is constant at the sample mean</p>
<p>How long a sample do I need to be 95% confident that the expected value is higher than the value “x”</p>
<p>I need</p>
<div class="math notranslate nohighlight">
\[tstat&gt;F^{-1}(0.95)=1.64\]</div>
<div class="math notranslate nohighlight">
\[tstat=\frac{\hat{E}[r^e]-x}{se(\hat{E}[r^e])}&gt;F^{-1}(0.95)=1.64\]</div>
<div class="math notranslate nohighlight">
\[tstat=\frac{\hat{E}[r^e]-x}{\sqrt{\frac{Var(r^e_t)}{T}}}&gt;F^{-1}(0.95)=1.64\]</div>
<p>manipulating</p>
<div class="math notranslate nohighlight">
\[\sqrt{T}\frac{\hat{E}[r^e]-x}{\sigma(r^e_t)}=1.64\]</div>
<div class="math notranslate nohighlight">
\[T=1.64^2*\left(\frac{\hat{E}[r^e]}{\sigma(r^e_t)}-\frac{x}{\sigma(r^e_t)}\right)^{-2}\]</div>
<ul class="simple">
<li><p>what is this term <span class="math notranslate nohighlight">\(\frac{\hat{E}[r^e]}{\sigma(r^e_t)}\)</span> called?</p></li>
<li><p>The more confident you want to be, the longer the sample you need</p></li>
<li><p>The more volatile the asset the longer the sample</p></li>
<li><p>The higher the expected value you have for the asset, the shorten the sample</p></li>
<li><p>in the case of x=0 this becomes</p></li>
</ul>
<div class="math notranslate nohighlight">
\[T=1.64^2*\left(\frac{\hat{E}[r^e]}{\sigma(r^e_t)}\right)^{-2}\]</div>
<p>Suppose we have an asset with similar moments as the market (i.e. same SR)</p>
<p>how long a sample do I expect to need to be confident that the asset has indeed positive mean?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">quantile</span> <span class="o">=</span> <span class="mf">0.95</span>
<span class="n">value_at_quantile</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">quantile</span><span class="p">)</span>
<span class="n">sr</span><span class="o">=</span><span class="n">market_average</span><span class="o">/</span><span class="n">market_std_dev</span>
<span class="p">(</span><span class="n">sr</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">value_at_quantile</span><span class="o">**</span><span class="mi">2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>13.76824003316407
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><p>What does it tell you about opening a hedge fund?</p>
</div></blockquote>
<p>Lets look at the market spliting it in 15 year periods</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y</span><span class="o">=</span><span class="mi">15</span>
<span class="n">a</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">((</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span> <span class="o">//</span> <span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">**</span><span class="mf">0.5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">1.64</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;1.64 Threshold&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">a</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: &gt;
</pre></div>
</div>
<img alt="../../_images/ab5740cf8f0cacb6f1e35dac1836cd4ca28f441ebab224f1e47292129c1f8578.png" src="../../_images/ab5740cf8f0cacb6f1e35dac1836cd4ca28f441ebab224f1e47292129c1f8578.png" />
</div>
</div>
<ul class="simple">
<li><p>even then there would be multiple 15 year periods where we would not be 10% sure that the market has a positive expected return</p></li>
<li><p>If you think the market risk-premium moves much faster than this, then the sample mean is fairly unreliable estimator</p></li>
<li><p>This insight will be very important to think about alphas</p></li>
<li><p>This also tells you that timing the market based on past performance–even 15 past performance is a disaster!</p></li>
</ul>
<p>Huge literature tries to forecast market return</p>
<ul class="simple">
<li><p>They use past volatility (bad, does not work at all)</p></li>
<li><p>Dividend yield (maybe, a bit unreliable)</p></li>
<li><p>earnings yield (similar for dividend yield)</p></li>
<li><p>“Variance-Risk Premium”, basically the VIX minus past vol–that works a bit better, but sample is short, so hard to be sure</p></li>
</ul>
<p>IT is very tricky business and even if your model is right</p>
<p>We will look at this in our timing lecture</p>
</section>
<section id="alpha-is-all-you-need">
<h3><span class="section-number">8.4.2. </span>Alpha is all you need<a class="headerlink" href="#alpha-is-all-you-need" title="Link to this heading">#</a></h3>
<p>In one way estimating an alpha is similar to estimating factor risk-premia</p>
<ul class="simple">
<li><p>Both are expected values of the excess returns</p></li>
<li><p>Alpha is the expected value of the hedged portfolio</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\alpha=E[r^e-\beta f]\]</div>
<ul class="simple">
<li><p>So you might think the longer the sample, the better right?</p></li>
<li><p>But while for factor premia we have lots of theory telling us that it should move very slowly–it is about aggregate risk–and it should not go away just because people know it</p>
<ul>
<li><p>it is compensation for aggregate risk!!–people choose not to go all the way because it is risky!</p></li>
</ul>
</li>
<li><p>For alphas, it is the opposite, everyone is jumping when alpha is detected. The whole point is that alpha, real alpha, are premiums that you earn after you HEDGE out any aggregate factor exposure you portfolio have</p></li>
<li><p>What happens with the price as more people buy an asset?</p></li>
<li><p>What happens with the asset actual long-term value?</p></li>
<li><p>What happens with the alpha?</p></li>
</ul>
<p>So lets first get a few stocks and compare their alphas. I will focus on one sector</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># you probably need to load wrds again if you have been talking for a while :)</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">wrds</span><span class="o">.</span><span class="n">Connection</span><span class="p">()</span>
<span class="n">tickers</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;MSFT&#39;</span><span class="p">,</span><span class="s1">&#39;AAPL&#39;</span><span class="p">,</span><span class="s1">&#39;CSCO&#39;</span><span class="p">,</span><span class="s1">&#39;ORCL&#39;</span><span class="p">,</span><span class="s1">&#39;GOOGL&#39;</span><span class="p">]</span>
<span class="n">df_returns</span> <span class="o">=</span> <span class="n">get_daily_wrds</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span><span class="n">tickers</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="n">df_factor</span> <span class="o">=</span> <span class="n">get_factors</span><span class="p">()</span>
<span class="n">df_return</span><span class="p">,</span> <span class="n">df_factor</span> <span class="o">=</span> <span class="n">df_returns</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">df_factor</span><span class="p">,</span> <span class="n">join</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">df_re</span><span class="o">=</span><span class="n">df_return</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">df_factor</span><span class="p">[</span><span class="s1">&#39;RF&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">df_re</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">df_re</span><span class="p">)</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[10104, 10107, 14593, 76076, 90319]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>c:\Users\alan.moreira\Anaconda3\lib\site-packages\pandas_datareader\famafrench.py:114: FutureWarning: The argument &#39;date_parser&#39; is deprecated and will be removed in a future version. Please use &#39;date_format&#39; instead, or read your data in as &#39;object&#39; dtype and then call &#39;to_datetime&#39;.
  df = read_csv(StringIO(&quot;Date&quot; + src[start:]), **params)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ticker          MSFT      AAPL      CSCO      ORCL     GOOGL
2004-08-20  0.002900  0.002881 -0.011568 -0.010607  0.079434
2004-08-23  0.004362  0.009041  0.015840 -0.001020  0.010014
2004-08-24 -0.000050  0.027942 -0.010999  0.002863 -0.041458
2004-08-25  0.011330  0.034379  0.018400  0.006726  0.010725
2004-08-26 -0.004043  0.048664 -0.007814 -0.016396  0.017969
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: &gt;
</pre></div>
</div>
<img alt="../../_images/1bd8d76dee51ed5eb3ef80378d2333cb5f3c0a9657f683b5a958585d6c633498.png" src="../../_images/1bd8d76dee51ed5eb3ef80378d2333cb5f3c0a9657f683b5a958585d6c633498.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">statsmodels.api</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sm</span>

<span class="c1"># Define the period length</span>
<span class="n">period_length</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># Create a dictionary to store the results</span>
<span class="n">results_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Ticker&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;Period&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;Alpha&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;Alpha_SE&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;Alpha_Tstat&#39;</span><span class="p">:</span> <span class="p">[]}</span>

<span class="c1"># Loop through each 5-year period</span>
<span class="k">for</span> <span class="n">start_year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">df_re</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">df_re</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">period_length</span><span class="p">):</span>
    <span class="n">end_year</span> <span class="o">=</span> <span class="n">start_year</span> <span class="o">+</span> <span class="n">period_length</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">period_label</span> <span class="o">=</span> <span class="n">end_year</span>
    
    <span class="c1"># Filter the data for the current period</span>
    <span class="n">period_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_re</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="n">start_year</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_re</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="n">end_year</span><span class="p">)</span>
    <span class="n">df_re_period</span> <span class="o">=</span> <span class="n">df_re</span><span class="p">[</span><span class="n">period_mask</span><span class="p">]</span>
    <span class="n">df_factor_period</span> <span class="o">=</span> <span class="n">df_factor</span><span class="p">[</span><span class="n">period_mask</span><span class="p">]</span>
    
    <span class="c1"># Loop through each column in df_re</span>
    <span class="k">for</span> <span class="n">ticker</span> <span class="ow">in</span> <span class="n">df_re</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">df_re_period</span><span class="p">[</span><span class="n">ticker</span><span class="p">]</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">df_factor_period</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">])</span>
            
            <span class="c1"># Perform the regression</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">missing</span><span class="o">=</span><span class="s1">&#39;drop&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
            
            <span class="c1"># Store the results</span>
            <span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;Ticker&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ticker</span><span class="p">)</span>
            <span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;Period&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">period_label</span><span class="p">)</span>
            <span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;Alpha&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;const&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">252</span><span class="p">)</span>
            <span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;Alpha_SE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">bse</span><span class="p">[</span><span class="s1">&#39;const&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">252</span><span class="p">)</span>
            <span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;Alpha_Tstat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;const&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">model</span><span class="o">.</span><span class="n">bse</span><span class="p">[</span><span class="s1">&#39;const&#39;</span><span class="p">])</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

<span class="c1"># Convert the results dictionary to a DataFrame</span>

<span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results_dict</span><span class="p">)</span>

<span class="c1"># Display the results</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   Ticker  Period     Alpha  Alpha_SE  Alpha_Tstat
0    MSFT    2004 -0.024613  0.173236    -0.142075
1    AAPL    2004  1.815150  0.695334     2.610472
2    CSCO    2004 -0.452826  0.381418    -1.187216
3    ORCL    2004  0.339126  0.490395     0.691537
4   GOOGL    2004  1.875807  0.880467     2.130469
..    ...     ...       ...       ...          ...
90   MSFT    2022 -0.028199  0.174405    -0.161688
91   AAPL    2022  0.000443  0.170943     0.002591
92   CSCO    2022 -0.062703  0.216968    -0.288997
93   ORCL    2022  0.160281  0.219380     0.730607
94  GOOGL    2022 -0.170152  0.212610    -0.800300

[95 rows x 5 columns]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">results_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Ticker&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="s1">&#39;Alpha&#39;</span><span class="p">],</span><span class="n">results_df</span><span class="o">.</span><span class="n">Alpha</span> <span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">results_df</span><span class="p">[</span><span class="s1">&#39;Alpha&#39;</span><span class="p">],</span><span class="n">results_df</span><span class="o">.</span><span class="n">Alpha</span> <span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Alpha (t-1)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Alpha (t)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Alpha (t)&#39;)
</pre></div>
</div>
<img alt="../../_images/c20f0adba542d362d5c17c94e3f7b8f92beced5c2d565867e9af6f775166ea20.png" src="../../_images/c20f0adba542d362d5c17c94e3f7b8f92beced5c2d565867e9af6f775166ea20.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">results_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Ticker&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="s1">&#39;Alpha_Tstat&#39;</span><span class="p">],</span><span class="n">results_df</span><span class="o">.</span><span class="n">Alpha</span> <span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Alpha_Tstat (t-1)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Alpha (t)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Alpha (t)&#39;)
</pre></div>
</div>
<img alt="../../_images/a3f16296c2abe4f917dc8e01f7eb156c7e6f7e259fca675a010f15fb130b9699.png" src="../../_images/a3f16296c2abe4f917dc8e01f7eb156c7e6f7e259fca675a010f15fb130b9699.png" />
</div>
</div>
<ul class="simple">
<li><p>You see that no matter the horizon there is no PREDICTIVE relationship, last period alpha is not related to future period alpha</p></li>
<li><p>You see that even if you sort on t-stat, it is not better</p></li>
<li><p>Even quite high T-stats are not associated with higher future alphas</p></li>
<li><p>This is not surprising!</p></li>
<li><p>Alpha is all you want and all you need. So everyone is chasing it</p></li>
</ul>
<ul class="simple">
<li><p>So you expect that alpha of an asset or a trading strategy should be very transient– it will quickly disappears as people learn about it</p></li>
<li><p>This will pose a challenge for you</p></li>
</ul>
<p><strong>How do you find alpha?</strong></p>
<ul class="simple">
<li><p>Estimating Alpha is hard!</p></li>
<li><p>Every one in the business in searching for alpha</p></li>
<li><p>So true alpha is</p>
<ul>
<li><p>hard to find</p></li>
<li><p>disappears quickly</p></li>
<li><p>if the data was clear, people would already jumped at it</p></li>
<li><p>Once too much capital is in the trade we say that the trade is “crowded”</p></li>
<li><p>A Crowded trade can yield NEGATIVE alpha, even if the original idea was right!</p></li>
<li><p>You have to be right, but also early.</p></li>
<li><p>If the trade gets crowded after you already in, is that good or bad? What do you do?</p></li>
</ul>
</li>
</ul>
<p><strong>If not estimation then what?</strong></p>
<p>You need to think!</p>
<ul class="simple">
<li><p>Valuation. You understand a business/market and think the market is not seeing what you are seeing. IT can be short-term insight, like a big client will cancel their services, or long-term prospects for the company business.</p>
<ul>
<li><p>Warren Buffet whole stick is about this. Read his letters to shareholders. It is all about finding good firms at good value</p></li>
<li><p>David Einhorn is another example. He famously betted against Leahman Brothers.</p></li>
<li><p>Often this view will be formed by not only looking at balance sheets , but interacting with company insiders. Even though interactions are public, access allow a good fundamental analyst to see things more clearly (if you get private information, it is of course “easier” but it is illegal and you might end up in jail!)</p></li>
<li><p>Edge here is having good business judgment. You need to be confident that you are seeing something different form the market and you are right!</p></li>
<li><p>IT is good discipline to think why people are thinking the wrong thing–you need to understand why the opportunity is there in the first place</p></li>
</ul>
</li>
<li><p>Liquidity provision</p>
<ul>
<li><p>When firms are downgraded some fund are forced to sell, this often creates reversals</p></li>
<li><p>Similar effect happens when a firm is dropped from an index, say SP500</p></li>
<li><p>And it happens in the opposite direction when it is added to the index</p></li>
<li><p>When mutual fund suffers outflows, they often have to sell, this often creates reversals are as well</p></li>
<li><p>The bet here is that you understand the reason these buy and sells are happening–and that they are not about fundamental news</p></li>
<li><p>So you bet the price movements triggered by them will ultimate revert, so you take the other side of the trade–i.e. provide liquidity (at a sweet premium of course)</p></li>
</ul>
</li>
<li><p>Data that other people don’t have.</p>
<ul>
<li><p>Famous example are satellite pictures of parking lots of retail stores–might allow you to predict sales better which hopefully translates into predictions about prices once the market becomes aware of the sales</p></li>
<li><p>Flow data–this is slightly different from liquidity provision–as you can front run buys/sells if you know that the flows are coming and that they will move markets</p></li>
<li><p>flooding data, exposure to temperature,</p></li>
<li><p>supplier data</p></li>
<li><p>See below a diagram by JP Morgan illustrating the variety of data sources</p></li>
</ul>
</li>
</ul>
<p><img alt="Alternative Data" src="../../_images/alternativedata.png" /></p>
<section id="alpha-quantification-procedure">
<h4><span class="section-number">8.4.2.1. </span>Alpha Quantification Procedure<a class="headerlink" href="#alpha-quantification-procedure" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p>Regardless how you get to you alpha, in the end you have to put your trading insights in the same playing field</p></li>
<li><p>Need to choose an horizon, say a month, and put all your alpha in that frequency.</p></li>
</ul>
<p>Example:</p>
<ul class="simple">
<li><p>Say you have a theory that NVDIA currently trading at 1000 will be at 800 in one year due to things that entirely specific to NVDIA (that is a -20% return)</p></li>
<li><p>Suppose you do not have a theory of when exactly that will happen</p></li>
<li><p>Then you alpha for next month is <span class="math notranslate nohighlight">\((0.8)^{(1/12)}-1\approx-1.8\%\)</span></p></li>
<li><p>Now suppose you know the timing–so you know this  bad news is likely to come only on the last two earnings of the year, then you alpha=0 for the first six months of the year and <span class="math notranslate nohighlight">\((0.8)^{(1/6)}-1\approx-3.6\%\)</span> for last six months of the year</p></li>
</ul>
</section>
<section id="real-alpha-is-unique-and-cannot-be-driven-by-broad-macro-factors">
<h4><span class="section-number">8.4.2.2. </span>Real Alpha is unique and cannot be driven by broad macro factors<a class="headerlink" href="#real-alpha-is-unique-and-cannot-be-driven-by-broad-macro-factors" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p>It is useful to develop views for a range of firms/ industries to check that you are not implicitly making a market-wide bet</p></li>
<li><p>if that is your bet, it is silly to hedge market risk–and it is very inefficient  to buy a single stock to trade this view</p></li>
<li><p>You should just buy the market in this case!</p></li>
<li><p>And it is important to be aware because it is much harder to be right!</p></li>
<li><p>In practice the notion of “broad macro factors” is much broader then market beta and will often include exposure to a variety of factors, including industry factors</p></li>
<li><p>While it is ok to make a bet on an industry, it is important to know exactly what your trade is</p></li>
<li><p>Buying NVDIA because your bullish on the tech sector is not efficient–you should buy the whole tech sector in that case–much less risk per unit of exposure- as it is not exposed to NVDIA specific factors?</p></li>
</ul>
<hr class="docutils" />
<p><strong>📝 Key Takeaways</strong></p>
<ul class="simple">
<li><p><strong>Risk parameters are tractable; alpha is the bottleneck.</strong>  Betas, variances, and even risk-premia can be estimated with historical data, but forecasting alpha requires scarce information or insight.</p></li>
<li><p><strong>Cross-section vs time-series is a trade-off.</strong>  Cross-sectional snapshots use many assets in one period, while time-series exploits one asset’s history; choose based on data depth and stationarity.</p></li>
<li><p><strong>Sample averages hide regime shifts.</strong>  Long-run means of factor premia work only if the underlying distribution is stable—watch for structural breaks.</p></li>
<li><p><strong>True alpha decays and crowds out.</strong>  The moment an idea becomes popular its extra return is competed away, and an overcrowded trade can even turn negative.</p></li>
<li><p><strong>Edge often comes from thinking, not just estimating.</strong>  Fundamental valuation, understanding forced flows, and leveraging alternative data can reveal mispricings that statistics alone miss.</p></li>
<li><p><strong>Put every idea on the same timeline.</strong>  Converting a one-year price target into a monthly alpha ensures consistent sizing and portfolio aggregation.</p></li>
<li><p><strong>Test for hidden factor exposure before acting.</strong>  If the bulk of expected return comes from market or sector movements, a hedged or broader trade is usually superior.</p></li>
</ul>
<hr class="docutils" />
<blockquote>
<div><h4 class="rubric" id="extra-material-the-normal-distribution">Extra Material: The Normal distribution</h4>
</div></blockquote>
<ul class="simple">
<li><p>Most of what we do does not depend on the assumption of normality</p></li>
<li><p>But normal distributions are very useful in statistical tests</p></li>
<li><p>And they are also not a bad approximation for return data at low frequency (monthly/year)</p></li>
<li><p>Probability that any random draw form a Normal distribution random variable <span class="math notranslate nohighlight">\(\tilde{x}\)</span> is within <span class="math notranslate nohighlight">\(n=1\)</span> standard deviation from the mean is 0.6826</p></li>
</ul>
<div class="math notranslate nohighlight">
\[Prob(E[\tilde{x}]-1\sigma(\tilde{x})\leq \tilde{x}\leq E[\tilde{x}]+1\sigma(\tilde{x}))=0.6826\]</div>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(n=2,Prob(\cdot)=0.9550\)</span></p></li>
</ul>
<div class="math notranslate nohighlight">
\[Prob(E[\tilde{x}]-2\sigma(\tilde{x})\leq \tilde{x}\leq E[\tilde{x}]+2\sigma(\tilde{x}))=0.9550\]</div>
<ul class="simple">
<li><p>it is convenient to to transform a normally distributed r.v. into units of standard deviations from it’s mean</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\tilde{z}=\frac{\tilde{x}-E[\tilde{x}]}{\sigma(\tilde{x})}\]</div>
<ul class="simple">
<li><p>This follows the “standard” normal distribution, which has mean 0 and and standard deviation 1</p></li>
<li><p>can you show that is indeed the case that z has mean zero and standard devaiton 1?</p></li>
<li><p>This means that the normal distribution is completely characterized by it’s first two moments</p></li>
<li><p>This means that the investment problem is much more tractable too!</p></li>
<li><p>Only two moments to worry about:</p>
<ul>
<li><p>The expected return of the portfolio</p></li>
<li><p>it’s variance</p></li>
<li><p>The probability of really bad tail events will follow immediately from these two!</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">norm</span>

<span class="c1">#quantile function</span>
<span class="n">x</span><span class="o">=</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.95</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.95</span><span class="p">))</span>
<span class="c1"># cdf</span>
<span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.6448536269514722
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.95
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chapters/Finance"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="CapitalAllocationI.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">7. </span>Capital Allocation</p>
      </div>
    </a>
    <a class="right-next"
       href="Timing.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">9. </span>Timing</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-do-we-need-to-know-to-invest">8.1. What do we need to know to invest?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#betas">8.2. Betas</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exponential-decay-models">8.2.1. Exponential decay models</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#variances">8.3. Variances</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#indio-vol">8.3.1. Indio Vol</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cross-section-vs-time-series">8.3.2. Cross-Section vs Time-series</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#expected-returns">8.4. Expected returns</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#factor-risk-premia">8.4.1. Factor Risk-Premia</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#alpha-is-all-you-need">8.4.2. Alpha is all you need</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#alpha-quantification-procedure">8.4.2.1. Alpha Quantification Procedure</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#real-alpha-is-unique-and-cannot-be-driven-by-broad-macro-factors">8.4.2.2. Real Alpha is unique and cannot be driven by broad macro factors</a></li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Alan Moreira
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2021 Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0).
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>