
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>12. Performance Evaluation &#8212; Quantitative Investing</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/book.css?v=c2893119" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapters/Finance/Performance_evaluation';</script>
    <link rel="canonical" href="https://amoreira2.github.io/Fin418/chapters/Finance/Performance_evaluation.html" />
    <link rel="icon" href="../../_static/figuremain2.jpg"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="13. Machine Learning" href="MachineLearning.html" />
    <link rel="prev" title="11. Capital Allocation II" href="CapitalAllocationII.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/figuremain2.jpg" class="logo__image only-light" alt="Quantitative Investing - Home"/>
    <script>document.write(`<img src="../../_static/figuremain2.jpg" class="logo__image only-dark" alt="Quantitative Investing - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../01/what-is-quant-investing.html">1. What is Data Driven Investing?</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../01/statistical-techniques.html">1.1. Statistical Techniques</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01/computational-tools.html">1.2. Computational tools</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../02/getting_started.html">2. Getting Started</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../02/cloud_setup.html">2.3. Cloud Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02/local_install.html">2.4. Local installation</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../essentials/intro.html">3. Python Essentials</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../essentials/basics.html">3.1. Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/collections.html">3.2. Collections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/numpy.html">3.3. Numpy</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../essentials/introtopandas.html">3.4. Pandas</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/the_index.html">3.4.3. Indexing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/timeseries.html">3.4.4. Time-Series</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/reshape.html">3.4.5. Reshape</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/merge.html">3.4.6. Merge</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/groupby.html">3.4.7. Group-by</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/matplotlib.html">3.4.8. Plotting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/data_clean.html">3.4.9. Cleaning data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/storage_formats.html">3.4.10. Data Storage</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/control_flow.html">3.5. Flow control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/functions.html">3.6. Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/plotting.html">3.7. Plotting</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="IntrotoReturns.html">4. Introduction to Asset Returns</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="TheChoiceofFrequency.html">4.5. The Choice of Frequency and Annualization of Returns</a></li>
<li class="toctree-l2"><a class="reference internal" href="UsingAPI.html">4.6. Data APIs</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="FactorModels.html">5. Factor Models</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="PortfolioMath.html">6. Portfolios</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../scientific/linear_algebra1.html">6.5. Linear Algebra Review</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="CapitalAllocationI.html">7. Capital Allocation</a></li>
<li class="toctree-l1"><a class="reference internal" href="FactorModelEstimation.html">8. Factor Model Estimation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="Timing.html">9. Timing Strategies</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="MarketTiming.html">9.1. Expected Returns Timing</a></li>
<li class="toctree-l2"><a class="reference internal" href="Volatilitytiming.html">9.2. Volatility Timing</a></li>

</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="crosssectionalequitystrategies.html">10. Cross-Sectional Equity Strategies</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="Momentum.html">10.3. Momentum factor</a></li>
<li class="toctree-l2"><a class="reference internal" href="Factors.html">10.4. An overview of factors</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="CapitalAllocationII.html">11. Capital Allocation II</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">12. Performance Evaluation</a></li>
<li class="toctree-l1"><a class="reference internal" href="MachineLearning.html">13. Machine Learning in Finance</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="MultiFactorModels.html">14. Multi Factor Models</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="InterpretingFactorModels.html">14.6. 📊 Interpreting Factor Models</a></li>


</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="RiskManagement.html">15. Risk Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="TradingCosts.html">16. Liquidity and Trading Cost Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="LeverageandShorting.html">17. Leverage, Shorting, and Limits to Arbitrage</a></li>
<li class="toctree-l1"><a class="reference internal" href="GenAIandLLMsinFinance.html">18. Gen AI and LLMs in Finance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../additional/additional.html">19. Additional Statistics Material</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Assignments/Assignments.html">20. Assignments</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment1.html">20.1. Assignment 1</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/amoreira2/Fin418/blob/main/chapters/Finance/Performance_evaluation.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/amoreira2/Fin418" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/amoreira2/Fin418/issues/new?title=Issue%20on%20page%20%2Fchapters/Finance/Performance_evaluation.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/chapters/Finance/Performance_evaluation.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Performance Evaluation</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#alpha-test">12.1. Alpha Test</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-we-focus-on-alpha">12.2. Why we focus on Alpha?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-mve-allocation-across-factors">12.3. Example: MVE allocation across factors</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-basic-problem-of-overfitting">12.4. The basic problem of overfitting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#be-clear-about-you-goal">12.5. Be clear about you goal</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-guard-against-it">12.6. How to guard against it?</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#additional-diagnostics">12.6.1. Additional Diagnostics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#adjusting-for-discarded-signals">12.6.2. Adjusting for Discarded Signals</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-split-you-sample">12.7. How to split you sample?</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#robustifying-your-backtests">12.7.1. Robustifying your Backtests</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#publication-bias-or-famous-bias-or-incubation-bias">12.8. Publication bias (or Famous bias or incubation bias…)</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="cell tag_hide-cell docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell content</p>
<p class="expanded admonition-title">Hide code cell content</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">statsmodels.api</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sm</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pandas_datareader.data</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">web</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_factors</span><span class="p">(</span><span class="n">factors</span><span class="o">=</span><span class="s1">&#39;CAPM&#39;</span><span class="p">,</span><span class="n">freq</span><span class="o">=</span><span class="s1">&#39;daily&#39;</span><span class="p">):</span>   
    
    <span class="k">if</span> <span class="n">freq</span><span class="o">==</span><span class="s1">&#39;monthly&#39;</span><span class="p">:</span>
        <span class="n">freq_label</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">freq_label</span><span class="o">=</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">freq</span>


    <span class="k">if</span> <span class="n">factors</span><span class="o">==</span><span class="s1">&#39;CAPM&#39;</span><span class="p">:</span>
        <span class="n">fama_french</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="s2">&quot;F-F_Research_Data_Factors&quot;</span><span class="o">+</span><span class="n">freq_label</span><span class="p">,</span> <span class="s2">&quot;famafrench&quot;</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="s2">&quot;1921-01-01&quot;</span><span class="p">)</span>
        <span class="n">daily_data</span> <span class="o">=</span> <span class="n">fama_french</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
     
        <span class="n">df_factor</span> <span class="o">=</span> <span class="n">daily_data</span><span class="p">[[</span><span class="s1">&#39;RF&#39;</span><span class="p">,</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]]</span> 
    <span class="k">elif</span> <span class="n">factors</span><span class="o">==</span><span class="s1">&#39;FF3&#39;</span><span class="p">:</span>
        <span class="n">fama_french</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="s2">&quot;F-F_Research_Data_Factors&quot;</span><span class="o">+</span><span class="n">freq_label</span><span class="p">,</span> <span class="s2">&quot;famafrench&quot;</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="s2">&quot;1921-01-01&quot;</span><span class="p">)</span>
        <span class="n">daily_data</span> <span class="o">=</span> <span class="n">fama_french</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">df_factor</span> <span class="o">=</span> <span class="n">daily_data</span><span class="p">[[</span><span class="s1">&#39;RF&#39;</span><span class="p">,</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">,</span><span class="s1">&#39;SMB&#39;</span><span class="p">,</span><span class="s1">&#39;HML&#39;</span><span class="p">]]</span>
    <span class="k">elif</span> <span class="n">factors</span><span class="o">==</span><span class="s1">&#39;FF5&#39;</span><span class="p">:</span>

        <span class="n">fama_french</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="s2">&quot;F-F_Research_Data_Factors&quot;</span><span class="o">+</span><span class="n">freq_label</span><span class="p">,</span> <span class="s2">&quot;famafrench&quot;</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="s2">&quot;1921-01-01&quot;</span><span class="p">)</span>
        <span class="n">daily_data</span> <span class="o">=</span> <span class="n">fama_french</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">df_factor</span> <span class="o">=</span> <span class="n">daily_data</span><span class="p">[[</span><span class="s1">&#39;RF&#39;</span><span class="p">,</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">,</span><span class="s1">&#39;SMB&#39;</span><span class="p">,</span><span class="s1">&#39;HML&#39;</span><span class="p">]]</span>
        <span class="n">fama_french2</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="s2">&quot;F-F_Research_Data_5_Factors_2x3&quot;</span><span class="o">+</span><span class="n">freq_label</span><span class="p">,</span> <span class="s2">&quot;famafrench&quot;</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="s2">&quot;1921-01-01&quot;</span><span class="p">)</span>
        <span class="n">daily_data2</span> <span class="o">=</span> <span class="n">fama_french2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">df_factor2</span> <span class="o">=</span> <span class="n">daily_data2</span><span class="p">[[</span><span class="s1">&#39;RMW&#39;</span><span class="p">,</span><span class="s1">&#39;CMA&#39;</span><span class="p">]]</span>
        <span class="n">df_factor</span><span class="o">=</span><span class="n">df_factor</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_factor2</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>    
        
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fama_french</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="s2">&quot;F-F_Research_Data_Factors&quot;</span><span class="o">+</span><span class="n">freq_label</span><span class="p">,</span> <span class="s2">&quot;famafrench&quot;</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="s2">&quot;1921-01-01&quot;</span><span class="p">)</span>
        <span class="n">daily_data</span> <span class="o">=</span> <span class="n">fama_french</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">df_factor</span> <span class="o">=</span> <span class="n">daily_data</span><span class="p">[[</span><span class="s1">&#39;RF&#39;</span><span class="p">,</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">,</span><span class="s1">&#39;SMB&#39;</span><span class="p">,</span><span class="s1">&#39;HML&#39;</span><span class="p">]]</span>
        <span class="n">fama_french2</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="s2">&quot;F-F_Research_Data_5_Factors_2x3&quot;</span><span class="o">+</span><span class="n">freq_label</span><span class="p">,</span> <span class="s2">&quot;famafrench&quot;</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="s2">&quot;1921-01-01&quot;</span><span class="p">)</span>
        <span class="n">daily_data2</span> <span class="o">=</span> <span class="n">fama_french2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">df_factor2</span> <span class="o">=</span> <span class="n">daily_data2</span><span class="p">[[</span><span class="s1">&#39;RMW&#39;</span><span class="p">,</span><span class="s1">&#39;CMA&#39;</span><span class="p">]]</span>
        <span class="n">df_factor</span><span class="o">=</span><span class="n">df_factor</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_factor2</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>   
        <span class="n">fama_french</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="s2">&quot;F-F_Momentum_Factor&quot;</span><span class="o">+</span><span class="n">freq_label</span><span class="p">,</span> <span class="s2">&quot;famafrench&quot;</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="s2">&quot;1921-01-01&quot;</span><span class="p">)</span>
        <span class="n">df_factor</span><span class="o">=</span><span class="n">df_factor</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">fama_french</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>
        <span class="n">df_factor</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;RF&#39;</span><span class="p">,</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">,</span><span class="s1">&#39;SMB&#39;</span><span class="p">,</span><span class="s1">&#39;HML&#39;</span><span class="p">,</span><span class="s1">&#39;RMW&#39;</span><span class="p">,</span><span class="s1">&#39;CMA&#39;</span><span class="p">,</span><span class="s1">&#39;MOM&#39;</span><span class="p">]</span>    
    <span class="k">if</span> <span class="n">freq</span><span class="o">==</span><span class="s1">&#39;monthly&#39;</span><span class="p">:</span>
        <span class="n">df_factor</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_factor</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_timestamp</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">df_factor</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_factor</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        


    <span class="k">return</span> <span class="n">df_factor</span><span class="o">/</span><span class="mi">100</span>
</pre></div>
</div>
</div>
</details>
</div>
<section class="tex2jax_ignore mathjax_ignore" id="performance-evaluation">
<h1><span class="section-number">12. </span>Performance Evaluation<a class="headerlink" href="#performance-evaluation" title="Link to this heading">#</a></h1>
<hr class="docutils" />
<p><strong>🎯 Learning Objectives</strong></p>
<ol class="arabic simple">
<li><p><strong>Frame performance through risk-adjusted metrics.</strong><br />
Distinguish raw returns from <em>Sharpe ratio</em> and <em>alpha</em>; see why investors focus on excess return per unit of risk and on intercepts from factor regressions.</p></li>
<li><p><strong>Run an alpha test with the CAPM (and beyond).</strong><br />
Subtract the risk-free rate, regress the strategy’s returns on the market factor, interpret ( \alpha ), ( \beta ), t-statistics, and p-values, and decide whether apparent out-performance is statistically real.</p></li>
<li><p><strong>Quantify estimation error and sampling variation.</strong><br />
Recognize that every backtest statistic is itself a random variable; learn to compute standard errors, confidence bands, and rolling Sharpe ratios to judge stability through time.</p></li>
<li><p><strong>Diagnose and mitigate over-fitting.</strong><br />
Understand how data-mining inflates t-stats, learn the dangers of tuning on noise, and practice safeguards such as white-noise checks, cross-validation, and multiple-testing adjustments.</p></li>
<li><p><strong>Design robust backtests with true out-of-sample evidence.</strong><br />
Build hold-out periods, k-fold splits, and alternating-month/-year samples; evaluate whether a discovery survives when it has <em>never</em> been seen by the model.</p></li>
<li><p><strong>Combine strategies intelligently.</strong><br />
Explore the joint evaluation of momentum and value portfolios, estimating optimal weights in one subsample and validating them in another; appreciate how covariance matters as much as individual Sharpe ratios.</p></li>
<li><p><strong>Detect publication and incubation bias.</strong><br />
Compare pre- and post-publication performance, measure how fame or capital influx erodes returns, and adjust expectations accordingly.</p></li>
<li><p><strong>Translate diagnostics into portfolio sizing.</strong><br />
Use a clear, calibrated discovery process to accept, size, or discard strategies based on the reliability of their alpha and the robustness of their risk profile.</p></li>
</ol>
<hr class="docutils" />
<p>Our premise here is that you are looking to invest in the portfolio with the highest Sharpe Ratio.</p>
<p>Once we have our trading strategy. Lets say we have been trading for N days and have returns <span class="math notranslate nohighlight">\([r_1,r_2,....r_N]\)</span></p>
<p>What do we do?</p>
<section id="alpha-test">
<h2><span class="section-number">12.1. </span>Alpha Test<a class="headerlink" href="#alpha-test" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>subtract the risk-free rate</p></li>
<li><p>Choose  a factor model–We will work with CAPM for now</p></li>
<li><p>Run a regression of your asset on the factor(s)</p></li>
</ol>
<div class="math notranslate nohighlight">
\[r^{e,j}_t=\alpha_j +\beta_{j}r^{mve}_t +\epsilon_{j,t}\]</div>
<ul class="simple">
<li><p>Then this relation predicts that the intercept, the alpha, should be  zero</p></li>
<li><p>It is important here that both the test assets and the reference portfolios are all <strong>excess returns</strong>. This makes the test really simple. If you use returns instead the prediction about the intercept will be different because of the risk-free rate</p></li>
<li><p>We refer to these assets on the Left Hand Side of the regression as <strong>Test Assets</strong> and the asset on the right as the <strong>model</strong>, which is the candidate tangency portfolio.</p></li>
<li><p>So far we have be working with the market as such factor–as the candidate MVE.</p></li>
<li><p>This means that we can use this to test whether a new strategy adds value relative to another strategy (i.e. the model).</p></li>
<li><p>If the model is “right” than we will fail to reject that the alphas are zero, i.e. the relationship between average returns and betas holds and you cannot get any extra return without increasing your loading on the factor</p></li>
</ul>
<ol class="arabic simple" start="4">
<li><p>Test whether the alpha is positive or any particular threshold</p></li>
</ol>
<ul>
<li><p>Test if <span class="math notranslate nohighlight">\(\alpha_i \geq \underline{\alpha} \)</span></p>
<ul class="simple">
<li><p>You basically do a standard t-test</p></li>
</ul>
<div class="math notranslate nohighlight">
\[t=\frac{\alpha_i-\underline{\alpha} }{\sigma(\alpha_i)}\]</div>
</li>
<li><p>for <span class="math notranslate nohighlight">\(\underline{\alpha}=0\)</span>  We say</p></li>
</ul>
<ul class="simple">
<li><p>if <span class="math notranslate nohighlight">\(|t|\geq 1.64\)</span> there is a 90% chance that the factor is MVE</p></li>
<li><p>if <span class="math notranslate nohighlight">\(|t|\geq 1.96\)</span> there is a 5% chance that the factor is MVE</p></li>
<li><p>if <span class="math notranslate nohighlight">\(|t|\geq 2.1\)</span> there is a 2.5% chance that the factor is MVE</p></li>
<li><p>if <span class="math notranslate nohighlight">\(|t|\geq 2.6\)</span> there is a 1% chance that the factor is MVE</p></li>
</ul>
<p>OR reinstated from this class perspective</p>
<ul class="simple">
<li><p>If <span class="math notranslate nohighlight">\(t&gt;2,6\)</span>, there is a 99% change that the test asset when optimally combined with the factor  will produce a higher Sharpe Ratio than the factor alone</p></li>
</ul>
<p>But often you will have a hurdle rate higher than zero. For example a pod-shop might want have pods that have sufficiently large alphas</p>
</section>
<section id="why-we-focus-on-alpha">
<h2><span class="section-number">12.2. </span>Why we focus on Alpha?<a class="headerlink" href="#why-we-focus-on-alpha" title="Link to this heading">#</a></h2>
<ul>
<li><p>The Time-series regression asks the following question:</p>
<blockquote>
<div><p>Can I replicate  the average return I get in asset <span class="math notranslate nohighlight">\(i\)</span> by investing in the factor?
The betas are exactly such replicating portfolio</p>
</div></blockquote>
</li>
<li><p>Having a non-zero alpha DOES NOT mean that you prefer asset <span class="math notranslate nohighlight">\(i\)</span> to the factor!</p></li>
<li><p>But it does mean, that you can do better by investing in both assets</p>
<ul class="simple">
<li><p>Obviously with a negative weight if the alpha is negative</p></li>
<li><p>and a positive weight if the alpha is positive</p></li>
</ul>
</li>
<li><p>The alpha test literally asks if the factor is the tangency portfolio with respect to the investment opportunity that includes the test asset (the asset in the left of the regression) and the factor (the asset on the right)</p></li>
<li><p>A different way to put it is that a non-zero alpha means that the asset expands the mean-variance frontier relative to an opportunity set that only has the reference factor</p></li>
</ul>
<p>Example:</p>
<p>Suppose you are a principal  at Citadel deciding on a new pod to the hedge fund.</p>
<p>You are monitoring performance of several outside groups. What do you have to see to invite them to join citadel?</p>
<p>Alternatively you can think about a new trading idea that you monitor it’s theoretical performance but has not yet deployed capital into it. What do you have to see before going in?</p>
<p>Of course, the decision will depend on many things. Lets say</p>
<ul class="simple">
<li><p>You want to be p=70% certain that the appraisal ratio is higher than 1</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\frac{\alpha_i-\underline{\alpha} }{\sigma_{\epsilon}\sqrt{T}}&gt;t(p)\]</div>
<p>We can rewrite in terms of the appraisal ratio</p>
<div class="math notranslate nohighlight">
\[(ar_i-\underline{ar})\sqrt{T}&gt;t(p)\]</div>
<div class="math notranslate nohighlight">
\[ar_i&gt;\underline{ar}+\frac{t(p)}{\sqrt{T}}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">norm</span>

<span class="k">def</span><span class="w"> </span><span class="nf">plot_alpha_threshold</span><span class="p">(</span><span class="n">ar</span><span class="p">,</span> <span class="n">T_max</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots the threshold for alpha as a function of T.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    ar (float): Appraisal ratio</span>
<span class="sd">    sigma (float): Volatility</span>
<span class="sd">    T_max (int): Maximum value of T to plot</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">T_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">tvalue</span><span class="o">=</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">alpha_threshold</span> <span class="o">=</span> <span class="p">(</span><span class="n">tvalue</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">T</span><span class="o">/</span><span class="mi">12</span><span class="p">)</span><span class="o">+</span><span class="n">ar</span><span class="p">)</span> 

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T</span><span class="o">/</span><span class="mi">12</span><span class="p">,</span> <span class="n">alpha_threshold</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;AR=</span><span class="si">{</span><span class="n">ar</span><span class="si">}</span><span class="s1">, p=</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;AR Threshold&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;AR Threshold as a Function of T&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Example usage</span>
<span class="n">plot_alpha_threshold</span><span class="p">(</span><span class="n">ar</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">T_max</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="mi">12</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/17ef6fa8ed5f2322b8683e17577b7619d19e97e887bdd331891709aec1d4566d.png" src="../../_images/17ef6fa8ed5f2322b8683e17577b7619d19e97e887bdd331891709aec1d4566d.png" />
</div>
</div>
<ul class="simple">
<li><p>You have a very stringent rule early on, but converge to your target over time as uncertainty shrinks</p></li>
<li><p>It takes 1 year with Appraisal ratios close to 1.5</p></li>
<li><p>After the first year it decays very slowly</p></li>
<li><p>But the big takeway is : The longer the sample, the lower the realized Appraisal/alpha needs to be for me to be convinced that these returns were produced by a high alpha strategy</p></li>
</ul>
<p>When to fire a pod? When Give up on a strategy?</p>
<ul class="simple">
<li><p>Lets say you give up ona strategy or pod when you are p=75% confident that their AR is below your target</p></li>
</ul>
<div class="math notranslate nohighlight">
\[ar_i&lt;\underline{ar}+\frac{t(1-p)}{\sqrt{T}}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_alpha_threshold</span><span class="p">(</span><span class="n">ar</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">T_max</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="mi">12</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ea2f4f858d287a3dabc4ffdfab1e3961926f7aeb9b222d6d737d648c3528cca6.png" src="../../_images/ea2f4f858d287a3dabc4ffdfab1e3961926f7aeb9b222d6d737d648c3528cca6.png" />
</div>
</div>
<p>Now we have the opposite.</p>
<p>You are quite lenient early on (because uncertainty is high)</p>
<p>But very quickly start to expecting high Appraisal Ratios</p>
<p>By the end of the first year, the pod/strategy has to have an AR higher than 0.25</p>
<hr class="docutils" />
<p><em>Aside:  There is a tight link between the t-stat of the time-series regression and the appraisal ratio</em></p>
<ul class="simple">
<li><p>Note that is the t-stat was constructed under the assumption that returns are i.i.d., we have</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\sigma(\alpha)=\frac{\sigma(\epsilon)}{\sqrt{T}}=\frac{\sigma_e}{\sqrt{T}} \]</div>
<ul class="simple">
<li><p>Therefore we have
$<span class="math notranslate nohighlight">\(
Appraisal=\frac{\alpha}{\sigma_e}
=\frac{\alpha}{\sigma(\alpha)\sqrt{T}}
=\frac{\text{t-stat}}{\sqrt{T}}
\)</span>$</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="example-mve-allocation-across-factors">
<h2><span class="section-number">12.3. </span>Example: MVE allocation across factors<a class="headerlink" href="#example-mve-allocation-across-factors" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">MVE</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">VolTarget</span><span class="o">=</span><span class="mf">0.1</span><span class="o">/</span><span class="mi">12</span><span class="o">**</span><span class="mf">0.5</span><span class="p">):</span>
    <span class="c1"># strategy estimation</span>
    <span class="n">VarR</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">cov</span><span class="p">()</span>
    <span class="n">ER</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">W</span><span class="o">=</span><span class="n">ER</span><span class="nd">@np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">VarR</span><span class="p">)</span>
    <span class="n">VarW</span><span class="o">=</span><span class="n">W</span><span class="nd">@VarR@W</span>
    <span class="c1"># leverage to target volatility</span>
    <span class="n">w</span><span class="o">=</span> <span class="n">VolTarget</span><span class="o">/</span><span class="n">VarW</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="n">Ww</span><span class="o">=</span><span class="n">w</span><span class="o">*</span><span class="n">W</span>
    <span class="n">SR</span><span class="o">=</span><span class="p">(</span><span class="n">df</span><span class="nd">@Ww</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="n">df</span><span class="nd">@Ww</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">*</span><span class="mi">12</span><span class="o">**</span><span class="mf">0.5</span> 
    <span class="n">vol</span><span class="o">=</span><span class="p">(</span><span class="n">df</span><span class="nd">@Ww</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">*</span><span class="mi">12</span><span class="o">**</span><span class="mf">0.5</span>


    <span class="c1"># Estimate alpha of Ww portfolio relative to market in estimation period</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">])</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">df</span> <span class="o">@</span> <span class="n">Ww</span>
    <span class="n">regresult</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">regresult</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">12</span>
    <span class="n">t_alpha</span> <span class="o">=</span> <span class="n">regresult</span><span class="o">.</span><span class="n">tvalues</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">AR</span><span class="o">=</span><span class="n">alpha</span><span class="o">/</span><span class="p">(</span><span class="n">regresult</span><span class="o">.</span><span class="n">resid</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">*</span><span class="mi">12</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span>


    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;SR&#39;</span><span class="p">:</span> <span class="n">SR</span><span class="p">,</span> <span class="s1">&#39;Vol&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="p">,</span><span class="s1">&#39;Alpha&#39;</span><span class="p">:</span> <span class="n">alpha</span><span class="p">,</span><span class="s1">&#39;tAlpha&#39;</span><span class="p">:</span> <span class="n">t_alpha</span><span class="p">,</span><span class="s1">&#39;AR&#39;</span><span class="p">:</span> <span class="n">AR</span><span class="p">}</span>

<span class="n">df_ff6</span><span class="o">=</span><span class="n">get_factors</span><span class="p">(</span><span class="s1">&#39;ff6&#39;</span><span class="p">,</span><span class="n">freq</span><span class="o">=</span><span class="s1">&#39;monthly&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>


<span class="n">MVE</span><span class="p">(</span><span class="n">df_ff6</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;RF&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>c:\Users\alan.moreira\Anaconda3\lib\site-packages\pandas_datareader\famafrench.py:114: FutureWarning: The argument &#39;date_parser&#39; is deprecated and will be removed in a future version. Please use &#39;date_format&#39; instead, or read your data in as &#39;object&#39; dtype and then call &#39;to_datetime&#39;.
  df = read_csv(StringIO(&quot;Date&quot; + src[start:]), **params)
c:\Users\alan.moreira\Anaconda3\lib\site-packages\pandas_datareader\famafrench.py:114: FutureWarning: The argument &#39;date_parser&#39; is deprecated and will be removed in a future version. Please use &#39;date_format&#39; instead, or read your data in as &#39;object&#39; dtype and then call &#39;to_datetime&#39;.
  df = read_csv(StringIO(&quot;Date&quot; + src[start:]), **params)
c:\Users\alan.moreira\Anaconda3\lib\site-packages\pandas_datareader\famafrench.py:114: FutureWarning: The argument &#39;date_parser&#39; is deprecated and will be removed in a future version. Please use &#39;date_format&#39; instead, or read your data in as &#39;object&#39; dtype and then call &#39;to_datetime&#39;.
  df = read_csv(StringIO(&quot;Date&quot; + src[start:]), **params)
c:\Users\alan.moreira\Anaconda3\lib\site-packages\pandas_datareader\famafrench.py:114: FutureWarning: The argument &#39;date_parser&#39; is deprecated and will be removed in a future version. Please use &#39;date_format&#39; instead, or read your data in as &#39;object&#39; dtype and then call &#39;to_datetime&#39;.
  df = read_csv(StringIO(&quot;Date&quot; + src[start:]), **params)
c:\Users\alan.moreira\Anaconda3\lib\site-packages\pandas_datareader\famafrench.py:114: FutureWarning: The argument &#39;date_parser&#39; is deprecated and will be removed in a future version. Please use &#39;date_format&#39; instead, or read your data in as &#39;object&#39; dtype and then call &#39;to_datetime&#39;.
  df = read_csv(StringIO(&quot;Date&quot; + src[start:]), **params)
c:\Users\alan.moreira\Anaconda3\lib\site-packages\pandas_datareader\famafrench.py:114: FutureWarning: The argument &#39;date_parser&#39; is deprecated and will be removed in a future version. Please use &#39;date_format&#39; instead, or read your data in as &#39;object&#39; dtype and then call &#39;to_datetime&#39;.
  df = read_csv(StringIO(&quot;Date&quot; + src[start:]), **params)
C:\Users\alan.moreira\AppData\Local\Temp\ipykernel_7236\3217549347.py:18: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  alpha = regresult.params[0]*12
C:\Users\alan.moreira\AppData\Local\Temp\ipykernel_7236\3217549347.py:19: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  t_alpha = regresult.tvalues[0]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;SR&#39;: 1.2117990142576063,
 &#39;Vol&#39;: 0.10000000000000002,
 &#39;Alpha&#39;: 0.10439151284806436,
 &#39;tAlpha&#39;: 8.74047758202913,
 &#39;AR&#39;: 1.1247290000979995}
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Large Sharp ratios in estimation sample</p></li>
<li><p>Gigantic alpha</p></li>
<li><p>This example is particularly extreme because the strategy is literally using full sample information about the moments</p></li>
<li><p>The strategy is guaranteed to do amazing ..in sample</p></li>
<li><p>This is not even a valid trading strategy</p></li>
</ul>
<blockquote>
<div><h3 class="rubric" id="what-is-a-valid-trading-strategy">What is a Valid Trading Strategy?</h3>
<ul class="simple">
<li><p>A trading strategy is a procedure that <strong>maps any information known up to time t</strong>, into a set of trading instructions for time  <strong><span class="math notranslate nohighlight">\(T&gt;t\)</span></strong>.</p>
<ul>
<li><p>the mean-variance analysis we did so far was <strong>not</strong> a valid trading strategy:</p></li>
<li><p>we used data of the whole sample to estimate the weights of our strategy and evaluated the strategy in the same sample</p></li>
</ul>
</li>
</ul>
<ul class="simple">
<li><p>If you construct the MVE portfolio in a sample and use the CAPM to test if that strategy has alpha in that sample, you mechanically will find that the strategy indeed has alpha. You constructed it to be MVE</p></li>
<li><p>It has the most severe form of look-ahead” bias.</p></li>
</ul>
<ul class="simple">
<li><p>It is very important that the trading strategy only uses information that is known at the time of the trade</p></li>
<li><p>you obviously cannot trade on info that you don’t know</p></li>
<li><p>The weights of a trading strategy must either:</p>
<ul>
<li><p>Add up to 1. So it describes what you do with your entire capital.</p></li>
<li><p>Or add up to 0. So the strategy is self-financing. For example, borrow 1 dollar at the risk-free rate and buy 1 dollar worth of the market portfolio</p></li>
<li><p>Every time you trade on the excess returns, you can think of the weights “adding up to zero”, because it is a long-short portfolio that is long the risky asset and financing with the risk-free rate</p></li>
<li><p>In practice all strategies demand some capital as no bank allow us to borrow without putting some capital in, but these self financed strategies are quite convenient to work with.</p></li>
</ul>
</li>
</ul>
</div></blockquote>
<p>Lets now replicate how a trader could implement this strategy in reality</p>
<p>They obviously would not be able to trade in the same sample that they estimate the returns moments that was the input for optimization– this would violate the information requirement state above.</p>
<p>To replicate this will split in two samples</p>
<ul class="simple">
<li><p>Estimation sample up to 2013</p></li>
<li><p>Testing sample 2014-2024</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">MVE</span><span class="p">(</span><span class="n">df_est</span><span class="p">,</span><span class="n">df_test</span><span class="p">,</span><span class="n">VolTarget</span><span class="o">=</span><span class="mf">0.1</span><span class="o">/</span><span class="mi">12</span><span class="o">**</span><span class="mf">0.5</span><span class="p">):</span>
    <span class="c1"># strategy estimation</span>
    <span class="n">VarR</span><span class="o">=</span><span class="n">df_est</span><span class="o">.</span><span class="n">cov</span><span class="p">()</span>
    <span class="n">ER</span><span class="o">=</span><span class="n">df_est</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">W</span><span class="o">=</span><span class="n">ER</span><span class="nd">@np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">VarR</span><span class="p">)</span>
    <span class="n">VarW</span><span class="o">=</span><span class="n">W</span><span class="nd">@VarR@W</span>
    <span class="c1"># leverage to target volatility</span>
    <span class="n">w</span><span class="o">=</span> <span class="n">VolTarget</span><span class="o">/</span><span class="n">VarW</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="n">Ww</span><span class="o">=</span><span class="n">w</span><span class="o">*</span><span class="n">W</span>
    <span class="n">SR</span><span class="o">=</span><span class="p">(</span><span class="n">df_test</span><span class="nd">@Ww</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="n">df_test</span><span class="nd">@Ww</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">*</span><span class="mi">12</span><span class="o">**</span><span class="mf">0.5</span> 
    <span class="n">vol</span><span class="o">=</span><span class="p">(</span><span class="n">df_test</span><span class="nd">@Ww</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">*</span><span class="mi">12</span><span class="o">**</span><span class="mf">0.5</span>


    <span class="c1"># Estimate alpha of Ww portfolio relative to market in estimation period</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">df_test</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">])</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">df_test</span> <span class="o">@</span> <span class="n">Ww</span>
    <span class="n">regresult</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">regresult</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">12</span>
    <span class="n">t_alpha</span> <span class="o">=</span> <span class="n">regresult</span><span class="o">.</span><span class="n">tvalues</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">AR</span><span class="o">=</span><span class="n">alpha</span><span class="o">/</span><span class="p">(</span><span class="n">regresult</span><span class="o">.</span><span class="n">resid</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">*</span><span class="mi">12</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span>


    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;SR&#39;</span><span class="p">:</span> <span class="n">SR</span><span class="p">,</span> <span class="s1">&#39;Vol&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="p">,</span><span class="s1">&#39;Alpha&#39;</span><span class="p">:</span> <span class="n">alpha</span><span class="p">,</span><span class="s1">&#39;tAlpha&#39;</span><span class="p">:</span> <span class="n">t_alpha</span><span class="p">,</span><span class="s1">&#39;AR&#39;</span><span class="p">:</span> <span class="n">AR</span><span class="p">}</span>



<span class="c1"># estimate and test in the same period (up to 2013)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">MVE</span><span class="p">(</span><span class="n">df_ff6</span><span class="p">[:</span><span class="s1">&#39;2013&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;RF&#39;</span><span class="p">),</span><span class="n">df_ff6</span><span class="p">[:</span><span class="s1">&#39;2013&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;RF&#39;</span><span class="p">)))</span>

<span class="c1"># estimate with data up to 2013 and test in the period (2014-2024)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">MVE</span><span class="p">(</span><span class="n">df_ff6</span><span class="p">[:</span><span class="s1">&#39;2013&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;RF&#39;</span><span class="p">),</span><span class="n">df_ff6</span><span class="p">[</span><span class="s1">&#39;2014&#39;</span><span class="p">:]</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;RF&#39;</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;SR&#39;: 1.3561433527237596, &#39;Vol&#39;: 0.09999999999999996, &#39;Alpha&#39;: 0.1246857103192843, &#39;tAlpha&#39;: 9.17651440156582, &#39;AR&#39;: 1.3003526338233706}
{&#39;SR&#39;: 0.5815780691881101, &#39;Vol&#39;: 0.11920484907925707, &#39;Alpha&#39;: 0.034829878422109814, &#39;tAlpha&#39;: 1.0202350059123126, &#39;AR&#39;: 0.31614968598421284}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\alan.moreira\AppData\Local\Temp\ipykernel_7236\985445017.py:18: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  alpha = regresult.params[0]*12
C:\Users\alan.moreira\AppData\Local\Temp\ipykernel_7236\985445017.py:19: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  t_alpha = regresult.tvalues[0]
C:\Users\alan.moreira\AppData\Local\Temp\ipykernel_7236\985445017.py:18: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  alpha = regresult.params[0]*12
C:\Users\alan.moreira\AppData\Local\Temp\ipykernel_7236\985445017.py:19: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  t_alpha = regresult.tvalues[0]
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>What do you see here?</p></li>
<li><p>Is that expected?</p></li>
<li><p>Why this is happening?</p></li>
<li><p>we can’t even reject a zero alpha?</p></li>
<li><p>Is 10 years enough time to tell? Maybe the sample is too short</p></li>
<li><p>Key question is: If we think our AR is 1.3, would 10 years be enough to reject the null of zero alpha?</p></li>
</ul>
<p>Under the null that our strategy indeed has such high alpha as in the estimation sample, what is the probability you observe an alpha as low as we observe for a sample of T years?</p>
<p>The pvalue associate with a particular realized alpha</p>
<div class="math notranslate nohighlight">
\[p=F\left(\frac{\alpha_{test}-\alpha_{est}}{\sigma_{\alpha}}\right)=F\left(\frac{\alpha_{test}-\alpha_{est}}{\sigma_{\epsilon}}\sqrt{T}\right)\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the parameters</span>
<span class="n">alpha_est</span> <span class="o">=</span> <span class="mf">0.12</span>
<span class="n">alpha_test</span> <span class="o">=</span> <span class="mf">0.038</span>
<span class="n">ar_est</span><span class="o">=</span><span class="mf">1.3</span>
<span class="n">ar_test</span><span class="o">=</span><span class="mf">0.3</span>
<span class="n">sigmae_test</span><span class="o">=</span><span class="n">alpha_test</span><span class="o">/</span><span class="n">ar_test</span> <span class="c1">#( I am recovering the sigmae from the AR)</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>  <span class="c1"># 10 years</span>

<span class="c1"># Calculate the probabilities that we would observe such low alpha in a sample that large if out estimation sample is correct</span>
<span class="n">probabilities</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">((</span><span class="n">alpha_test</span> <span class="o">-</span> <span class="n">alpha_est</span><span class="p">)</span><span class="o">/</span><span class="n">sigmae_test</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">T</span><span class="p">))</span>

<span class="c1"># Plot the probabilities</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T</span> <span class="p">,</span> <span class="n">probabilities</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;ar_est=</span><span class="si">{</span><span class="n">ar_est</span><span class="si">}</span><span class="s1">, ar_test=</span><span class="si">{</span><span class="n">ar_test</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Years&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Probability&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Probability as a Function of Time&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/987a147235f000be39d9f88f5490a86f45c8cd93ea42406e4dcd3fd206d334a6.png" src="../../_images/987a147235f000be39d9f88f5490a86f45c8cd93ea42406e4dcd3fd206d334a6.png" />
</div>
</div>
<ul class="simple">
<li><p>This give us a quickly way to diagnostic if the sample is large enough</p></li>
<li><p>For example, if you shrink the sample you will see that observing such low alpha becomes increasingly likely suggesting the test sample would not be large enough</p></li>
<li><p>You have to design your test sample having in mind what do you want to test</p></li>
<li><p>Thinking clearly about the desired size of your estimation sample is very important</p></li>
<li><p>A sample that is too short, will not allow you properly test your strategy</p></li>
<li><p>You see that with 1 year of sample and a mediocre alpha you still assign north of 20% probability that the strategy has the alpha in the estimation sample</p></li>
<li><p>You want to leave enough data so that you can actually test the strategy</p></li>
</ul>
</section>
<section id="the-basic-problem-of-overfitting">
<h2><span class="section-number">12.4. </span>The basic problem of overfitting<a class="headerlink" href="#the-basic-problem-of-overfitting" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>In these example we are testing some fixed strategy</p></li>
<li><p>In practice we use data to design the strategy</p></li>
<li><p>Any sample estimate  is itself a random variable.  The uncertainty in these estimates may encourage us to:</p>
<ul>
<li><p>Select signals that are pure noise with no real predictive power.</p></li>
<li><p>Select real signals but overweight their importance to the model.</p></li>
<li><p>Reject signals that are real but that did not show up in the sample.</p></li>
<li><p>When choosing model weights, implicitly and explicitly (through optimization) we assign weights that exaggerate the overfitting problem.</p></li>
</ul>
</li>
</ul>
<p>Here is a fun twitter thread about this basic problem</p>
<ul class="simple">
<li><p><a class="reference external" href="https://twitter.com/macrocephalopod/status/1362165448205295620?s=20">overfiting</a></p></li>
</ul>
<p>It has this really nice plot that illustrates the fundamental issue</p>
<p><img alt="outofsample" src="../../_images/outofsample1.jpg" /></p>
</section>
<section id="be-clear-about-you-goal">
<h2><span class="section-number">12.5. </span>Be clear about you goal<a class="headerlink" href="#be-clear-about-you-goal" title="Link to this heading">#</a></h2>
<p>The central goal is to calibrate your discovery process</p>
<ul class="simple">
<li><p>You want to invest in strategies that have alpha, disregard the ones that don’t</p></li>
<li><p>You need to know that you are keeping strategies that are good enough</p></li>
<li><p>BUT are not so tough that you are discarding good ideas</p></li>
<li><p>Ideas are limited after all</p></li>
<li><p>The better you know the quality of your discovery, the easier will be the size your positions</p></li>
</ul>
</section>
<section id="how-to-guard-against-it">
<h2><span class="section-number">12.6. </span>How to guard against it?<a class="headerlink" href="#how-to-guard-against-it" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>Additional diagnostics</p></li>
<li><p>Think harder about your  Backtests</p></li>
<li><p>Estimation/validation/Out of Sample analysis</p></li>
</ol>
<section id="additional-diagnostics">
<h3><span class="section-number">12.6.1. </span>Additional Diagnostics<a class="headerlink" href="#additional-diagnostics" title="Link to this heading">#</a></h3>
<p>You should look at many many things!</p>
<ol class="arabic simple">
<li><p>Strategy Sharpe Ratio</p></li>
<li><p>Report t-stat of mean return</p></li>
<li><p>Alpha and t-stat of alpha</p></li>
<li><p>Confidence intervals around key results including SR</p></li>
<li><p>Cumulative return  and drawdown graphs</p>
<ul class="simple">
<li><p>where the performance is coming form? Is it steady? When it does poorly?</p></li>
</ul>
</li>
<li><p>Report percentage of observations with +/- 3 std events</p></li>
<li><p>Remove “influential data points”: Calculate fraction of data points needed to halve estimated Sharpe ratio.</p></li>
<li><p>When comparing Strategies, always do it over the same sample period**</p></li>
</ol>
<p>We will now split up our code in terms of strategy weight estimation and diagnostics</p>
<p>This makes the function very portable to evaluate alternative strategies</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">MVE</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">VolTarget</span><span class="p">):</span>
    <span class="n">VarR</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">cov</span><span class="p">()</span>
    <span class="n">ER</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">W</span><span class="o">=</span><span class="n">ER</span><span class="nd">@np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">VarR</span><span class="p">)</span>
    <span class="n">VarW</span><span class="o">=</span><span class="n">W</span><span class="nd">@VarR@W</span>
    <span class="n">w</span><span class="o">=</span> <span class="n">VolTarget</span><span class="o">/</span><span class="n">VarW</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="n">Ww</span><span class="o">=</span><span class="n">w</span><span class="o">*</span><span class="n">W</span>

    <span class="k">return</span> <span class="n">Ww</span>


<span class="n">Ww</span><span class="o">=</span><span class="n">MVE</span><span class="p">(</span><span class="n">df_ff6</span><span class="p">[</span><span class="s1">&#39;1963&#39;</span><span class="p">:</span><span class="nb">str</span><span class="p">(</span><span class="mi">1993</span><span class="p">)]</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;RF&#39;</span><span class="p">),</span><span class="n">VolTarget</span><span class="o">=</span><span class="mf">0.1</span><span class="o">/</span><span class="mi">12</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">Ww</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0.28438373, 0.41158513, 0.60546531, 1.55642918, 1.05920795,
       0.42952517])
</pre></div>
</div>
</div>
</div>
<p>Here is our diagnostic function</p>
<p>It is still incomplete as we will be adding additional diagnostics through the notebook</p>
<p>you should think as a function that we add all diagnostics you want to see and then you run any strategy through it</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">Diagnostics</span><span class="p">(</span><span class="n">W</span><span class="p">,</span><span class="n">df</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">results</span><span class="o">=</span><span class="p">{}</span>

    <span class="n">Rf</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;RF&#39;</span><span class="p">]</span>
    <span class="n">Factor</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span>
    <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;RF&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">R</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># we use the returns of the portfolio if R is provided or construct the returns from the weights</span>
        <span class="n">R</span><span class="o">=</span><span class="n">df</span> <span class="o">@</span> <span class="n">W</span>
   
 
    <span class="n">T</span><span class="o">=</span><span class="n">R</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;SR&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">R</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="n">R</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">*</span><span class="mi">12</span><span class="o">**</span><span class="mf">0.5</span> 
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;SR_factor&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">Factor</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="n">Factor</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">*</span><span class="mi">12</span><span class="o">**</span><span class="mf">0.5</span> 
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;Vol&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">R</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">*</span><span class="mi">12</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;Vol_factor&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">Factor</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">*</span><span class="mi">12</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">R</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">*</span><span class="mi">12</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;t_mean&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">R</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="n">R</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">*</span><span class="n">T</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;mean_factor&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">Factor</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">*</span><span class="mi">12</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;t_mean_factor&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">Factor</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="n">R</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">*</span><span class="n">T</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="c1"># Estimate alpha of Ww portfolio relative to market in estimation period</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">Factor</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">R</span>
    <span class="n">regresult</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">regresult</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">12</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;t_alpha&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">regresult</span><span class="o">.</span><span class="n">tvalues</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;AR&#39;</span><span class="p">]</span><span class="o">=</span>  <span class="n">results</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">regresult</span><span class="o">.</span><span class="n">resid</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">*</span><span class="mi">12</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;tails&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">R</span> <span class="o">&lt;-</span><span class="mi">3</span><span class="o">*</span><span class="n">R</span><span class="o">.</span><span class="n">std</span><span class="p">())</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">+</span><span class="p">(</span><span class="n">R</span> <span class="o">&gt;</span><span class="mi">3</span><span class="o">*</span><span class="n">R</span><span class="o">.</span><span class="n">std</span><span class="p">())</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;tails_factor&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">Factor</span> <span class="o">&lt;-</span><span class="mi">3</span><span class="o">*</span><span class="n">Factor</span><span class="o">.</span><span class="n">std</span><span class="p">())</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">+</span><span class="p">(</span><span class="n">Factor</span> <span class="o">&gt;</span><span class="mi">3</span><span class="o">*</span><span class="n">Factor</span><span class="o">.</span><span class="n">std</span><span class="p">())</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;min_ret&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">R</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;min_factor&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">Factor</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
    <span class="c1"># cumulative returs</span>
    <span class="p">(</span><span class="n">R</span><span class="o">+</span><span class="n">Rf</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">logy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="p">(</span><span class="n">Rf</span><span class="o">+</span><span class="n">Factor</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">logy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Portfolio&#39;</span><span class="p">,</span><span class="s1">&#39;Market&#39;</span><span class="p">])</span>
 


<span class="c1">### Things to add that we discuss below</span>

    <span class="c1"># 2. Drawdown plots</span>
    <span class="c1"># 3. Fraction of observation to half the mean returns</span>
    <span class="c1"># 4. Sharpe Ratio standard deviation/t-test</span>

    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;t_SR&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="c1"># to be implemented</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;t_SR_factor&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="c1"># to be implemented</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;fraction_tohalf&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="c1"># to be implemented</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;fraction_tohalf_factor&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="c1"># to be implemented</span>

    <span class="n">formatted_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">formatted_dict</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>


<span class="n">split_year</span><span class="o">=</span><span class="mi">2012</span>
<span class="n">df_est</span><span class="o">=</span><span class="n">df_ff6</span><span class="p">[</span><span class="s1">&#39;1963&#39;</span><span class="p">:</span><span class="nb">str</span><span class="p">(</span><span class="n">split_year</span><span class="p">)]</span>
<span class="n">Volmkt</span><span class="o">=</span><span class="n">df_est</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<span class="n">Ww</span><span class="o">=</span><span class="n">MVE</span><span class="p">(</span><span class="n">df_est</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;RF&#39;</span><span class="p">),</span><span class="n">VolTarget</span><span class="o">=</span><span class="n">Volmkt</span><span class="p">)</span>
<span class="n">df_test</span><span class="o">=</span><span class="n">df_ff6</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">split_year</span><span class="o">+</span><span class="mi">1</span><span class="p">):]</span>

<span class="n">Results</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">Results</span><span class="p">[</span><span class="s1">&#39;Est&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">Diagnostics</span><span class="p">(</span><span class="n">Ww</span><span class="p">,</span><span class="n">df_est</span><span class="p">)</span>
<span class="n">Results</span><span class="p">[</span><span class="s1">&#39;Test&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">Diagnostics</span><span class="p">(</span><span class="n">Ww</span><span class="p">,</span><span class="n">df_test</span><span class="p">)</span>

<span class="n">Results</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\alan.moreira\AppData\Local\Temp\ipykernel_7236\2254644634.py:25: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  results[&#39;alpha&#39;] = regresult.params[0]*12
C:\Users\alan.moreira\AppData\Local\Temp\ipykernel_7236\2254644634.py:26: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  results[&#39;t_alpha&#39;]= regresult.tvalues[0]
C:\Users\alan.moreira\AppData\Local\Temp\ipykernel_7236\2254644634.py:25: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  results[&#39;alpha&#39;] = regresult.params[0]*12
C:\Users\alan.moreira\AppData\Local\Temp\ipykernel_7236\2254644634.py:26: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  results[&#39;t_alpha&#39;]= regresult.tvalues[0]
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Est</th>
      <th>Test</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>SR</th>
      <td>1.344552</td>
      <td>0.655413</td>
    </tr>
    <tr>
      <th>SR_factor</th>
      <td>0.360988</td>
      <td>0.883752</td>
    </tr>
    <tr>
      <th>Vol</th>
      <td>0.156294</td>
      <td>0.180788</td>
    </tr>
    <tr>
      <th>Vol_factor</th>
      <td>0.155800</td>
      <td>0.150080</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>0.210145</td>
      <td>0.118491</td>
    </tr>
    <tr>
      <th>t_mean</th>
      <td>9.507416</td>
      <td>2.270417</td>
    </tr>
    <tr>
      <th>mean_factor</th>
      <td>0.056242</td>
      <td>0.132633</td>
    </tr>
    <tr>
      <th>t_mean_factor</th>
      <td>2.544511</td>
      <td>2.541407</td>
    </tr>
    <tr>
      <th>alpha</th>
      <td>NaN</td>
      <td>0.056015</td>
    </tr>
    <tr>
      <th>t_alpha</th>
      <td>NaN</td>
      <td>1.125779</td>
    </tr>
    <tr>
      <th>AR</th>
      <td>NaN</td>
      <td>0.336644</td>
    </tr>
    <tr>
      <th>tails</th>
      <td>0.020000</td>
      <td>0.006944</td>
    </tr>
    <tr>
      <th>tails_factor</th>
      <td>0.008333</td>
      <td>0.013889</td>
    </tr>
    <tr>
      <th>min_ret</th>
      <td>-0.215281</td>
      <td>-0.144920</td>
    </tr>
    <tr>
      <th>min_factor</th>
      <td>-0.232400</td>
      <td>-0.133900</td>
    </tr>
    <tr>
      <th>t_SR</th>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>t_SR_factor</th>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>fraction_tohalf</th>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>fraction_tohalf_factor</th>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
</div></div><img alt="../../_images/4ac7850af4a05c9f2caeffc36c28998a1ea4482d578a62b26fca82b3157cbcab.png" src="../../_images/4ac7850af4a05c9f2caeffc36c28998a1ea4482d578a62b26fca82b3157cbcab.png" />
<img alt="../../_images/d1a0fdda44234aa6f6ab0ead888df2b6a9a7268ab0e1e4336caf186635eb2af1.png" src="../../_images/d1a0fdda44234aa6f6ab0ead888df2b6a9a7268ab0e1e4336caf186635eb2af1.png" />
</div>
</div>
<p>To complete our diagnostics it remains</p>
<ol class="arabic simple">
<li><p>Compute the volatility of a Sharpe ratio</p></li>
<li><p>Compute the fraction of data points needed to halve the Sharpe ratio</p></li>
<li><p>Drawdowns and cumulative return plots</p></li>
</ol>
<p><strong>What is the volatility of the Sharpe Ratio?</strong></p>
<ul class="simple">
<li><p>SR is different because it is not an average, thus our standard way to compute standard errors don’t quite work out</p></li>
<li><p>We have two options:</p></li>
</ul>
<ol class="arabic">
<li><p>we can assume normal distribution to get</p>
<div class="math notranslate nohighlight">
\[\sigma(SR)=\sqrt{\frac{1}{T-1}(1+SR^2/2)}\]</div>
</li>
<li><p>We can bootstrap from the data with replacement to create alternative sample</p></li>
</ol>
<blockquote>
<div><h3 class="rubric" id="bootstraping">Bootstraping</h3>
<ul class="simple">
<li><p>Instead of assuming returns have a particular distribution we can sample from the realized distribution to obtain alternative realization of the world</p></li>
<li><p>Here how it works</p>
<ul>
<li><p>Draw from the data with replacement T times. This gives you a “new sample”.</p></li>
<li><p>Construct The sharpe ratio in this sample, save it</p></li>
<li><p>Do that M times and compute the standard deviation of the SR across samples</p></li>
<li><p>You can also directly look at the 5% worse realizations</p></li>
<li><p>This give you the different SR that can be produced by the same truth</p></li>
<li><p>Can ask questions like: how bad the SR is likely to be with only 1 year of data</p></li>
</ul>
</li>
</ul>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sharpe ratio standard error using the normal assumption</span>
<span class="k">def</span><span class="w"> </span><span class="nf">SR_vol</span><span class="p">(</span><span class="n">R</span><span class="p">):</span>
    <span class="n">SR</span><span class="o">=</span><span class="n">R</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">/</span><span class="n">R</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    <span class="n">T</span><span class="o">=</span><span class="n">R</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">T</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">SR</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span><span class="o">**</span><span class="mf">0.5</span>

<span class="n">SR_vol</span><span class="p">(</span><span class="n">df_est</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">])</span>


<span class="c1"># Sharpe ratio standard error using the bootstrap method</span>

<span class="k">def</span><span class="w"> </span><span class="nf">SR_vol_boot</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
    <span class="n">SR</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="n">T</span><span class="o">=</span><span class="n">R</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">Rs</span><span class="o">=</span><span class="n">R</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">SR</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SR</span><span class="p">,</span><span class="n">Rs</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">/</span><span class="n">Rs</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>

    <span class="k">return</span> <span class="n">Rs</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">SR</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">SR_vol</span><span class="p">(</span><span class="n">df_ff6</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]))</span>

<span class="n">SR_vol_boot</span><span class="p">(</span><span class="n">df_ff6</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">],</span><span class="mi">10000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.036991266164612846
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(0.04393346361568302, 0.06800667732507118)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># fraction to half. Code is incomplete. I need to remove the point that has the most impact on the Sharpe Ratio, not the first point. \</span>
<span class="c1"># which point should I remove?</span>
<span class="k">def</span><span class="w"> </span><span class="nf">fractiontohalf</span><span class="p">(</span><span class="n">R</span><span class="p">):</span>
    <span class="n">SR</span><span class="o">=</span><span class="n">R</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">/</span><span class="n">R</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    <span class="n">target_sharpe</span><span class="o">=</span><span class="n">SR</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">T</span><span class="o">=</span><span class="n">R</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">removed_points</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">SR</span> <span class="o">&gt;</span> <span class="n">target_sharpe</span><span class="p">:</span>
    <span class="c1"># this is simply the first point. What is the point that I should take out for maximum impact?</span>
    
        <span class="n">idx_to_remove</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span>  <span class="c1"># Find the index of the point with the maximum impact on the Sharpe Ratio</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx_to_remove</span><span class="p">])</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">idx_to_remove</span><span class="p">)</span>
        <span class="n">SR</span><span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">/</span> <span class="n">R</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
        <span class="n">removed_points</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">removed_points</span><span class="o">/</span><span class="n">T</span>

<span class="n">fractiontohalf</span><span class="p">(</span><span class="n">df_ff6</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.161
0.1366
0.1365
0.1247
0.1247
0.1216
0.11349999999999999
0.113
0.1114
0.1084
0.10279999999999999
0.1018
0.0959
0.09570000000000001
0.09539999999999998
0.09050000000000001
0.0895
0.0883
0.08710000000000001
0.0842
0.084
0.08220000000000001
0.0815
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.03116531165311653
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><p><strong>Drawdown plots</strong></p>
<p>-It is common to look at how long are the periods where you are losing money on a strategy</p>
<p>-This might inform you how sticky your clients need to be. For example might inform how long the lockup in your fund might need to be</p>
<p>-This is also relevant for Hedge funds where hedge fund managers are compensated only when they go above the high-water mark</p>
<p>-or much more basically how long are going to be the painful periods where you are losing money</p>
</div></blockquote>
<p>We simply subtract from the cumulative return of the strategy, it’s peak performance up to that point and divide by the peak. This tell you the cumulative return from the most recent peak at a given point.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">cumulative_performance</span><span class="o">=</span><span class="p">(</span><span class="n">df_ff6</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">df_ff6</span><span class="o">.</span><span class="n">RF</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span>
<span class="n">running_max</span> <span class="o">=</span><span class="n">cumulative_performance</span><span class="o">.</span><span class="n">cummax</span><span class="p">()</span>
<span class="n">drawdown</span> <span class="o">=</span> <span class="p">(</span><span class="n">cumulative_performance</span><span class="o">-</span> <span class="n">running_max</span><span class="p">)</span><span class="o">/</span><span class="n">running_max</span>

<span class="n">cumulative_performance</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">logy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">running_max</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">logy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">drawdown</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
  
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;Date&#39;&gt;
</pre></div>
</div>
<img alt="../../_images/0754b9a5728c1b7df5969a474602046ea15dbd9f8441f1b71e2f7d4c8f133357.png" src="../../_images/0754b9a5728c1b7df5969a474602046ea15dbd9f8441f1b71e2f7d4c8f133357.png" />
</div>
</div>
</section>
<section id="adjusting-for-discarded-signals">
<h3><span class="section-number">12.6.2. </span>Adjusting for Discarded Signals<a class="headerlink" href="#adjusting-for-discarded-signals" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Often we look at many signals to find the one</p></li>
<li><p>This makes conventional thresholds for t-tests too small</p></li>
<li><p>There are many different adjustments for this</p></li>
<li><p>Bonferroni T-stats is frequently used but it is quite conservative (rejects too frequently)</p></li>
</ul>
<p><img alt="Bonferroni Correction" src="../../_images/bonferroni.jpg" /></p>
<ul class="simple">
<li><p>You go form 1.96 to 3 as you look at 20 signals instead of 1</p></li>
<li><p>Correction changes the most as you go from 1 to 5 signals</p></li>
</ul>
<p>How to use this?</p>
<ul class="simple">
<li><p>If you know that you are trying many things you have to adjust your hurdle</p></li>
</ul>
<p>Example:</p>
<ul class="simple">
<li><p>Say you tried 100 different ideas in a 24 month period</p></li>
<li><p>What fraction will look good from perspective of an alpha test that selects strategies with t-test&gt;1.64 even if they are actually all bad</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">R</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">norm</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="mf">0.16</span><span class="o">/</span><span class="mi">12</span><span class="o">**</span><span class="mf">0.5</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span><span class="mi">100</span><span class="p">)))</span>

<span class="n">t</span><span class="o">=</span><span class="n">R</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">/</span><span class="mi">24</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span>

<span class="p">(</span><span class="n">t</span><span class="o">&gt;</span><span class="mf">1.64</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4
</pre></div>
</div>
</div>
</div>
<p>Suppose there is one good one.</p>
<ul class="simple">
<li><p>What is your hit rate?</p></li>
<li><p>How often you will find the correct idea?</p></li>
</ul>
<p>Things to do: Change cutoff,  change Sharpe ratio,change sample size</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SR</span><span class="o">=</span><span class="mi">1</span>
<span class="n">t_cutoff</span><span class="o">=</span><span class="mi">2</span>
<span class="n">Nmonths</span><span class="o">=</span><span class="mi">48</span>
<span class="n">number_of_correct</span><span class="o">=</span><span class="mi">0</span>
<span class="n">number_of_wrong</span><span class="o">=</span><span class="mi">0</span>
<span class="n">Ideas</span><span class="o">=</span><span class="mi">100</span>
<span class="n">simulations</span><span class="o">=</span><span class="mi">1000</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">simulations</span><span class="p">):</span>

    <span class="n">R</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">norm</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">Nmonths</span><span class="p">,</span><span class="n">Ideas</span><span class="p">)))</span>
    <span class="c1"># first strategy is the good one</span>
    <span class="n">R</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">R</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">SR</span><span class="o">/</span><span class="mi">12</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="n">t</span><span class="o">=</span><span class="n">R</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">/</span><span class="n">Nmonths</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="n">number_of_correct</span><span class="o">+=</span> <span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="n">t_cutoff</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">number_of_wrong</span><span class="o">+=</span> <span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">&gt;</span><span class="n">t_cutoff</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">hit_rate</span><span class="o">=</span><span class="n">number_of_correct</span><span class="o">/</span><span class="p">(</span><span class="n">number_of_correct</span><span class="o">+</span><span class="n">number_of_wrong</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">hit_rate</span><span class="p">,</span><span class="n">number_of_correct</span><span class="o">/</span><span class="n">simulations</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.17073976221928666 0.517
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="how-to-split-you-sample">
<h2><span class="section-number">12.7. </span>How to split you sample?<a class="headerlink" href="#how-to-split-you-sample" title="Link to this heading">#</a></h2>
<p>A few popular approaches are</p>
<ol class="arabic simple">
<li><p>Rolling window estimation</p></li>
<li><p>Use odd months to estimate signals and even months to compute returns and test signals.  Repeat by switching odd and even months.</p></li>
<li><p>Split sample in half, estimation and test sample</p></li>
<li><p>Split in three: estimation, test for model selection, hold-out sample</p></li>
</ol>
<p><strong>Aplication 1: optimal combitation of Momentum and value strategies</strong></p>
<p>We will split our sample into two halves:</p>
<ol class="arabic simple">
<li><p>take all observations from odd months in even years and even months in odd years (i.e., if starting in 1980, this would look like:  01/1980, 03/1980, … , 11/1980, 02/1981, 04/1981, … 12/1981, 01/1982, 03/1982, …); and</p></li>
<li><p>the opposite (take all observations from even months in even years and odd months in odd years).</p></li>
</ol>
<p>A nice thing to do in halves is that we can cross-validated  use first sample 1 as estimation sample and sample2 as test sample, and then invert.</p>
<p>If you have lot of data one might split the data in 5 folds and do the estimation in one and test on the rest.</p>
<p>You are not testing particular weights but an approach to portfolio construction, i.e., a trading rule</p>
<p>Here we will test the MVE approach of doing things. You can test all sort of different approaches</p>
<p>Lets construct both samples by using a function that returns <code class="docutils literal notranslate"><span class="pre">True</span></code> if the number is odd and then apply this function to the months and years of our dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># construct function that identifies if a number is odd</span>
<span class="k">def</span><span class="w"> </span><span class="nf">sample</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_odd</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">num</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span>

    <span class="c1"># create a sample that selects the even years and odd months</span>
    <span class="n">evenyear_oddmonth</span><span class="o">=</span><span class="p">(</span><span class="n">is_odd</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">==</span><span class="kc">False</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">is_odd</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">==</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># create a sample that selects the odd years and even months</span>
    <span class="n">oddyear_evenmonth</span><span class="o">=</span><span class="p">(</span><span class="n">is_odd</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">==</span><span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">is_odd</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">==</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># join the two samples</span>
    <span class="n">sample1</span><span class="o">=</span><span class="n">evenyear_oddmonth</span> <span class="o">|</span> <span class="n">oddyear_evenmonth</span>
    <span class="c1"># creates the mirror sample</span>
    <span class="n">sample2</span><span class="o">=~</span><span class="n">sample1</span>
    <span class="k">return</span> <span class="n">sample1</span><span class="p">,</span><span class="n">sample2</span>

<span class="n">df_ff6</span><span class="o">=</span><span class="n">get_factors</span><span class="p">(</span><span class="s1">&#39;ff6&#39;</span><span class="p">,</span><span class="n">freq</span><span class="o">=</span><span class="s1">&#39;monthly&#39;</span><span class="p">)</span>

<span class="n">sample1</span><span class="p">,</span><span class="n">sample2</span><span class="o">=</span><span class="n">sample</span><span class="p">(</span><span class="n">df_ff6</span><span class="p">)</span>
<span class="n">sample1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>c:\Users\alan.moreira\Anaconda3\lib\site-packages\pandas_datareader\famafrench.py:114: FutureWarning: The argument &#39;date_parser&#39; is deprecated and will be removed in a future version. Please use &#39;date_format&#39; instead, or read your data in as &#39;object&#39; dtype and then call &#39;to_datetime&#39;.
  df = read_csv(StringIO(&quot;Date&quot; + src[start:]), **params)
c:\Users\alan.moreira\Anaconda3\lib\site-packages\pandas_datareader\famafrench.py:114: FutureWarning: The argument &#39;date_parser&#39; is deprecated and will be removed in a future version. Please use &#39;date_format&#39; instead, or read your data in as &#39;object&#39; dtype and then call &#39;to_datetime&#39;.
  df = read_csv(StringIO(&quot;Date&quot; + src[start:]), **params)
c:\Users\alan.moreira\Anaconda3\lib\site-packages\pandas_datareader\famafrench.py:114: FutureWarning: The argument &#39;date_parser&#39; is deprecated and will be removed in a future version. Please use &#39;date_format&#39; instead, or read your data in as &#39;object&#39; dtype and then call &#39;to_datetime&#39;.
  df = read_csv(StringIO(&quot;Date&quot; + src[start:]), **params)
c:\Users\alan.moreira\Anaconda3\lib\site-packages\pandas_datareader\famafrench.py:114: FutureWarning: The argument &#39;date_parser&#39; is deprecated and will be removed in a future version. Please use &#39;date_format&#39; instead, or read your data in as &#39;object&#39; dtype and then call &#39;to_datetime&#39;.
  df = read_csv(StringIO(&quot;Date&quot; + src[start:]), **params)
c:\Users\alan.moreira\Anaconda3\lib\site-packages\pandas_datareader\famafrench.py:114: FutureWarning: The argument &#39;date_parser&#39; is deprecated and will be removed in a future version. Please use &#39;date_format&#39; instead, or read your data in as &#39;object&#39; dtype and then call &#39;to_datetime&#39;.
  df = read_csv(StringIO(&quot;Date&quot; + src[start:]), **params)
c:\Users\alan.moreira\Anaconda3\lib\site-packages\pandas_datareader\famafrench.py:114: FutureWarning: The argument &#39;date_parser&#39; is deprecated and will be removed in a future version. Please use &#39;date_format&#39; instead, or read your data in as &#39;object&#39; dtype and then call &#39;to_datetime&#39;.
  df = read_csv(StringIO(&quot;Date&quot; + src[start:]), **params)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([False,  True, False, ..., False,  True, False])
</pre></div>
</div>
</div>
</div>
<p>We can now use our diagnostic functions</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_est</span><span class="o">=</span><span class="n">df_ff6</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sample1</span><span class="p">,[</span><span class="s1">&#39;HML&#39;</span><span class="p">,</span><span class="s1">&#39;MOM&#39;</span><span class="p">,</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">,</span><span class="s1">&#39;RF&#39;</span><span class="p">]]</span>
<span class="n">df_test</span><span class="o">=</span><span class="n">df_ff6</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sample2</span><span class="p">,[</span><span class="s1">&#39;HML&#39;</span><span class="p">,</span><span class="s1">&#39;MOM&#39;</span><span class="p">,</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">,</span><span class="s1">&#39;RF&#39;</span><span class="p">]]</span>
<span class="n">Ww</span><span class="o">=</span><span class="n">MVE</span><span class="p">(</span><span class="n">df_est</span><span class="p">[[</span><span class="s1">&#39;HML&#39;</span><span class="p">,</span><span class="s1">&#39;MOM&#39;</span><span class="p">]],</span><span class="n">VolTarget</span><span class="o">=</span><span class="n">df_est</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
<span class="n">Ww</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Ww</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># I am setting the weight of the market to zero. Function that we created expects the same number of risky asset passed</span>
<span class="n">Results</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">Results</span><span class="p">[</span><span class="s1">&#39;Test_s2_est1&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">Diagnostics</span><span class="p">(</span><span class="n">Ww</span><span class="p">,</span><span class="n">df_test</span><span class="p">)</span>



<span class="n">df_est</span><span class="o">=</span><span class="n">df_ff6</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sample2</span><span class="p">,[</span><span class="s1">&#39;HML&#39;</span><span class="p">,</span><span class="s1">&#39;MOM&#39;</span><span class="p">,</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">,</span><span class="s1">&#39;RF&#39;</span><span class="p">]]</span>
<span class="n">df_test</span><span class="o">=</span><span class="n">df_ff6</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sample1</span><span class="p">,[</span><span class="s1">&#39;HML&#39;</span><span class="p">,</span><span class="s1">&#39;MOM&#39;</span><span class="p">,</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">,</span><span class="s1">&#39;RF&#39;</span><span class="p">]]</span>
<span class="n">Ww</span><span class="o">=</span><span class="n">MVE</span><span class="p">(</span><span class="n">df_est</span><span class="p">[[</span><span class="s1">&#39;HML&#39;</span><span class="p">,</span><span class="s1">&#39;MOM&#39;</span><span class="p">]],</span><span class="n">VolTarget</span><span class="o">=</span><span class="n">df_est</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
<span class="n">Ww</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Ww</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

<span class="n">Results</span><span class="p">[</span><span class="s1">&#39;Test_s1_est2&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">Diagnostics</span><span class="p">(</span><span class="n">Ww</span><span class="p">,</span><span class="n">df_test</span><span class="p">)</span>

<span class="n">Results</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\alan.moreira\AppData\Local\Temp\ipykernel_7236\1740476391.py:24: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  results[&#39;alpha&#39;] = regresult.params[0]*12
C:\Users\alan.moreira\AppData\Local\Temp\ipykernel_7236\1740476391.py:25: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  results[&#39;t_alpha&#39;]= regresult.tvalues[0]
C:\Users\alan.moreira\AppData\Local\Temp\ipykernel_7236\1740476391.py:24: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  results[&#39;alpha&#39;] = regresult.params[0]*12
C:\Users\alan.moreira\AppData\Local\Temp\ipykernel_7236\1740476391.py:25: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  results[&#39;t_alpha&#39;]= regresult.tvalues[0]
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Test_s2_est1</th>
      <th>Test_s1_est2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>SR</th>
      <td>0.643446</td>
      <td>0.821442</td>
    </tr>
    <tr>
      <th>SR_factor</th>
      <td>0.472651</td>
      <td>0.415249</td>
    </tr>
    <tr>
      <th>Vol</th>
      <td>0.202262</td>
      <td>0.170955</td>
    </tr>
    <tr>
      <th>Vol_factor</th>
      <td>0.180817</td>
      <td>0.189092</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>0.130145</td>
      <td>0.140430</td>
    </tr>
    <tr>
      <th>t_mean</th>
      <td>4.504124</td>
      <td>5.750093</td>
    </tr>
    <tr>
      <th>mean_factor</th>
      <td>0.085463</td>
      <td>0.078520</td>
    </tr>
    <tr>
      <th>t_mean_factor</th>
      <td>2.957760</td>
      <td>3.215126</td>
    </tr>
    <tr>
      <th>alpha</th>
      <td>0.149375</td>
      <td>0.146594</td>
    </tr>
    <tr>
      <th>t_alpha</th>
      <td>5.224558</td>
      <td>5.977245</td>
    </tr>
    <tr>
      <th>AR</th>
      <td>0.753935</td>
      <td>0.860749</td>
    </tr>
    <tr>
      <th>tails</th>
      <td>0.013605</td>
      <td>0.017007</td>
    </tr>
    <tr>
      <th>tails_factor</th>
      <td>0.017007</td>
      <td>0.011905</td>
    </tr>
    <tr>
      <th>min_ret</th>
      <td>-0.370722</td>
      <td>-0.284959</td>
    </tr>
    <tr>
      <th>min_factor</th>
      <td>-0.291300</td>
      <td>-0.238200</td>
    </tr>
    <tr>
      <th>t_SR</th>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>t_SR_factor</th>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>fraction_tohalf</th>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>fraction_tohalf_factor</th>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
</div></div><img alt="../../_images/444b0a8284b52146c96543719e433a3ae3e659d6931d167c570679fab68a04fc.png" src="../../_images/444b0a8284b52146c96543719e433a3ae3e659d6931d167c570679fab68a04fc.png" />
<img alt="../../_images/259116ab5fbf2a0d4e82cadb4eba8104b77c9c918515c44eb2272bce0e28ca6d.png" src="../../_images/259116ab5fbf2a0d4e82cadb4eba8104b77c9c918515c44eb2272bce0e28ca6d.png" />
</div>
</div>
<ul class="simple">
<li><p>What do we learn?</p></li>
<li><p>What looks suspicious?</p></li>
<li><p>We are combining two factors that had very famous professors publishing them around 1990.</p></li>
<li><p>Does that matter?</p></li>
<li><p>Does that change the interpretation of the results?</p></li>
</ul>
<section id="robustifying-your-backtests">
<h3><span class="section-number">12.7.1. </span>Robustifying your Backtests<a class="headerlink" href="#robustifying-your-backtests" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>Calculate TRUE out of sample Sharpe ratios: Have a hold-out sample not used in backtest to test out of sample performance.</p></li>
<li><p>Be careful to not use out of sample results for tunning and model choice</p></li>
<li><p>If you use result of the test sample to choose a model parameter or pick a strategy–evaluate in a third holdout sample</p></li>
<li><p>Be very careful for information of the test sample to not leak into the estimation.</p>
<ul>
<li><p>For example, your idea might be motivated by a few months where you know these firms did well.</p></li>
<li><p>Be sure to check the results are not driving by this</p></li>
</ul>
</li>
<li><p>When tuning/model choice is needed you must have</p>
<ul>
<li><p>Estimation</p></li>
<li><p>Test sample</p></li>
<li><p>Hold out sample</p></li>
</ul>
</li>
<li><p>Keep track of your discarded ideas going forward</p></li>
</ul>
</div></blockquote>
<p><strong>Application 2: fine-tuning the look-back window</strong></p>
<p>Now we will compare a variety of models to see which one works best outside of the test sample</p>
<p>So we will have the estimation sample where we will estimate the different models– which in this case will be strategies with different look-back windows</p>
<p>What is a look-back window?</p>
<ul class="simple">
<li><p>It is the window the we use to estimate our moments</p></li>
</ul>
<p>The trade-off here is:</p>
<ul class="simple">
<li><p>If you make too short you just pick up noise</p></li>
<li><p>If you make too long the moments might not be that informative about future data</p></li>
<li><p>Particularly true in he case of volatility, but also true for correlations and expected returns</p></li>
<li><p>Particularly severe when dealing with individual assets and not characteristic-based strategies</p></li>
<li><p>You also want to have enough left to do actual evaluation of your strategies ( see the discussion before)</p></li>
</ul>
<p>We will split the sample in two.</p>
<ul class="simple">
<li><p>Last 20 years will be the hold out sample</p></li>
<li><p>The remaining of the sample  estimation+test,</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">holdout_sample</span><span class="o">=</span><span class="n">df_ff6</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span><span class="o">&gt;</span><span class="mi">2023</span><span class="o">-</span><span class="mi">21</span>
<span class="n">df_hold</span><span class="o">=</span><span class="n">df_ff6</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">holdout_sample</span><span class="p">,[</span><span class="s1">&#39;HML&#39;</span><span class="p">,</span><span class="s1">&#39;MOM&#39;</span><span class="p">,</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">,</span><span class="s1">&#39;RF&#39;</span><span class="p">]]</span>
<span class="n">df_EstTest</span><span class="o">=</span><span class="n">df_ff6</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">holdout_sample</span><span class="p">,[</span><span class="s1">&#39;HML&#39;</span><span class="p">,</span><span class="s1">&#39;MOM&#39;</span><span class="p">,</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">,</span><span class="s1">&#39;RF&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>We will now do the estimation fine-tuning.</p></li>
</ul>
<ul class="simple">
<li><p>Lets start by building a code that gets our desired window, do the estimation and construct the return series on the test sample</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">window</span><span class="o">=</span><span class="mi">60</span>
<span class="n">df</span><span class="o">=</span><span class="n">df_EstTest</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="c1"># Use data that is not in the holdout sample to estimate the strategy</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Strategy&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="c1"># loop over the test sample</span>
<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">window</span><span class="p">:]:</span>
    <span class="c1"># select the first 36 months of the sample ( and then add one more month at the tail and drop the last month on the head each time we loop over the sample)</span>
    <span class="n">df_temp</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">d</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="n">window</span><span class="p">):</span><span class="n">d</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="c1"># construct optimal portfolio given these 36 months</span>
    <span class="n">X</span><span class="o">=</span><span class="n">MVE</span><span class="p">(</span><span class="n">df_temp</span><span class="p">[[</span><span class="s1">&#39;HML&#39;</span><span class="p">,</span><span class="s1">&#39;MOM&#39;</span><span class="p">]],</span><span class="n">VolTarget</span><span class="o">=</span><span class="n">df_temp</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
    <span class="c1"># save the returns of the strategy and the market on the FOLLOWING month</span>
    <span class="c1"># this month does NOT enter the estimation of the strategy</span>
    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">d</span><span class="p">,</span><span class="s1">&#39;Strategy&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">d</span><span class="p">,[</span><span class="s1">&#39;HML&#39;</span><span class="p">,</span><span class="s1">&#39;MOM&#39;</span><span class="p">]]</span> <span class="o">@</span> <span class="n">X</span>


<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>HML</th>
      <th>MOM</th>
      <th>Mkt-RF</th>
      <th>RF</th>
      <th>Strategy</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1927-01-01</th>
      <td>0.0454</td>
      <td>0.0036</td>
      <td>-0.0006</td>
      <td>0.0025</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1927-02-01</th>
      <td>0.0294</td>
      <td>-0.0214</td>
      <td>0.0418</td>
      <td>0.0026</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1927-03-01</th>
      <td>-0.0261</td>
      <td>0.0361</td>
      <td>0.0013</td>
      <td>0.0030</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1927-04-01</th>
      <td>0.0081</td>
      <td>0.0430</td>
      <td>0.0046</td>
      <td>0.0025</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1927-05-01</th>
      <td>0.0473</td>
      <td>0.0300</td>
      <td>0.0544</td>
      <td>0.0030</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2002-08-01</th>
      <td>0.0328</td>
      <td>0.0190</td>
      <td>0.0050</td>
      <td>0.0014</td>
      <td>0.034597</td>
    </tr>
    <tr>
      <th>2002-09-01</th>
      <td>0.0145</td>
      <td>0.0913</td>
      <td>-0.1035</td>
      <td>0.0014</td>
      <td>0.073791</td>
    </tr>
    <tr>
      <th>2002-10-01</th>
      <td>-0.0394</td>
      <td>-0.0558</td>
      <td>0.0784</td>
      <td>0.0014</td>
      <td>-0.065174</td>
    </tr>
    <tr>
      <th>2002-11-01</th>
      <td>-0.0126</td>
      <td>-0.1633</td>
      <td>0.0596</td>
      <td>0.0012</td>
      <td>-0.127139</td>
    </tr>
    <tr>
      <th>2002-12-01</th>
      <td>0.0214</td>
      <td>0.0964</td>
      <td>-0.0576</td>
      <td>0.0011</td>
      <td>0.079017</td>
    </tr>
  </tbody>
</table>
<p>912 rows × 5 columns</p>
</div></div></div>
</div>
<ul class="simple">
<li><p>Note that we have no observations early on as we need at the 36 months to estimate and none after 2002, that is the sample that we will hold out</p></li>
<li><p>Now lets call out Diagnostics</p></li>
</ul>
<p>Only detail is that we have to pass the strategy return and not the weights since those are not fixed</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># I am passing the returns of the strategy as the returns of the portfolio</span>
<span class="c1"># I cannot pass the weight becasue the weight is not constant over time</span>
<span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">Diagnostics</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">df</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Strategy&#39;</span><span class="p">])</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\alan.moreira\AppData\Local\Temp\ipykernel_7236\2254644634.py:25: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  results[&#39;alpha&#39;] = regresult.params[0]*12
C:\Users\alan.moreira\AppData\Local\Temp\ipykernel_7236\2254644634.py:26: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  results[&#39;t_alpha&#39;]= regresult.tvalues[0]
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>SR</th>
      <td>0.630255</td>
    </tr>
    <tr>
      <th>SR_factor</th>
      <td>0.465408</td>
    </tr>
    <tr>
      <th>Vol</th>
      <td>0.235094</td>
    </tr>
    <tr>
      <th>Vol_factor</th>
      <td>0.185698</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>0.148169</td>
    </tr>
    <tr>
      <th>t_mean</th>
      <td>5.310620</td>
    </tr>
    <tr>
      <th>mean_factor</th>
      <td>0.086425</td>
    </tr>
    <tr>
      <th>t_mean_factor</th>
      <td>3.097629</td>
    </tr>
    <tr>
      <th>alpha</th>
      <td>0.153550</td>
    </tr>
    <tr>
      <th>t_alpha</th>
      <td>5.457830</td>
    </tr>
    <tr>
      <th>AR</th>
      <td>0.653936</td>
    </tr>
    <tr>
      <th>tails</th>
      <td>0.018779</td>
    </tr>
    <tr>
      <th>tails_factor</th>
      <td>0.014085</td>
    </tr>
    <tr>
      <th>min_ret</th>
      <td>-0.470448</td>
    </tr>
    <tr>
      <th>min_factor</th>
      <td>-0.238200</td>
    </tr>
    <tr>
      <th>t_SR</th>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>t_SR_factor</th>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>fraction_tohalf</th>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>fraction_tohalf_factor</th>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
</div></div><img alt="../../_images/08b8680af0ddc7daac35411ad0dc137dd1024ebd12baea63dbd6188e5acddaa6.png" src="../../_images/08b8680af0ddc7daac35411ad0dc137dd1024ebd12baea63dbd6188e5acddaa6.png" />
</div>
</div>
<ul class="simple">
<li><p>So far, is this a true out of sample test?</p></li>
<li><p>Now that we have this code we can put in a function so we can evaluate for different lookbacks</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">RollingEval</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">window</span><span class="p">):</span>

    <span class="c1"># Use data that is not in the holdout sample to estimate the strategy</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Strategy&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="c1"># loop over the test sample</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">window</span><span class="p">:]:</span>
        <span class="c1"># select the first 36 months of the sample ( and then add one more month at the tail and drop the last month on the head each time we loop over the sample)</span>
        <span class="n">df_temp</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">d</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="n">window</span><span class="p">):</span><span class="n">d</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1"># construct optimal portfolio given these 36 months</span>
        <span class="n">X</span><span class="o">=</span><span class="n">MVE</span><span class="p">(</span><span class="n">df_temp</span><span class="p">[[</span><span class="s1">&#39;HML&#39;</span><span class="p">,</span><span class="s1">&#39;MOM&#39;</span><span class="p">]],</span><span class="n">VolTarget</span><span class="o">=</span><span class="n">df_temp</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
        <span class="c1"># save the returns of the strategy and the market on the FOLLOWING month</span>
        <span class="c1"># this month does NOT enter the estimation of the strategy</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">d</span><span class="p">,</span><span class="s1">&#39;Strategy&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">d</span><span class="p">,[</span><span class="s1">&#39;HML&#39;</span><span class="p">,</span><span class="s1">&#39;MOM&#39;</span><span class="p">]]</span> <span class="o">@</span> <span class="n">X</span>
    <span class="k">return</span> <span class="n">df</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Returns</span><span class="o">=</span><span class="n">RollingEval</span><span class="p">(</span><span class="n">df_EstTest</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>        
<span class="n">Returns</span><span class="o">=</span><span class="n">Returns</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">Diagnostics</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Returns</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">Returns</span><span class="p">[</span><span class="s1">&#39;Strategy&#39;</span><span class="p">])</span> 
<span class="n">Returns</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\alan.moreira\AppData\Local\Temp\ipykernel_7236\2254644634.py:25: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  results[&#39;alpha&#39;] = regresult.params[0]*12
C:\Users\alan.moreira\AppData\Local\Temp\ipykernel_7236\2254644634.py:26: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  results[&#39;t_alpha&#39;]= regresult.tvalues[0]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;Date&#39;&gt;
</pre></div>
</div>
<img alt="../../_images/f07a741d4c77654cc949aa839887ad65171e89d95e17f5669253b8948a4baaa5.png" src="../../_images/f07a741d4c77654cc949aa839887ad65171e89d95e17f5669253b8948a4baaa5.png" />
<img alt="../../_images/ed34aee83209201ec453b8a4cdbf65279c76883902570651a641484b341e4065.png" src="../../_images/ed34aee83209201ec453b8a4cdbf65279c76883902570651a641484b341e4065.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">windows</span><span class="o">=</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">36</span><span class="p">,</span><span class="mi">48</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">72</span><span class="p">,</span><span class="mi">120</span><span class="p">]</span> 
<span class="n">Results</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([],</span><span class="n">index</span><span class="o">=</span><span class="n">Results</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="n">windows</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">windows</span><span class="p">:</span>
    <span class="n">Returns</span><span class="o">=</span><span class="n">RollingEval</span><span class="p">(</span><span class="n">df_EstTest</span><span class="p">,</span><span class="n">w</span><span class="p">)</span>        
    <span class="n">Returns</span><span class="o">=</span><span class="n">Returns</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">Results</span><span class="p">[</span><span class="n">w</span><span class="p">]</span><span class="o">=</span><span class="n">Diagnostics</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Returns</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">Returns</span><span class="p">[</span><span class="s1">&#39;Strategy&#39;</span><span class="p">])</span>  
    
<span class="n">Results</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\alan.moreira\AppData\Local\Temp\ipykernel_7236\2254644634.py:25: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  results[&#39;alpha&#39;] = regresult.params[0]*12
C:\Users\alan.moreira\AppData\Local\Temp\ipykernel_7236\2254644634.py:26: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  results[&#39;t_alpha&#39;]= regresult.tvalues[0]
C:\Users\alan.moreira\AppData\Local\Temp\ipykernel_7236\2254644634.py:25: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  results[&#39;alpha&#39;] = regresult.params[0]*12
C:\Users\alan.moreira\AppData\Local\Temp\ipykernel_7236\2254644634.py:26: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  results[&#39;t_alpha&#39;]= regresult.tvalues[0]
C:\Users\alan.moreira\AppData\Local\Temp\ipykernel_7236\2254644634.py:25: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  results[&#39;alpha&#39;] = regresult.params[0]*12
C:\Users\alan.moreira\AppData\Local\Temp\ipykernel_7236\2254644634.py:26: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  results[&#39;t_alpha&#39;]= regresult.tvalues[0]
C:\Users\alan.moreira\AppData\Local\Temp\ipykernel_7236\2254644634.py:25: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  results[&#39;alpha&#39;] = regresult.params[0]*12
C:\Users\alan.moreira\AppData\Local\Temp\ipykernel_7236\2254644634.py:26: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  results[&#39;t_alpha&#39;]= regresult.tvalues[0]
C:\Users\alan.moreira\AppData\Local\Temp\ipykernel_7236\2254644634.py:25: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  results[&#39;alpha&#39;] = regresult.params[0]*12
C:\Users\alan.moreira\AppData\Local\Temp\ipykernel_7236\2254644634.py:26: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  results[&#39;t_alpha&#39;]= regresult.tvalues[0]
C:\Users\alan.moreira\AppData\Local\Temp\ipykernel_7236\2254644634.py:25: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  results[&#39;alpha&#39;] = regresult.params[0]*12
C:\Users\alan.moreira\AppData\Local\Temp\ipykernel_7236\2254644634.py:26: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  results[&#39;t_alpha&#39;]= regresult.tvalues[0]
C:\Users\alan.moreira\AppData\Local\Temp\ipykernel_7236\2254644634.py:25: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  results[&#39;alpha&#39;] = regresult.params[0]*12
C:\Users\alan.moreira\AppData\Local\Temp\ipykernel_7236\2254644634.py:26: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  results[&#39;t_alpha&#39;]= regresult.tvalues[0]
C:\Users\alan.moreira\AppData\Local\Temp\ipykernel_7236\2254644634.py:25: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  results[&#39;alpha&#39;] = regresult.params[0]*12
C:\Users\alan.moreira\AppData\Local\Temp\ipykernel_7236\2254644634.py:26: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  results[&#39;t_alpha&#39;]= regresult.tvalues[0]
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>6</th>
      <th>12</th>
      <th>24</th>
      <th>36</th>
      <th>48</th>
      <th>60</th>
      <th>72</th>
      <th>120</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>SR</th>
      <td>0.249437</td>
      <td>0.556364</td>
      <td>0.503349</td>
      <td>0.613069</td>
      <td>0.611484</td>
      <td>0.630255</td>
      <td>0.823954</td>
      <td>0.900404</td>
    </tr>
    <tr>
      <th>SR_factor</th>
      <td>0.385763</td>
      <td>0.375313</td>
      <td>0.358242</td>
      <td>0.377903</td>
      <td>0.409500</td>
      <td>0.465408</td>
      <td>0.502565</td>
      <td>0.448958</td>
    </tr>
    <tr>
      <th>Vol</th>
      <td>0.604420</td>
      <td>0.272795</td>
      <td>0.266212</td>
      <td>0.243699</td>
      <td>0.237008</td>
      <td>0.235094</td>
      <td>0.212832</td>
      <td>0.188124</td>
    </tr>
    <tr>
      <th>Vol_factor</th>
      <td>0.194159</td>
      <td>0.194376</td>
      <td>0.194693</td>
      <td>0.192961</td>
      <td>0.191656</td>
      <td>0.185698</td>
      <td>0.172489</td>
      <td>0.160638</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>0.150765</td>
      <td>0.151773</td>
      <td>0.133997</td>
      <td>0.149404</td>
      <td>0.144927</td>
      <td>0.148169</td>
      <td>0.175364</td>
      <td>0.169387</td>
    </tr>
    <tr>
      <th>t_mean</th>
      <td>2.167380</td>
      <td>4.818255</td>
      <td>4.329969</td>
      <td>5.238064</td>
      <td>5.188617</td>
      <td>5.310620</td>
      <td>6.893696</td>
      <td>7.314919</td>
    </tr>
    <tr>
      <th>mean_factor</th>
      <td>0.074899</td>
      <td>0.072952</td>
      <td>0.069747</td>
      <td>0.072921</td>
      <td>0.078483</td>
      <td>0.086425</td>
      <td>0.086687</td>
      <td>0.072120</td>
    </tr>
    <tr>
      <th>t_mean_factor</th>
      <td>1.076744</td>
      <td>2.315961</td>
      <td>2.253803</td>
      <td>2.556569</td>
      <td>2.809837</td>
      <td>3.097629</td>
      <td>3.407746</td>
      <td>3.114459</td>
    </tr>
    <tr>
      <th>alpha</th>
      <td>0.180957</td>
      <td>0.165089</td>
      <td>0.138750</td>
      <td>0.151628</td>
      <td>0.147182</td>
      <td>0.153550</td>
      <td>0.171887</td>
      <td>0.179607</td>
    </tr>
    <tr>
      <th>t_alpha</th>
      <td>2.605933</td>
      <td>5.252170</td>
      <td>4.462758</td>
      <td>5.283166</td>
      <td>5.231259</td>
      <td>5.457830</td>
      <td>6.686502</td>
      <td>7.743873</td>
    </tr>
    <tr>
      <th>AR</th>
      <td>0.301932</td>
      <td>0.610361</td>
      <td>0.521849</td>
      <td>0.622376</td>
      <td>0.621167</td>
      <td>0.653936</td>
      <td>0.808048</td>
      <td>0.961795</td>
    </tr>
    <tr>
      <th>tails</th>
      <td>0.006623</td>
      <td>0.018889</td>
      <td>0.019144</td>
      <td>0.019406</td>
      <td>0.019676</td>
      <td>0.018779</td>
      <td>0.015476</td>
      <td>0.013889</td>
    </tr>
    <tr>
      <th>tails_factor</th>
      <td>0.014349</td>
      <td>0.014444</td>
      <td>0.014640</td>
      <td>0.013699</td>
      <td>0.013889</td>
      <td>0.014085</td>
      <td>0.011905</td>
      <td>0.010101</td>
    </tr>
    <tr>
      <th>min_ret</th>
      <td>-3.805899</td>
      <td>-0.633400</td>
      <td>-0.634620</td>
      <td>-0.502321</td>
      <td>-0.475441</td>
      <td>-0.470448</td>
      <td>-0.458410</td>
      <td>-0.400294</td>
    </tr>
    <tr>
      <th>min_factor</th>
      <td>-0.291300</td>
      <td>-0.291300</td>
      <td>-0.291300</td>
      <td>-0.291300</td>
      <td>-0.291300</td>
      <td>-0.238200</td>
      <td>-0.238200</td>
      <td>-0.238200</td>
    </tr>
    <tr>
      <th>t_SR</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>t_SR_factor</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>fraction_tohalf</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>fraction_tohalf_factor</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
</div></div><img alt="../../_images/ba0ffe2546804265a124f4b08b5db62e7923229dde628fb64bc5616f17003bb5.png" src="../../_images/ba0ffe2546804265a124f4b08b5db62e7923229dde628fb64bc5616f17003bb5.png" />
<img alt="../../_images/f07a741d4c77654cc949aa839887ad65171e89d95e17f5669253b8948a4baaa5.png" src="../../_images/f07a741d4c77654cc949aa839887ad65171e89d95e17f5669253b8948a4baaa5.png" />
<img alt="../../_images/a264595507824a4c781a44b784c02ab3940a9a5540ec204d059bb3237b8121e1.png" src="../../_images/a264595507824a4c781a44b784c02ab3940a9a5540ec204d059bb3237b8121e1.png" />
<img alt="../../_images/f270f7a3bcddedada26dafd314ff1435b8425fb92d7237c6534b96d49a7885f5.png" src="../../_images/f270f7a3bcddedada26dafd314ff1435b8425fb92d7237c6534b96d49a7885f5.png" />
<img alt="../../_images/4a3e865be16f9a0d9fff22b2134958e9026a274bc477f1c0a1dd47fda8da6ecd.png" src="../../_images/4a3e865be16f9a0d9fff22b2134958e9026a274bc477f1c0a1dd47fda8da6ecd.png" />
<img alt="../../_images/08b8680af0ddc7daac35411ad0dc137dd1024ebd12baea63dbd6188e5acddaa6.png" src="../../_images/08b8680af0ddc7daac35411ad0dc137dd1024ebd12baea63dbd6188e5acddaa6.png" />
<img alt="../../_images/0d93ee08fb49d1309b6efc29cf5b94439263bd8559545a25baa7f512de4841b1.png" src="../../_images/0d93ee08fb49d1309b6efc29cf5b94439263bd8559545a25baa7f512de4841b1.png" />
<img alt="../../_images/76ddb80b43d945f9ff6539fd8d1633fdc48e603a762e980a3be47506affa9610.png" src="../../_images/76ddb80b43d945f9ff6539fd8d1633fdc48e603a762e980a3be47506affa9610.png" />
</div>
</div>
<ul class="simple">
<li><p>What else would you want to look at before peeking at the hold out sample?</p></li>
<li><p>Recall that once you look, you have to stop!</p></li>
<li><p>Is this pattern consistent with a better more reliable estimate of Expected returns? And Volatilities? And correlations?</p></li>
<li><p>How to figure out where the results are coming from?</p></li>
</ul>
<p>Are you ready to look at the hold out sample?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Window</span><span class="o">=</span><span class="mi">0</span>
<span class="c1"># Returns=RollingEval(df_hold,window)        </span>
<span class="c1"># # Returns=Returns.dropna()</span>
<span class="c1"># # Diagnostics(0,Returns,R=Returns[&#39;Strategy&#39;]) </span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>So what do you conclude?</p></li>
</ul>
</section>
</section>
<section id="publication-bias-or-famous-bias-or-incubation-bias">
<h2><span class="section-number">12.8. </span>Publication bias (or Famous bias or incubation bias…)<a class="headerlink" href="#publication-bias-or-famous-bias-or-incubation-bias" title="Link to this heading">#</a></h2>
<p>We discussed that we often look at past performance exactly because a strategy did well. This mechanism of selection renders our statistical analysis biased in the direction of findings that the strategy is amazing.</p>
<p>It is often hard to deal with this because you need all the data of strategies that look like the one you are interested from the perspective of someone in the start of the reliant sample. That is hard.</p>
<p>One way to deal with this is to use some hard metric of saliency.</p>
<ul class="simple">
<li><p>For example, check when Bitcoin became popular and we did our analysis after that.</p></li>
<li><p>See when a fund manager became well known because of his/her performance. While google trends is only available after 2004 there is data from New York Times and Wall Street Journal that allows you to go back to the start of the <strong>Last</strong> century. (<a class="reference external" href="http://www.google.com/url?q=http%3A%2F%2Fwww.sciencedirect.com%2Fscience%2Farticle%2Fpii%2FS0304405X16301751&amp;amp;sa=D&amp;amp;sntz=1&amp;amp;usg=AFQjCNFWO63SSQXSteNhgTI4oOhtmh0ZUQ">for example, I use data like that that in this paper</a>)</p></li>
</ul>
<p>A setting where we can do this very cleanly is in the context of academic work. We know exactly when the paper was first published and what the sample that was used there</p>
<p>A nice paper that investigates this for a bunch of strategies is <a class="reference external" href="https://onlinelibrary.wiley.com/doi/pdf/10.1111/jofi.12365?casa_token=gSqvouNM61EAAAAA:JyTl4yxx9xTfKo8-VEBIE-4c4ha7kRFGvirWzEZRXhYw2AtueM3yzpRDcpcXgnsDdlvlXflKp1Nw_ss">Does academic research destroy stock return predictability?</a></p>
<p><strong>Application: Evaluating the publication bias in Fama French 1996, Multifactor Anomalies…</strong></p>
<p>The original paper has the following table</p>
<p><img alt="outofsample" src="../../_images/outofsample2.jpg" /></p>
<ul class="simple">
<li><p>You see here that the sample runs from 63 to 93. Back in 93 we didn’t have digitalized accounting data that went back to the 30’s</p></li>
<li><p>Looking at the very last row we see that the alpha of the HML withresepect to the market is enormous, 0.56% per month, and it has a negative beta with the market!</p></li>
<li><p>so now we will look at two different samples that the authors never looked before doing their study.</p>
<ul>
<li><p>The pre 63 sample</p></li>
<li><p>the post 93.</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample1</span><span class="o">=</span><span class="n">df_ff6</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span><span class="o">&lt;</span><span class="mi">1964</span>
<span class="n">sample2</span><span class="o">=</span><span class="n">df_ff6</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span><span class="o">&gt;</span><span class="mi">1993</span>
<span class="n">sample3</span><span class="o">=</span><span class="p">((</span><span class="n">df_ff6</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span><span class="o">&gt;=</span><span class="mi">1964</span><span class="p">)</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">df_ff6</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span><span class="o">&lt;=</span><span class="mi">1993</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">=</span><span class="n">df_ff6</span><span class="p">[</span><span class="n">sample1</span><span class="p">]</span>
<span class="n">Results</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">Results</span><span class="p">[</span><span class="s1">&#39;Pre-publication&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">Diagnostics</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">df</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;HML&#39;</span><span class="p">])</span> 
<span class="n">df</span><span class="o">=</span><span class="n">df_ff6</span><span class="p">[</span><span class="n">sample3</span><span class="p">]</span>
<span class="n">Results</span><span class="p">[</span><span class="s1">&#39;publication&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">Diagnostics</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">df</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;HML&#39;</span><span class="p">])</span> 
<span class="n">df</span><span class="o">=</span><span class="n">df_ff6</span><span class="p">[</span><span class="n">sample2</span><span class="p">]</span>
<span class="n">Results</span><span class="p">[</span><span class="s1">&#39;Post-publication&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">Diagnostics</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">df</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;HML&#39;</span><span class="p">])</span> 
<span class="n">Results</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\alan.moreira\AppData\Local\Temp\ipykernel_7236\2254644634.py:25: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  results[&#39;alpha&#39;] = regresult.params[0]*12
C:\Users\alan.moreira\AppData\Local\Temp\ipykernel_7236\2254644634.py:26: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  results[&#39;t_alpha&#39;]= regresult.tvalues[0]
C:\Users\alan.moreira\AppData\Local\Temp\ipykernel_7236\2254644634.py:25: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  results[&#39;alpha&#39;] = regresult.params[0]*12
C:\Users\alan.moreira\AppData\Local\Temp\ipykernel_7236\2254644634.py:26: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  results[&#39;t_alpha&#39;]= regresult.tvalues[0]
C:\Users\alan.moreira\AppData\Local\Temp\ipykernel_7236\2254644634.py:25: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  results[&#39;alpha&#39;] = regresult.params[0]*12
C:\Users\alan.moreira\AppData\Local\Temp\ipykernel_7236\2254644634.py:26: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  results[&#39;t_alpha&#39;]= regresult.tvalues[0]
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Pre-publication</th>
      <th>publication</th>
      <th>Post-publication</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>SR</th>
      <td>0.352361</td>
      <td>0.604132</td>
      <td>0.108077</td>
    </tr>
    <tr>
      <th>SR_factor</th>
      <td>0.455849</td>
      <td>0.314978</td>
      <td>0.573769</td>
    </tr>
    <tr>
      <th>Vol</th>
      <td>0.150529</td>
      <td>0.090140</td>
      <td>0.115868</td>
    </tr>
    <tr>
      <th>Vol_factor</th>
      <td>0.225104</td>
      <td>0.155725</td>
      <td>0.155565</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>0.053041</td>
      <td>0.054457</td>
      <td>0.012523</td>
    </tr>
    <tr>
      <th>t_mean</th>
      <td>2.143329</td>
      <td>3.308967</td>
      <td>0.601745</td>
    </tr>
    <tr>
      <th>mean_factor</th>
      <td>0.102614</td>
      <td>0.049050</td>
      <td>0.089258</td>
    </tr>
    <tr>
      <th>t_mean_factor</th>
      <td>4.146536</td>
      <td>2.980440</td>
      <td>4.289102</td>
    </tr>
    <tr>
      <th>alpha</th>
      <td>0.014157</td>
      <td>0.064679</td>
      <td>0.018235</td>
    </tr>
    <tr>
      <th>t_alpha</th>
      <td>0.687582</td>
      <td>4.189373</td>
      <td>0.866463</td>
    </tr>
    <tr>
      <th>AR</th>
      <td>0.114143</td>
      <td>0.769107</td>
      <td>0.157960</td>
    </tr>
    <tr>
      <th>tails</th>
      <td>0.018018</td>
      <td>0.011111</td>
      <td>0.013441</td>
    </tr>
    <tr>
      <th>tails_factor</th>
      <td>0.022523</td>
      <td>0.008333</td>
      <td>0.008065</td>
    </tr>
    <tr>
      <th>min_ret</th>
      <td>-0.131100</td>
      <td>-0.098700</td>
      <td>-0.138800</td>
    </tr>
    <tr>
      <th>min_factor</th>
      <td>-0.291300</td>
      <td>-0.232400</td>
      <td>-0.172300</td>
    </tr>
    <tr>
      <th>t_SR</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>t_SR_factor</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>fraction_tohalf</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>fraction_tohalf_factor</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
</div></div><img alt="../../_images/81db8485ada9dd853a246a521bcf5ab50e5782364da077104cb9890583fa0f3e.png" src="../../_images/81db8485ada9dd853a246a521bcf5ab50e5782364da077104cb9890583fa0f3e.png" />
<img alt="../../_images/2db501a5366ca8c23ce0f5567a2346623259c572438cd18ab07308f08a3f1f5a.png" src="../../_images/2db501a5366ca8c23ce0f5567a2346623259c572438cd18ab07308f08a3f1f5a.png" />
<img alt="../../_images/b0f6876dbfdb6507ee5d3328f390946ec438132d5d4d568b20ce15338bb887fa.png" src="../../_images/b0f6876dbfdb6507ee5d3328f390946ec438132d5d4d568b20ce15338bb887fa.png" />
</div>
</div>
<blockquote>
<div><h4 class="rubric" id="takeaways">Takeaways</h4>
</div></blockquote>
<ul class="simple">
<li><p>In the Pre-publication sample HML has a respectable SR, but the asset is much more correlated with the market so it’s betas with respect to the market leaves only a statistically insignifcant 0.37% per month, 1.2% per year.</p></li>
<li><p>Thus in the pre-sample the HML has a nice SR but the CAPM works so you would not have gained/lost too much of tilting your portfolio towards the HML strategy</p></li>
<li><p>In the post-publication sample the results are very ugly</p>
<ul>
<li><p>Sharpe ratio is now 0.08–compared with the 0.58 SR on the market</p></li>
<li><p>the alpha is still about the same as in the pre-publication, but now the betas become negative</p></li>
<li><p>the HML premium goes away almost completely</p></li>
</ul>
</li>
</ul>
<p>To have a sense of the shift we can look at the risk-return trade-off of the market and HML across samples.</p>
<ul class="simple">
<li><p>The optimal weight on HML shifts from 0.72 in the publication sample to 0.34 in the pre publication and 0.2 in the post publication</p></li>
<li><p>someone that jsut invested on the market would be actually be closer to the optimal portfolio than someone that invested 0.7 in HML</p></li>
</ul>
<p><strong>Does that mean it was data snooping?</strong></p>
<p>We don’t know. It is possible that the publication drove people to the strategies which made the resuls go away goign forward. This <a class="reference external" href="https://onlinelibrary.wiley.com/doi/pdf/10.1111/jofi.12365?casa_token=gSqvouNM61EAAAAA:JyTl4yxx9xTfKo8-VEBIE-4c4ha7kRFGvirWzEZRXhYw2AtueM3yzpRDcpcXgnsDdlvlXflKp1Nw_ss">paper</a> I cited before argues that this is the case</p>
<p><strong>Literature</strong></p>
<ul class="simple">
<li><p><a class="reference external" href="https://faculty.fuqua.duke.edu/~charvey/Research/Published_Papers/P143_False_and_missed_OL.pdf">False (and Missed) Discoveries in Financial Economics</a></p></li>
<li><p><a class="reference external" href="http://rnm.simon.rochester.edu/research/PPiCToAPA.pdf">Predicting Anomaly Performance with Politics, the Weather, Global Warming, Sunspots, and the Stars</a> by Rober Novy Marx</p></li>
<li><p><a class="reference external" href="https://academic.oup.com/rfs/article-abstract/21/4/1455/1565737">A comprehensive look at the empirical performance of equity premium prediction</a></p></li>
<li><p>Inspecting whether your discovery is <strong>TRUE</strong> or just a statistical abnormality is science as much as it is art.</p></li>
<li><p>The more complicated a trading strategy, the more the in sample results are often a poor guide to how things behave out of sample</p></li>
<li><p>Looking for large t-stats only partially guard against that because you will be searching for things that have high t-stats and you are bound to find high t-stat strategies <strong>in sample</strong> even if no true large alpha strategy exists.</p></li>
<li><p>the literature on the biases that the “strategy discovery” process creates is vast and growing</p></li>
</ul>
<p>Patterns that are so statistically reliable that everyone can easily detect are unlikely to stay for long unless it is compensation for true risk.</p>
<p>So you are unlikely to find something that makes sense only based on the stats and you will need to use your <strong>economic logic</strong> to evaluate if you cna understand why the premium is as high as it is. We will discuss this less “quantitative” part of the process in the chapter Equilibrium Thinking.</p>
<p>Here are a few Twitter threads from people in the industry about this</p>
<ul class="simple">
<li><p><a class="reference external" href="https://twitter.com/macrocephalopod/status/1359810769433616384">someone tells you they have a strategy with a Sharpe of S. What questions should you be asking about the strategy to verify that it’s real?</a></p></li>
<li><p><a class="reference external" href="https://imarketsignals.com/2021/outperforming-the-sp-500-with-50-consensus-stock-holdings-of-40-large-hedge-funds/">The dumbest strategy ever created</a></p></li>
<li><p><a class="reference external" href="https://twitter.com/nope_its_lily/status/1368623837961621505">We are always looking for patterns, be careful!</a></p></li>
</ul>
<hr class="docutils" />
<p><strong>📝 Key Takeaways</strong></p>
<ul class="simple">
<li><p><strong>Sharpe and alpha complement each other.</strong>  The Sharpe ratio ranks the strategy standalone risk-return efficiency, while factor α  and appraisal ratio reveals skill over systematic risks</p></li>
<li><p><strong>Subtract the risk-free rate and test against factors—always.</strong>  Raw excess returns can look great until market beta or other factor loadings are accounted for.</p></li>
<li><p><strong>Statistical significance is fragile.</strong>  A high in-sample t-stat may vanish once you allow for multiple trials, shifting windows, or fresh data. Especially true when you did optimization in sample!</p></li>
<li><p><strong>Hold-out and cross-validation are your best friends.</strong>  True out-of-sample Sharpe ratios provide the clearest window on future performance.</p></li>
<li><p><strong>Over-fitting is the default, not the exception.</strong>  Without disciplined controls you will gravitate toward noise that “worked” by chance.</p></li>
<li><p><strong>Strategy blends demand covariance awareness.</strong>  Combining two high-Sharpe ideas poorly can lower overall risk-adjusted returns; optimizing weights on one half and testing on the other guards against that trap.</p></li>
<li><p><strong>Publication bias is real and costly.</strong>  Many celebrated anomalies fade once they become popular; splitting the sample before and after notoriety helps set realistic alphas.</p></li>
<li><p><strong>A rigorous evaluation process is an edge in itself.</strong>  Clear goals, transparent diagnostics, and robust testing protect capital better than any single clever signal.</p></li>
</ul>
<hr class="docutils" />
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chapters/Finance"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="CapitalAllocationII.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">11. </span>Capital Allocation II</p>
      </div>
    </a>
    <a class="right-next"
       href="MachineLearning.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">13. </span>Machine Learning</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#alpha-test">12.1. Alpha Test</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-we-focus-on-alpha">12.2. Why we focus on Alpha?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-mve-allocation-across-factors">12.3. Example: MVE allocation across factors</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-basic-problem-of-overfitting">12.4. The basic problem of overfitting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#be-clear-about-you-goal">12.5. Be clear about you goal</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-guard-against-it">12.6. How to guard against it?</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#additional-diagnostics">12.6.1. Additional Diagnostics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#adjusting-for-discarded-signals">12.6.2. Adjusting for Discarded Signals</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-split-you-sample">12.7. How to split you sample?</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#robustifying-your-backtests">12.7.1. Robustifying your Backtests</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#publication-bias-or-famous-bias-or-incubation-bias">12.8. Publication bias (or Famous bias or incubation bias…)</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Alan Moreira
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2021 Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0).
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>