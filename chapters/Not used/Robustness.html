
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Robustness of Quantitative Strategies &#8212; Quantitative Investing</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/book.css?v=c2893119" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapters/Not used/Robustness';</script>
    <link rel="canonical" href="https://amoreira2.github.io/Fin418/chapters/Not used/Robustness.html" />
    <link rel="icon" href="../../_static/figuremain2.jpg"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/figuremain2.jpg" class="logo__image only-light" alt="Quantitative Investing - Home"/>
    <script>document.write(`<img src="../../_static/figuremain2.jpg" class="logo__image only-dark" alt="Quantitative Investing - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../01/what-is-quant-investing.html">1. What is Data Driven Investing?</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../01/statistical-techniques.html">1.1. Statistical Techniques</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01/computational-tools.html">1.2. Computational tools</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../02/getting_started.html">2. Getting Started</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../02/cloud_setup.html">2.3. Cloud Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02/local_install.html">2.4. Local installation</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../essentials/intro.html">3. Python Essentials</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../essentials/basics.html">3.1. Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/collections.html">3.2. Collections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/numpy.html">3.3. Numpy</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../essentials/introtopandas.html">3.4. Pandas</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/the_index.html">3.4.3. Indexing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/timeseries.html">3.4.4. Time-Series</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/reshape.html">3.4.5. Reshape</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/merge.html">3.4.6. Merge</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/groupby.html">3.4.7. Group-by</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/matplotlib.html">3.4.8. Plotting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/data_clean.html">3.4.9. Cleaning data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/storage_formats.html">3.4.10. Data Storage</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/control_flow.html">3.5. Flow control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/functions.html">3.6. Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/plotting.html">3.7. Plotting</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Finance/IntrotoReturns.html">4. Introduction to Asset Returns</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../Finance/TheChoiceofFrequency.html">4.5. The Choice of Frequency and Annualization of Returns</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Finance/UsingAPI.html">4.6. Data APIs</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../Finance/FactorModels.html">5. Factor Models</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Finance/PortfolioMath.html">6. Portfolios</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../scientific/linear_algebra1.html">6.5. Linear Algebra Review</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../Finance/CapitalAllocationI.html">7. Capital Allocation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Finance/FactorModelEstimation.html">8. Factor Model Estimation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Finance/Timing.html">9. Timing Strategies</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../Finance/MarketTiming.html">9.1. Expected Returns Timing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Finance/Volatilitytiming.html">9.2. Volatility Timing</a></li>

</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Finance/crosssectionalequitystrategies.html">10. Cross-Sectional Equity Strategies</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../Finance/Momentum.html">10.3. Momentum factor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Finance/Factors.html">10.4. An overview of factors</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../Finance/CapitalAllocationII.html">11. Capital Allocation II</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Finance/Performance_evaluation.html">12. Performance Evaluation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Finance/MachineLearning.html">13. Machine Learning in Finance</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Finance/MultiFactorModels.html">14. Multi Factor Models</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../Finance/InterpretingFactorModels.html">14.6. 📊 Interpreting Factor Models</a></li>


</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../Finance/RiskManagement.html">15. Risk Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Finance/TradingCosts.html">16. Liquidity and Trading Cost Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Finance/LeverageandShorting.html">17. Leverage, Shorting, and Limits to Arbitrage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Finance/GenAIandLLMsinFinance.html">18. Gen AI and LLMs in Finance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../additional/additional.html">19. Additional Statistics Material</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Assignments/Assignments.html">20. Assignments</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment1.html">20.1. Assignment 1</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/amoreira2/Fin418/blob/main/chapters/Not used/Robustness.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/amoreira2/Fin418" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/amoreira2/Fin418/issues/new?title=Issue%20on%20page%20%2Fchapters/Not used/Robustness.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/chapters/Not used/Robustness.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Robustness of Quantitative Strategies</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-basic-problem-of-overfitting">The basic problem of overfitting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#suggestions-to-guard-against-overfitting">Suggestions to guard against overfitting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#optimization-makes-it-worse">Optimization makes it worse</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#additional-diagnostics">Additional Diagnostics</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#confidence-intervals-t-tests-for-sharpe-ratios">Confidence intervals/T-tests for Sharpe Ratios</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#distribution-sampling">Distribution sampling</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#adjusting-for-discarded-signals">Adjusting for Discarded Signals</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#robustifying-your-backtests">Robustifying your Backtests</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#approaches-for-sample-spliting">Approaches for sample spliting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dradowns">Dradowns</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#publication-bias-or-famous-bias-or-incubation-bias">Publication bias (or Famous bias or incubation bias…)</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># First we start loading our favourite packages with the names we used to</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="c1"># import regression package</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">statsmodels.api</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sm</span>
</pre></div>
</div>
</div>
</div>
<section class="tex2jax_ignore mathjax_ignore" id="robustness-of-quantitative-strategies">
<h1>Robustness of Quantitative Strategies<a class="headerlink" href="#robustness-of-quantitative-strategies" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>The more complicated a trading strategy, the more the in sample results are often a poor guide to how things behave out of sample</p></li>
<li><p>Looking for large t-stats only partially guard against that because you will be searching for things that have high t-stats and you are bound to find high t-stat strategies <strong>in sample</strong> even if no true large alpha strategy exists.</p></li>
<li><p>the literature on the biases that the “strategy discovery” process creates is vast and growing</p></li>
</ul>
<p><strong>Literature</strong></p>
<ul class="simple">
<li><p><a class="reference external" href="https://faculty.fuqua.duke.edu/~charvey/Research/Published_Papers/P143_False_and_missed_OL.pdf">False (and Missed) Discoveries in Financial Economics</a></p></li>
<li><p><a class="reference external" href="http://rnm.simon.rochester.edu/research/PPiCToAPA.pdf">Predicting Anomaly Performance with Politics, the Weather, Global Warming, Sunspots, and the Stars</a> by Rober Novy Marx</p></li>
<li><p><a class="reference external" href="https://academic.oup.com/rfs/article-abstract/21/4/1455/1565737">A comprehensive look at the empirical performance of equity premium prediction</a></p></li>
</ul>
<p>Inspecting whether your discovery is <strong>TRUE</strong> or just a statistical abnormality is science as much as it is art.</p>
<p>Patterns that are so statistically reliable that everyone can easily detect are unlikely to stay for long unless it is compensation for true risk.</p>
<p>So you are unlikely to find something that makes sense only based on the stats and you will need to use your <strong>economic logic</strong> to evaluate if you cna understand why the premium is as high as it is. We will discuss this less “quantitative” part of the process in the chapter Equilibrium Thinking.</p>
<p>Here we will highlight the problem and discuss a few statistical techniques.</p>
<p>Here are a few Twitter threads from people in the industry about this</p>
<ul class="simple">
<li><p><a class="reference external" href="https://twitter.com/macrocephalopod/status/1359810769433616384">someone tells you they have a strategy with a Sharpe of S. What questions should you be asking about the strategy to verify that it’s real?</a></p></li>
<li><p><a class="reference external" href="https://twitter.com/macrocephalopod/status/1362165448205295620?s=20">overfiting</a></p></li>
</ul>
<p>It has this really nice plot</p>
<p><img alt="outofsample" src="../../_images/outofsample1.jpg" /></p>
<blockquote>
<div><p>What does it tell us?</p>
</div></blockquote>
<ul class="simple">
<li><p><a class="reference external" href="https://imarketsignals.com/2021/outperforming-the-sp-500-with-50-consensus-stock-holdings-of-40-large-hedge-funds/">The dumbest strategy ever created</a></p></li>
<li><p><a class="reference external" href="https://twitter.com/nope_its_lily/status/1368623837961621505">We are always looking for patterns, be careful!</a></p></li>
</ul>
<section id="the-basic-problem-of-overfitting">
<h2>The basic problem of overfitting<a class="headerlink" href="#the-basic-problem-of-overfitting" title="Link to this heading">#</a></h2>
<p>Any sample estimate  is itself a random variable.  The uncertainty in these estimates may encourage us to:</p>
<ul class="simple">
<li><p>Select signals that are pure noise with no real predictive power.</p></li>
<li><p>Select real signals but overweight their importance to the model.</p></li>
<li><p>Reject signals that are real but that did not show up in the sample.</p></li>
<li><p>Make inaccurate assessments of strategy quality and poor resource allocation.</p></li>
<li><p>When choosing model weights, implicitly and explicitly (through optimization) we assign weights that exaggerate the overfitting problem.</p></li>
<li><p>Weights tilt toward signals with the most error. Leading to bigger degradation in out-of-sample performance going forward.</p></li>
</ul>
</section>
<section id="suggestions-to-guard-against-overfitting">
<h2>Suggestions to guard against overfitting<a class="headerlink" href="#suggestions-to-guard-against-overfitting" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Additional diagnostics</p></li>
<li><p>Robustness tests</p></li>
<li><p>Estimation/validation/Out of Sample analysis</p></li>
<li><p>Optimization?</p></li>
<li><p>Simulations?</p></li>
</ul>
</section>
<section id="optimization-makes-it-worse">
<h2>Optimization makes it worse<a class="headerlink" href="#optimization-makes-it-worse" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>It is a form of in-sample regression.</p></li>
<li><p>Weights in model heavily determined by in-sample statistics, often the most extreme weights most likely to be off</p></li>
</ul>
</section>
<section id="additional-diagnostics">
<h2>Additional Diagnostics<a class="headerlink" href="#additional-diagnostics" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Strategy Sharpe Ratio</p></li>
<li><p>Report t-stat of mean return</p></li>
<li><p>Alpha and t-stat of alpha</p></li>
<li><p>Confidence intervals around key results including SR</p></li>
<li><p>Strategy performance with small perturbations ( say change horizon, skip a month)</p></li>
<li><p>Cumulative return  and drawdown graphs</p>
<ul>
<li><p>where the performance is coming form? Is it steady? When it does poorly?</p></li>
</ul>
</li>
<li><p>Report percentage of observations with +/- 3 std events</p></li>
<li><p>Remove “influential data points”: Calculate fraction of data points needed to halve estimated Sharpe ratio.</p></li>
<li><p>When comparing Strategies, always do it over the same sample period!</p></li>
</ul>
<section id="confidence-intervals-t-tests-for-sharpe-ratios">
<h3>Confidence intervals/T-tests for Sharpe Ratios<a class="headerlink" href="#confidence-intervals-t-tests-for-sharpe-ratios" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>If returns are normal</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\sigma(SR)=\sqrt{\frac{1}{T-1}(1+SR^2/2)}\]</div>
<p>where T is the sample size and SR is the estimated Sharpe Ratio</p>
<blockquote>
<div><p>what are the 95% Confidence intervals?</p>
</div></blockquote>
</section>
<section id="distribution-sampling">
<h3>Distribution sampling<a class="headerlink" href="#distribution-sampling" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Instead of assuming returns have a particular distribution we can sample from the realized distribution to obtain alternative realization of the world</p></li>
</ul>
<p><strong>Bootstrap</strong>
- Draw from the data with replacement T times. This gives you a “new sample”.
- Construct The sharpe ratio in this sample, save it
- Do that M times and compute the standard deviation of the SR across samples
- You can also directly look at the 5% worse realizations
- This give you the different SR that can be produced by the same truth</p>
</section>
<section id="adjusting-for-discarded-signals">
<h3>Adjusting for Discarded Signals<a class="headerlink" href="#adjusting-for-discarded-signals" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Often we look at many signals to find the one</p></li>
<li><p>This makes conventional thresholds for t-tests too small</p></li>
<li><p>There are many different adjustments for this</p></li>
</ul>
<p>Boferroni T-stats</p>
<p><img alt="Bonferroni Correction" src="../../_images/bonferroni.jpg" /></p>
<ul class="simple">
<li><p>You go form 1.96 to 3 as you look at 20 signals instead of 1</p></li>
<li><p>It is a pretty conservative adjustment</p></li>
<li><p>Correction changes the most as you go from 1 to 5 signals</p></li>
</ul>
</section>
<section id="robustifying-your-backtests">
<h3>Robustifying your Backtests<a class="headerlink" href="#robustifying-your-backtests" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Calculate out of sample Sharpe ratios: Have a hold-out sample not used in backtest to test out of sample performance.</p></li>
<li><p>Be careful to not use out of sample results for tunning and model choice</p></li>
<li><p>When tuning/model choice is needed it is useful to have</p>
<ul>
<li><p>Estimation</p></li>
<li><p>Test sample</p></li>
<li><p>Hold out sample</p></li>
</ul>
</li>
<li><p>Add random noise to signals (some fraction of vol.) to slightly distort rankings and recompute Sharpe.</p></li>
<li><p>How robust are slight perturbations in the cross-sectional rankings?</p></li>
<li><p>Calculate the Sharpe ratio for a strategy that always eliminates the top 2% long and short positions (which are most likely error prone).</p></li>
<li><p>Keep track of your discarded ideas going forward</p></li>
<li><p>You need to calibrate your discovery process to be tough, but not too tough. Otherwise you will discard too many good signals.</p></li>
</ul>
</section>
</section>
<section id="approaches-for-sample-spliting">
<h2>Approaches for sample spliting<a class="headerlink" href="#approaches-for-sample-spliting" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Rolling window estimation</p></li>
<li><p>Use odd months to estimate signals and even months to compute returns and test signals.  Repeat by switching odd and even months.</p></li>
<li><p>Split sample in half, estimation and test sample</p></li>
<li><p>Split in three: estimation, test for model selection, hold-out sample</p></li>
</ul>
<p>Be very careful for information of the test sample to leak into the estimation.</p>
<p>For example, your idea might be motivated by a few months where you know these firms did well. Be sure to check the results are not driving by this</p>
<ul class="simple">
<li><p>If you use result of the test sample to choose a model parameter–evaluate in a third holdout sample</p></li>
</ul>
<p><strong>Aplication 1: optimal combitation of market and value strategies</strong></p>
<p>Below is our full sample optimal portfolio</p>
<p>We will split our sample into two halves:</p>
<ol class="arabic simple">
<li><p>take all observations from odd months in even years and even months in odd years (i.e., if starting in 1980, this would look like:  01/1980, 03/1980, … , 11/1980, 02/1981, 04/1981, … 12/1981, 01/1982, 03/1982, …); and</p></li>
<li><p>the opposite (take all observations from even months in even years and odd months in odd years).</p></li>
</ol>
<p>A nice thing to do in halves is that we can cross-validated  use first sample 1 as estiamtion sample and sample2 as test sample, and then invert</p>
<p>If you have lot of data one migh split the data in 5 folds and do the estimation in one and test on the rest.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># loading the data</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pandas_datareader.data</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">web</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">1926</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="s1">&#39;F-F_Research_Data_Factors&#39;</span><span class="p">,</span> <span class="s1">&#39;famafrench&#39;</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">)</span>
<span class="n">df</span><span class="o">=</span><span class="n">ds</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="s1">&#39;2021-3&#39;</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
PeriodIndex: 1137 entries, 1926-07 to 2021-03
Freq: M
Data columns (total 4 columns):
 #   Column  Non-Null Count  Dtype  
---  ------  --------------  -----  
 0   Mkt-RF  1137 non-null   float64
 1   SMB     1137 non-null   float64
 2   HML     1137 non-null   float64
 3   RF      1137 non-null   float64
dtypes: float64(4)
memory usage: 44.4 KB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># lets define a function to calculate the Sharpe ratio  </span>
<span class="k">def</span><span class="w"> </span><span class="nf">SR</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">freq</span><span class="o">=</span><span class="mi">12</span><span class="p">):</span>
    <span class="n">sr</span><span class="o">=</span><span class="n">R</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">/</span><span class="n">R</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">*</span><span class="n">freq</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="k">return</span> <span class="n">sr</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Assets</span><span class="o">=</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">,</span><span class="s1">&#39;HML&#39;</span><span class="p">]]</span>
<span class="n">Cov</span><span class="o">=</span><span class="n">Assets</span><span class="o">.</span><span class="n">cov</span><span class="p">()</span>
<span class="n">ER</span><span class="o">=</span><span class="n">Assets</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">Vol_mkt</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<span class="n">X</span><span class="o">=</span><span class="n">ER</span><span class="nd">@np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Cov</span><span class="p">)</span>
<span class="c1"># formula for unlevereaged portfolio vol</span>
<span class="n">vol_unlevered</span><span class="o">=</span><span class="p">(</span><span class="n">ER</span><span class="nd">@np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Cov</span><span class="p">)</span><span class="nd">@ER</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
<span class="n">X_lev</span><span class="o">=</span><span class="n">X</span><span class="o">*</span><span class="p">(</span><span class="n">Vol_mkt</span><span class="o">/</span><span class="n">vol_unlevered</span><span class="p">)</span>

<span class="n">Returns</span><span class="o">=</span> <span class="n">Assets</span> <span class="o">@</span> <span class="n">X_lev</span>
<span class="n">SR</span><span class="p">(</span><span class="n">Returns</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.49973547632746695
</pre></div>
</div>
</div>
</div>
<p>Can you construct the 95% Confidence interval for this Sharpe Ratio?</p>
<ul class="simple">
<li><p>Formula based answer</p></li>
<li><p>Bootstrap based answer</p></li>
</ul>
<p>Letss construct both samples by using a function that returns <code class="docutils literal notranslate"><span class="pre">True</span></code> if the number is odd and then apply this function to the months and years of our dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># construct function that identifies if a number is odd</span>
<span class="k">def</span><span class="w"> </span><span class="nf">is_odd</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">num</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span>

<span class="c1"># create a sample that selects the even years and odd months</span>
<span class="n">evenyear_oddmonth</span><span class="o">=</span><span class="p">(</span><span class="n">is_odd</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">==</span><span class="kc">False</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">is_odd</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">==</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># create a sample that selects the odd years and even months</span>
<span class="n">oddyear_evenmonth</span><span class="o">=</span><span class="p">(</span><span class="n">is_odd</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">==</span><span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">is_odd</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">==</span><span class="kc">False</span><span class="p">)</span>
<span class="c1"># join the two samples</span>
<span class="n">sample1</span><span class="o">=</span><span class="n">evenyear_oddmonth</span> <span class="o">|</span> <span class="n">oddyear_evenmonth</span>
<span class="c1"># creates the mirror sample</span>
<span class="n">sample2</span><span class="o">=~</span><span class="n">sample1</span>
</pre></div>
</div>
</div>
</div>
<p>Lets construct a function that takes the sample and returns the SR</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># function gets data and sample and returns the returns of the strategy </span>
<span class="k">def</span><span class="w"> </span><span class="nf">Strat_wgts</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
   
    <span class="n">X</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="nd">@np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">cov</span><span class="p">())</span>
    <span class="n">vol_unlevered</span><span class="o">=</span><span class="p">(</span><span class="n">X</span><span class="nd">@df</span><span class="o">.</span><span class="n">cov</span><span class="p">()</span><span class="nd">@X</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="n">vol_mkt</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    <span class="n">X_lev</span><span class="o">=</span><span class="n">X</span><span class="o">*</span><span class="p">(</span><span class="n">vol_mkt</span><span class="o">/</span><span class="n">vol_unlevered</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">X_lev</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Strat_wgts</span><span class="p">(</span><span class="n">Assets</span><span class="p">[</span><span class="n">sample1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0.71684899, 0.8334495 ])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Strat_wgts</span><span class="p">(</span><span class="n">Assets</span><span class="p">[</span><span class="n">sample1</span><span class="p">])</span><span class="nd">@Assets</span><span class="p">[</span><span class="o">~</span><span class="n">sample1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Date
1926-08    5.076258
1926-10   -1.739176
1926-12    1.836472
1927-01    3.740850
1927-03   -2.082113
             ...   
2020-08    2.994213
2020-10    2.036777
2020-12    2.060502
2021-01    2.487178
2021-03    8.367087
Freq: M, Length: 569, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Optimal portfolio perfomance in sample 2 (estimation sample 1)&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">SR</span><span class="p">(</span><span class="n">Strat_wgts</span><span class="p">(</span><span class="n">Assets</span><span class="p">[</span><span class="n">sample1</span><span class="p">])</span><span class="nd">@Assets</span><span class="p">[</span><span class="n">sample2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Market perfomance in sample 2&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">SR</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]][</span><span class="n">sample2</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Optimal portfolio perfomance in sample 1 (estimation sample 2)&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">SR</span><span class="p">(</span><span class="n">Strat_wgts</span><span class="p">(</span><span class="n">Assets</span><span class="p">[</span><span class="n">sample2</span><span class="p">])</span><span class="nd">@Assets</span><span class="p">[</span><span class="n">sample1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Market perfomance in sample 1&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">SR</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]][</span><span class="n">sample1</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimal portfolio perfomance in sample 2 (estimation sample 1)
0.5389590626921715
Market perfomance in sample 2
Mkt-RF    0.502805
dtype: float64
Optimal portfolio perfomance in sample 1 (estimation sample 2)
0.452846286456286
Market perfomance in sample 1
Mkt-RF    0.38695
dtype: float64
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>What do we learn?</p></li>
</ul>
<p>Lets modify our function to include the estimation of the alpha relative to the market</p>
<p>Lets wrap this in a function that computes this for us</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">Analysis</span><span class="p">(</span><span class="n">Returns</span><span class="p">,</span><span class="n">Market</span><span class="p">):</span>
    <span class="n">results</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([],</span><span class="n">index</span><span class="o">=</span><span class="p">[],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">results</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;Strategy:SR&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">SR</span><span class="p">(</span><span class="n">Returns</span><span class="p">)</span>
    <span class="n">results</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;Strategy:std&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">Returns</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">*</span><span class="mi">12</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="n">results</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;MKT:SR&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">SR</span><span class="p">(</span><span class="n">Market</span><span class="p">)</span>
    <span class="n">results</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;MKT:std&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">Market</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">*</span><span class="mi">12</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="c1"># now run the regression</span>
    <span class="n">x</span><span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">Market</span><span class="p">)</span>
    <span class="n">regresult</span><span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">Returns</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    <span class="n">results</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">regresult</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">results</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;t(alpha)&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">regresult</span><span class="o">.</span><span class="n">tvalues</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">results</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Results for  test sample 2 (estimation sample 1)&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Analysis</span><span class="p">(</span><span class="n">Strat_wgts</span><span class="p">(</span><span class="n">Assets</span><span class="p">[</span><span class="n">sample1</span><span class="p">])</span><span class="nd">@Assets</span><span class="p">[</span><span class="n">sample2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">Assets</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sample2</span><span class="p">,</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Results for  test sample 1 (estimation sample 2)&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Analysis</span><span class="p">(</span><span class="n">Strat_wgts</span><span class="p">(</span><span class="n">Assets</span><span class="p">[</span><span class="n">sample2</span><span class="p">])</span><span class="nd">@Assets</span><span class="p">[</span><span class="n">sample1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">Assets</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sample1</span><span class="p">,</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Results for  test sample 2 (estimation sample 1)
Strategy:SR      0.538959
Strategy:std    18.232429
MKT:SR           0.502805
MKT:std         18.066091
alpha            0.168324
t(alpha)         1.438795
dtype: float64
Results for  test sample 1 (estimation sample 2)
Strategy:SR      0.452846
Strategy:std    18.831038
MKT:SR           0.386950
MKT:std         18.989794
alpha            0.153165
t(alpha)         1.681847
dtype: float64
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>what do we learn?</p></li>
<li><p>What other diagnostics can you add to this function?</p></li>
<li><p>would it make sense to compute alpha with respect to the Fama-French 3 factor model–which includes HML as one of the factors?</p></li>
</ul>
</section>
<section id="dradowns">
<h2>Dradowns<a class="headerlink" href="#dradowns" title="Link to this heading">#</a></h2>
<p>It is common to look at how lond are the periods where you are losing money on a strategy</p>
<p>This might inform you how sticky your clients need to be. For example might inform how long the lockup in your fund might need to be</p>
<p>This is also relevant for Hedge funds where hedge fund managers are compensated only when they go above the high-water mark</p>
<p>or much more basically how long are going to be the painful periods where you are losing money</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># start by cumulating the returns</span>
<span class="n">X</span><span class="o">=</span><span class="p">(</span><span class="n">Returns</span><span class="o">/</span><span class="mi">100</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span>
<span class="c1"># computing the running max for each asset</span>
<span class="n">running_max</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">cummax</span><span class="p">()</span>

<span class="c1"># Calculate the drawdown by comparing the running_max with the current value of the portfolio </span>
<span class="n">drawdown</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span> <span class="o">-</span> <span class="n">running_max</span><span class="p">)</span><span class="o">/</span><span class="n">running_max</span>
<span class="n">drawdown</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;Date&#39;&gt;
</pre></div>
</div>
<img alt="../../_images/64bb56f06bf70fa0898f68ad8b40252464dbf19b1d7486d9ec3be083de5274c1.png" src="../../_images/64bb56f06bf70fa0898f68ad8b40252464dbf19b1d7486d9ec3be083de5274c1.png" />
</div>
</div>
<p><strong>Application 2: fine-tuning the look-back window</strong></p>
<p>Now we will compare a variety of models to see which one works best outside of the test sample</p>
<p>So we will have the estimation sample where we will estimate the different models– which in this case will be strategies with different look-back windows</p>
<p>What is a look-back window?</p>
<ul class="simple">
<li><p>It is the window the we use to estimate our moments</p></li>
</ul>
<p>The trade-off here is:</p>
<ul class="simple">
<li><p>If you make too short you just pick up noise</p></li>
<li><p>If you make too long the moments might not be that informative about future data</p></li>
<li><p>Particularly true in he case of volatility, but also true for correlations and expected returns</p></li>
<li><p>Particularly severe when dealing with individual assets and not characteristic-based strategies</p></li>
</ul>
<p>We will split the sample in two.</p>
<ul class="simple">
<li><p>The first half will be estimation+test,</p></li>
<li><p>second half will be hold out</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">holdout_sample</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">&gt;</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">))]</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>We will now do the estimation fine-tuning.</p></li>
</ul>
<ul class="simple">
<li><p>Lets start by building a code that gets our desired window, do the estimation and construct the return series on the test sample</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">window</span><span class="o">=</span><span class="mi">36</span>
<span class="n">df1</span><span class="o">=</span><span class="n">Assets</span><span class="p">[</span><span class="o">~</span><span class="n">holdout_sample</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">Returns</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([],</span><span class="n">index</span><span class="o">=</span><span class="n">df1</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="c1"># Use data that is not in the holdout sample to estimate the strategy</span>

<span class="c1"># loop over the test sample</span>
<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">df1</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">window</span><span class="p">:]:</span>
    <span class="c1"># select the first 36 months of the sample ( and then add one more month at the tail and drop the last month on the head each time we loop over the sample)</span>
    <span class="n">df_temp</span><span class="o">=</span><span class="n">df1</span><span class="p">[</span><span class="n">d</span><span class="o">-</span><span class="n">window</span><span class="p">:</span><span class="n">d</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="c1"># construct optimal portfolio given these 36 months</span>
    <span class="n">X</span><span class="o">=</span><span class="n">Strat_wgts</span><span class="p">(</span><span class="n">df_temp</span><span class="p">)</span>
    <span class="c1"># save the returns of the strategy and the market on the FOLLOWING month</span>
    <span class="c1"># this month does NOT enter the estimation of the strategy</span>
    <span class="n">Returns</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">d</span><span class="p">,</span><span class="s1">&#39;Strategy&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">@</span> <span class="n">X</span>
    <span class="n">Returns</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">d</span><span class="p">,</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">d</span><span class="p">,</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span>

<span class="n">Returns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Strategy</th>
      <th>Mkt-RF</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1926-07</th>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1926-08</th>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1926-09</th>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1926-10</th>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1926-11</th>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1973-07</th>
      <td>-9.186490</td>
      <td>5.05</td>
    </tr>
    <tr>
      <th>1973-08</th>
      <td>3.179297</td>
      <td>-3.82</td>
    </tr>
    <tr>
      <th>1973-09</th>
      <td>-0.359387</td>
      <td>4.75</td>
    </tr>
    <tr>
      <th>1973-10</th>
      <td>2.913735</td>
      <td>-0.83</td>
    </tr>
    <tr>
      <th>1973-11</th>
      <td>7.358294</td>
      <td>-12.75</td>
    </tr>
  </tbody>
</table>
<p>569 rows × 2 columns</p>
</div></div></div>
</div>
<ul class="simple">
<li><p>Note that we have no observations early on as we need at the 36 months to estimate and none in the second half, that is the sample that we will hold out</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Returns</span><span class="o">=</span><span class="n">Returns</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">Analysis</span><span class="p">(</span><span class="n">Returns</span><span class="p">[</span><span class="s1">&#39;Strategy&#39;</span><span class="p">],</span><span class="n">Returns</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Strategy:SR      0.360352
Strategy:std    22.322705
MKT:SR           0.349431
MKT:std         21.225423
alpha            0.735406
t(alpha)         2.632149
dtype: float64
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Now that we have this code we can put in a function so we can evaluate for different lookbacks</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">RollingEval</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">window</span><span class="p">):</span>

    <span class="n">Returns</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([],</span><span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">window</span><span class="p">:]:</span>
        <span class="n">df_temp</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">d</span><span class="o">-</span><span class="n">window</span><span class="p">:</span><span class="n">d</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">X</span><span class="o">=</span><span class="n">Strat_wgts</span><span class="p">(</span><span class="n">df_temp</span><span class="p">)</span>
        <span class="n">Returns</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">d</span><span class="p">,</span><span class="s1">&#39;Strategy&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">@</span> <span class="n">X</span>
        <span class="n">Returns</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">d</span><span class="p">,</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">d</span><span class="p">,</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">Returns</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Returns</span><span class="o">=</span><span class="n">RollingEval</span><span class="p">(</span><span class="n">Assets</span><span class="p">[</span><span class="o">~</span><span class="n">holdout_sample</span><span class="p">],</span><span class="mi">36</span><span class="p">)</span>        
<span class="n">Returns</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">Returns</span><span class="o">=</span><span class="n">Returns</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">Analysis</span><span class="p">(</span><span class="n">Returns</span><span class="p">[</span><span class="s1">&#39;Strategy&#39;</span><span class="p">],</span><span class="n">Returns</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Strategy:SR      0.360352
Strategy:std    22.322705
MKT:SR           0.349431
MKT:std         21.225423
alpha            0.735406
t(alpha)         2.632149
dtype: float64
</pre></div>
</div>
<img alt="../../_images/4c583eae28e036beec737793a93f6d87c0b7d6d618b970195b7cc0759f9692c3.png" src="../../_images/4c583eae28e036beec737793a93f6d87c0b7d6d618b970195b7cc0759f9692c3.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">windows</span><span class="o">=</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">36</span><span class="p">,</span><span class="mi">48</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">72</span><span class="p">]</span>
<span class="n">results</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([],</span><span class="n">index</span><span class="o">=</span><span class="p">[],</span><span class="n">columns</span><span class="o">=</span><span class="n">windows</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">windows</span><span class="p">:</span>
    <span class="n">Returns</span><span class="o">=</span><span class="n">RollingEval</span><span class="p">(</span><span class="n">Assets</span><span class="p">[</span><span class="o">~</span><span class="n">holdout_sample</span><span class="p">],</span><span class="n">w</span><span class="p">)</span> 
    <span class="n">Returns</span><span class="o">=</span><span class="n">Returns</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">results</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">w</span><span class="p">]</span><span class="o">=</span><span class="n">Analysis</span><span class="p">(</span><span class="n">Returns</span><span class="p">[</span><span class="s1">&#39;Strategy&#39;</span><span class="p">],</span><span class="n">Returns</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">])</span>   
    
<span class="n">results</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>6</th>
      <th>12</th>
      <th>24</th>
      <th>36</th>
      <th>48</th>
      <th>60</th>
      <th>72</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Strategy:SR</th>
      <td>0.339344</td>
      <td>0.593013</td>
      <td>0.388520</td>
      <td>0.360352</td>
      <td>0.398544</td>
      <td>0.427686</td>
      <td>0.353257</td>
    </tr>
    <tr>
      <th>Strategy:std</th>
      <td>35.943622</td>
      <td>26.322347</td>
      <td>23.458076</td>
      <td>22.322705</td>
      <td>21.383926</td>
      <td>20.388704</td>
      <td>18.834621</td>
    </tr>
    <tr>
      <th>MKT:SR</th>
      <td>0.401424</td>
      <td>0.396024</td>
      <td>0.375995</td>
      <td>0.349431</td>
      <td>0.395619</td>
      <td>0.442285</td>
      <td>0.599573</td>
    </tr>
    <tr>
      <th>MKT:std</th>
      <td>20.961079</td>
      <td>21.050924</td>
      <td>21.156650</td>
      <td>21.225423</td>
      <td>20.875654</td>
      <td>20.531690</td>
      <td>19.393674</td>
    </tr>
    <tr>
      <th>alpha</th>
      <td>1.085571</td>
      <td>1.356543</td>
      <td>0.792946</td>
      <td>0.735406</td>
      <td>0.789604</td>
      <td>0.774403</td>
      <td>0.473750</td>
    </tr>
    <tr>
      <th>t(alpha)</th>
      <td>2.467810</td>
      <td>4.190904</td>
      <td>2.717958</td>
      <td>2.632149</td>
      <td>2.916528</td>
      <td>2.947537</td>
      <td>1.919127</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>What else would you want to look at before peeking at the hold out sample?</p></li>
<li><p>Recall that once you look, you have to stop!</p></li>
<li><p>Is this pattern consistent with a better more reliable estimate of Expected returns? And Volatilities? And correlations?</p></li>
<li><p>How to figure out where the results are coming from?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># #hold out sample results</span>
<span class="c1">#w=?</span>
<span class="c1"># Returns=RollingEval(Assets[holdout_sample],w) </span>
<span class="c1"># Returns=Returns.dropna()</span>
<span class="c1"># Analysis(Returns[&#39;Strategy&#39;],Returns[&#39;Mkt-RF&#39;])   </span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>So what do you conclude?</p></li>
</ul>
</section>
<section id="publication-bias-or-famous-bias-or-incubation-bias">
<h2>Publication bias (or Famous bias or incubation bias…)<a class="headerlink" href="#publication-bias-or-famous-bias-or-incubation-bias" title="Link to this heading">#</a></h2>
<p>We discussed that we often look at past performance exactly because a strategy did well. This mechanism of selection renders our statistical analysis biased in the direction of findings that the strategy is amazing.</p>
<p>It is often hard to deal with this because you need all the data of strategies that look like the one you are interested from the perspective of someone in the start of the reliant sample. That is hard.</p>
<p>One way to deal with this is to use some hard metric of saliency.</p>
<ul class="simple">
<li><p>For example, check when Bitcoin became popular and we did our analysis after that.</p></li>
<li><p>See when a fund manager became well known because of his/her performance. While google trends is only available after 2004 there is data from New York Times and Wall Street Journal that allows you to go back to the start of the <strong>Last</strong> century. (<a class="reference external" href="http://www.google.com/url?q=http%3A%2F%2Fwww.sciencedirect.com%2Fscience%2Farticle%2Fpii%2FS0304405X16301751&amp;amp;sa=D&amp;amp;sntz=1&amp;amp;usg=AFQjCNFWO63SSQXSteNhgTI4oOhtmh0ZUQ">for example, I use data like that that in this paper</a>)</p></li>
</ul>
<p>A setting where we can do this very cleanly is in the context of academic work. We know exactly when the paper was first published and what the sample that was used there</p>
<p>A nice paper that investigates this for a bunch of strategies is <a class="reference external" href="https://onlinelibrary.wiley.com/doi/pdf/10.1111/jofi.12365?casa_token=gSqvouNM61EAAAAA:JyTl4yxx9xTfKo8-VEBIE-4c4ha7kRFGvirWzEZRXhYw2AtueM3yzpRDcpcXgnsDdlvlXflKp1Nw_ss">Does academic research destroy stock return predictability?</a></p>
<p><strong>Application: Evaluating the publication bias in Fama French 1996, Multifactor Anomalies…</strong></p>
<p>The original paper has the following table</p>
<p><img alt="outofsample" src="../../_images/outofsample2.jpg" /></p>
<ul class="simple">
<li><p>You see here that the sample runs from 63 to 93. Back in 93 we didn’t have digitalized accounting data that went back to the 30’s</p></li>
<li><p>Looking at the very last row we see that the alpha of the HML withresepect to the market is enormous, 0.56% per month, and it has a negative beta with the market!</p></li>
<li><p>so now we will look at two different samples that the authors never looked before doing their study.</p>
<ul>
<li><p>The pre 63 sample</p></li>
<li><p>the post 93.</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample1</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">&lt;</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;1963-7&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
<span class="n">sample2</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">&gt;</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;1993-12&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
<span class="n">sample3</span><span class="o">=</span><span class="p">((</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">&gt;=</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;1963-7&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">&lt;=</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;1993-12&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">Strategy</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span><span class="n">sample</span><span class="p">):</span>
    <span class="n">results</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([],</span><span class="n">index</span><span class="o">=</span><span class="p">[],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">x</span><span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">df1</span><span class="p">[</span><span class="n">sample</span><span class="p">][</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">])</span>
    <span class="n">y</span><span class="o">=</span> <span class="n">df1</span><span class="p">[</span><span class="n">sample</span><span class="p">][</span><span class="s1">&#39;HML&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">regresult</span><span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    <span class="n">results</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;HML:SR&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">SR</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">results</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;MKT:SR&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">SR</span><span class="p">(</span><span class="n">df1</span><span class="p">[</span><span class="n">sample</span><span class="p">][</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">])</span>
    <span class="n">results</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">regresult</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">results</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">regresult</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">results</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;t(alpha)&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">regresult</span><span class="o">.</span><span class="n">tvalues</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">results</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;AR&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">regresult</span><span class="o">.</span><span class="n">tvalues</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">regresult</span><span class="o">.</span><span class="n">resid</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    <span class="n">W</span><span class="o">=</span><span class="n">df1</span><span class="p">[</span><span class="n">sample</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="nd">@np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">df1</span><span class="p">[</span><span class="n">sample</span><span class="p">]</span><span class="o">.</span><span class="n">cov</span><span class="p">())</span>
    <span class="n">W</span><span class="o">=</span><span class="n">W</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
    <span class="n">results</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;HML weight on MVE&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">W</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">results</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Pre publication sample&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Strategy</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">,</span><span class="s1">&#39;HML&#39;</span><span class="p">]],</span><span class="n">sample1</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Publication sample&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Strategy</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">,</span><span class="s1">&#39;HML&#39;</span><span class="p">]],</span><span class="n">sample3</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Post publication sample&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Strategy</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">,</span><span class="s1">&#39;HML&#39;</span><span class="p">]],</span><span class="n">sample2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Pre publication sample
HML:SR               0.346962
MKT:SR               0.457366
alpha                0.113160
beta                 0.371094
t(alpha)             0.661317
AR                   0.185219
HML weight on MVE    0.342709
dtype: float64
Publication sample
HML:SR               0.608203
MKT:SR               0.325699
alpha                0.542778
beta                -0.207224
t(alpha)             4.257801
AR                   1.755981
HML weight on MVE    0.696805
dtype: float64
Post publication sample
HML:SR               0.079270
MKT:SR               0.580553
alpha                0.113256
beta                -0.054502
t(alpha)             0.637514
AR                   0.201533
HML weight on MVE    0.228248
dtype: float64
</pre></div>
</div>
</div>
</div>
<p><strong>what do we learn?</strong></p>
<ul class="simple">
<li><p>In the Pre-publication sample HML has a respectable SR, but the asset is much more correlated with the market so it’s betas with respect to the market leaves only a statistically insignifcant 0.37% per month, 1.2% per year.</p></li>
<li><p>Thus in the pre-sample the HML has a nice SR but the CAPM works so you would not have gained/lost too much of tilting your portfolio towards the HML strategy</p></li>
<li><p>In the post-publication sample the results are very ugly</p>
<ul>
<li><p>Sharpe ratio is now 0.08–compared with the 0.58 SR on the market</p></li>
<li><p>the alpha is still about the same as in the pre-publication, but now the betas become negative</p></li>
<li><p>the HML premium goes away almost completely</p></li>
</ul>
</li>
</ul>
<p>To have a sense of the shift we can look at the risk-return trade-off of the market and HML across samples.</p>
<ul class="simple">
<li><p>The optimal weight on HML shifts from 0.72 in the publication sample to 0.34 in the pre publication and 0.2 in the post publication</p></li>
<li><p>someone that jsut invested on the market would be actually be closer to the optimal portfolio than someone that invested 0.7 in HML</p></li>
</ul>
<p><strong>Does that mean it was data snooping?</strong></p>
<p>We don’t know. It is possible that the publication drove people to the strategies which made the resuls go away goign forward. This <a class="reference external" href="https://onlinelibrary.wiley.com/doi/pdf/10.1111/jofi.12365?casa_token=gSqvouNM61EAAAAA:JyTl4yxx9xTfKo8-VEBIE-4c4ha7kRFGvirWzEZRXhYw2AtueM3yzpRDcpcXgnsDdlvlXflKp1Nw_ss">paper</a> I cited before argues that this is the case</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chapters/Not used"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-basic-problem-of-overfitting">The basic problem of overfitting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#suggestions-to-guard-against-overfitting">Suggestions to guard against overfitting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#optimization-makes-it-worse">Optimization makes it worse</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#additional-diagnostics">Additional Diagnostics</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#confidence-intervals-t-tests-for-sharpe-ratios">Confidence intervals/T-tests for Sharpe Ratios</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#distribution-sampling">Distribution sampling</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#adjusting-for-discarded-signals">Adjusting for Discarded Signals</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#robustifying-your-backtests">Robustifying your Backtests</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#approaches-for-sample-spliting">Approaches for sample spliting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dradowns">Dradowns</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#publication-bias-or-famous-bias-or-incubation-bias">Publication bias (or Famous bias or incubation bias…)</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Alan Moreira
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2021 Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0).
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>